{"ast":null,"code":"class Piece {\n  constructor(width, row, col, name) {\n    this.width = width;\n    this.position = [row, col];\n    this.name = name;\n    this.side = name.split(\"-\")[1];\n    this.translate = `translate(${width * col}, ${width * row})`;\n  }\n\n  move(x, y) {\n    const translate = `translate(${x - this.width / 2}, ${y - this.width / 2})`;\n    this.translate = translate;\n  }\n\n  checkValidMove(newRow, newCol, board) {\n    const [curRow, curCol] = this.position;\n    const [moveRow, moveCol] = [newRow - curRow, newCol - curCol];\n    const valid = newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10;\n    const existMove = this.moves.some(move => {\n      return move[0] === moveRow && move[1] === moveCol;\n    });\n    return valid && existMove && !this.putGeneralInDanger(newRow, newCol, board);\n  }\n\n  setPosition(capture, newRow, newCol) {\n    const [translateX, translateY] = [newCol * this.width, newRow * this.width];\n    const translate = `translate(${translateX}, ${translateY})`;\n    this.position = [newRow, newCol];\n    this.translate = translate;\n    return [capture, newRow, newCol];\n  }\n\n  setNewPosition(x, y, board) {\n    const newCol = Math.floor(x / this.width);\n    const newRow = Math.floor(y / this.width);\n    const [curRow, curCol] = this.position;\n    const [translateX, translateY] = [curCol * this.width, curRow * this.width];\n    this.translate = `translate(${translateX}, ${translateY})`;\n\n    if (this.checkValidMove(newRow, newCol, board)) {\n      if (!board[newRow][newCol].side) {\n        if (this.countPiecesBetween(newRow, newCol, board) === 0) return this.setPosition(false, newRow, newCol);\n      } else if (board[newRow][newCol].side !== board[curRow][curCol].side) if (this.countPiecesBetween(newRow, newCol, board) === 1) return this.setPosition(true, newRow, newCol);\n    }\n\n    return null;\n  }\n\n  countPiecesBetween(newRow, newCol, board) {\n    let [curRow, curCol] = this.position;\n    let count = 0;\n\n    if (newRow === curRow) {\n      do {\n        curCol += curCol > newCol ? -1 : 1;\n        if (board[curRow][curCol]) count++;\n      } while (curCol !== newCol);\n    } else {\n      do {\n        curRow += curRow > newRow ? -1 : 1;\n        if (board[curRow][curCol]) count++;\n      } while (curRow !== newRow);\n    }\n\n    return count;\n  }\n\n  putGeneralInDanger(newRow, newCol, board) {\n    const tmpBoard = board.reduce((acc, row) => {\n      acc.push([...row]);\n      return acc;\n    }, []);\n    this.updateTmpBoard(newRow, newCol, tmpBoard);\n\n    for (let i = 0; i < 10; i++) {\n      for (let j = 0; j < 9; j++) {\n        if (tmpBoard[i][j] && tmpBoard[i][j].side !== this.side) if (tmpBoard[i][j].canCaptureGeneral(tmpBoard)) return true;\n      }\n    }\n\n    return false;\n  }\n\n  updateTmpBoard(newRow, newCol, tmpBoard) {\n    const [curRow, curCol] = this.position;\n    const tmp = tmpBoard[curRow][curCol];\n    tmpBoard[curRow][curCol] = 0;\n    tmpBoard[newRow][newCol] = tmp;\n  }\n\n  canCaptureGeneral(board) {\n    const [curRow, curCol] = this.position;\n\n    for (let move of this.moves) {\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\n\n      if (newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10) {\n        if (board[newRow][newCol].side) if (board[newRow][newCol].side !== board[curRow][curCol].side) if (this.countPiecesBetween(newRow, newCol, board) === 1) if (board[newRow][newCol].name.split(\"-\")[0] === \"general\") return true;\n      }\n    }\n  }\n\n}\n\nexport default Piece;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/pieces/piece.js"],"names":["Piece","constructor","width","row","col","name","position","side","split","translate","move","x","y","checkValidMove","newRow","newCol","board","curRow","curCol","moveRow","moveCol","valid","existMove","moves","some","putGeneralInDanger","setPosition","capture","translateX","translateY","setNewPosition","Math","floor","countPiecesBetween","count","tmpBoard","reduce","acc","push","updateTmpBoard","i","j","canCaptureGeneral","tmp"],"mappings":"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","sourcesContent":["class Piece {\r\n  constructor(width, row, col, name) {\r\n    this.width = width;\r\n    this.position = [row, col];\r\n    this.name = name;\r\n    this.side = name.split(\"-\")[1];\r\n    this.translate = `translate(${width * col}, ${width * row})`;\r\n  }\r\n\r\n  move(x, y) {\r\n    const translate = `translate(${x - this.width / 2}, ${y - this.width / 2})`;\r\n    this.translate = translate;\r\n  }\r\n\r\n  checkValidMove(newRow, newCol, board) {\r\n    const [curRow, curCol] = this.position;\r\n    const [moveRow, moveCol] = [newRow - curRow, newCol - curCol];\r\n    const valid = newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10;\r\n    const existMove = this.moves.some((move) => {\r\n      return move[0] === moveRow && move[1] === moveCol;\r\n    });\r\n    return (\r\n      valid && existMove && !this.putGeneralInDanger(newRow, newCol, board)\r\n    );\r\n  }\r\n\r\n  setPosition(capture, newRow, newCol) {\r\n    const [translateX, translateY] = [newCol * this.width, newRow * this.width];\r\n    const translate = `translate(${translateX}, ${translateY})`;\r\n    this.position = [newRow, newCol];\r\n    this.translate = translate;\r\n    return [capture, newRow, newCol];\r\n  }\r\n\r\n  setNewPosition(x, y, board) {\r\n    const newCol = Math.floor(x / this.width);\r\n    const newRow = Math.floor(y / this.width);\r\n    const [curRow, curCol] = this.position;\r\n    const [translateX, translateY] = [curCol * this.width, curRow * this.width];\r\n    this.translate = `translate(${translateX}, ${translateY})`;\r\n    if (this.checkValidMove(newRow, newCol, board)) {\r\n      if (!board[newRow][newCol].side) {\r\n        if (this.countPiecesBetween(newRow, newCol, board) === 0)\r\n          return this.setPosition(false, newRow, newCol);\r\n      } else if (board[newRow][newCol].side !== board[curRow][curCol].side)\r\n        if (this.countPiecesBetween(newRow, newCol, board) === 1)\r\n          return this.setPosition(true, newRow, newCol);\r\n    }\r\n    return null;\r\n  }\r\n\r\n  countPiecesBetween(newRow, newCol, board) {\r\n    let [curRow, curCol] = this.position;\r\n    let count = 0;\r\n    if (newRow === curRow) {\r\n      do {\r\n        curCol += curCol > newCol ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curCol !== newCol);\r\n    } else {\r\n      do {\r\n        curRow += curRow > newRow ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curRow !== newRow);\r\n    }\r\n    return count;\r\n  }\r\n\r\n  putGeneralInDanger(newRow, newCol, board) {\r\n    const tmpBoard = board.reduce((acc, row) => {\r\n      acc.push([...row]);\r\n      return acc;\r\n    }, []);\r\n    this.updateTmpBoard(newRow, newCol, tmpBoard);\r\n    for (let i = 0; i < 10; i++) {\r\n      for (let j = 0; j < 9; j++) {\r\n        if (tmpBoard[i][j] && tmpBoard[i][j].side !== this.side)\r\n          if (tmpBoard[i][j].canCaptureGeneral(tmpBoard)) return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  updateTmpBoard(newRow, newCol, tmpBoard) {\r\n    const [curRow, curCol] = this.position;\r\n    const tmp = tmpBoard[curRow][curCol];\r\n    tmpBoard[curRow][curCol] = 0;\r\n    tmpBoard[newRow][newCol] = tmp;\r\n  }\r\n\r\n  canCaptureGeneral(board) {\r\n    const [curRow, curCol] = this.position;\r\n    for (let move of this.moves) {\r\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n      if (newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10) {\r\n        if (board[newRow][newCol].side)\r\n          if (board[newRow][newCol].side !== board[curRow][curCol].side)\r\n            if (this.countPiecesBetween(newRow, newCol, board) === 1)\r\n              if (board[newRow][newCol].name.split(\"-\")[0] === \"general\")\r\n                return true;\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default Piece;\r\n"]},"metadata":{},"sourceType":"module"}