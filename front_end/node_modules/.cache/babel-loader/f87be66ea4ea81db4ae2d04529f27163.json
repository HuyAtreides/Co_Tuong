{"ast":null,"code":"class Piece {\n  constructor(width, row, col, name, choosenSide) {\n    this.width = width;\n    this.position = [row, col];\n    this.name = name;\n    this.side = name.split(\"-\")[1];\n    this.choosenSide = choosenSide;\n    this.minCol = 0;\n    this.maxCol = 8;\n    this.minRow = 0;\n    this.maxRow = 9;\n    this.translate = `translate(${width * col}, ${width * row})`;\n  }\n\n  move(x, y) {\n    const [row, col] = this.position;\n    const DOMNode = document.querySelector(`#p${row}${col}`);\n    const translate = `translate(${x - this.width / 2}, ${y - this.width / 2})`;\n    DOMNode.setAttribute(\"transform\", translate); // this.translate = translate;\n  }\n\n  checkValidMove(newRow, newCol, board) {\n    const [curRow, curCol] = this.position;\n    const [moveRow, moveCol] = [newRow - curRow, newCol - curCol];\n    const valid = newCol >= this.minCol && newCol <= this.maxCol && newRow >= this.minRow && newRow <= this.maxRow;\n    const existMove = this.moves.some(move => {\n      return move[0] === moveRow && move[1] === moveCol;\n    });\n\n    if (valid && existMove) {\n      if (!this.moveHint) {\n        const generalTranslate = this.putGeneralInDanger(newRow, newCol, board);\n        if (generalTranslate) return generalTranslate;\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  setPosition(capture, newRow, newCol) {\n    const [translateX, translateY] = [newCol * this.width, newRow * this.width];\n    const translate = `translate(${translateX}, ${translateY})`;\n    this.position = [newRow, newCol];\n    this.translate = translate;\n    return [capture === \"capture\", newRow, newCol];\n  }\n\n  canMoveToNewPosition(newRow, newCol, board) {\n    const [curRow, curCol] = this.position;\n    const [translateX, translateY] = [curCol * this.width, curRow * this.width];\n    this.translate = `translate(${translateX}, ${translateY})`;\n\n    if (this.side === this.choosenSide[1]) {\n      const isValid = this.checkValidMove(newRow, newCol, board);\n\n      if (isValid && !/translate/.test(isValid)) {\n        if (!board[newRow][newCol].side) {\n          if (this.countPiecesBetween(newRow, newCol, board) === 0) return true;\n        } else if (board[newRow][newCol].side !== board[curRow][curCol].side) if (this.countPiecesBetween(newRow, newCol, board) === 1) return \"capture\";\n      } else if (isValid) return isValid;\n    }\n\n    return false;\n  }\n\n  showMoveHints(mode, board) {\n    if (mode === \"off\") {\n      for (let i = 0; i < 10; i++) {\n        for (let j = 0; j < 9; j++) {\n          if (board[i][j] === false) board[i][j] = 0;else if (board[i][j]) board[i][j].canBeCaptured = false;\n        }\n      }\n\n      return;\n    }\n\n    const [curRow, curCol] = this.position;\n\n    for (let move of this.moves) {\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\n      this.moveHint = true;\n      const moveResult = this.canMoveToNewPosition(newRow, newCol, board);\n      this.moveHint = false;\n\n      if (moveResult) {\n        if (moveResult === \"capture\") {\n          board[newRow][newCol].canBeCaptured = true;\n        } else board[newRow][newCol] = false;\n      }\n    }\n  }\n\n  countPiecesBetween(newRow, newCol, board) {\n    let [curRow, curCol] = this.position;\n    let count = 0;\n\n    if (newRow === curRow) {\n      do {\n        curCol += curCol > newCol ? -1 : 1;\n        if (board[curRow][curCol]) count++;\n      } while (curCol !== newCol);\n    } else {\n      do {\n        curRow += curRow > newRow ? -1 : 1;\n        if (board[curRow][curCol]) count++;\n      } while (curRow !== newRow);\n    }\n\n    return count;\n  }\n\n  static isGeneralInDanger(board, side) {\n    for (let i = 0; i < 10; i++) {\n      for (let j = 0; j < 9; j++) {\n        if (board[i][j] && board[i][j].side !== side) {\n          const canCapture = board[i][j].canCaptureGeneral(board);\n          if (/translate/.test(canCapture)) return canCapture;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  putGeneralInDanger(newRow, newCol, board) {\n    const tmpBoard = board.reduce((acc, row) => {\n      acc.push([...row]);\n      return acc;\n    }, []);\n    this.updateTmpBoard(newRow, newCol, tmpBoard);\n    return Piece.isGeneralInDanger(tmpBoard, this.side);\n  }\n\n  static isLost(board, side) {\n    for (let i = 0; i < 10; i++) {\n      for (let j = 0; j < 9; j++) {\n        if (board[i][j] && board[i][j].side === side) {\n          const [curRow, curCol] = board[i][j].position;\n\n          for (let move of board[i][j].moves) {\n            const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\n            const tmp = board[i][j].canMoveToNewPosition(newRow, newCol, board);\n            if (tmp && !/translate/.test(tmp)) return null;\n          }\n        }\n      }\n    }\n\n    if (Piece.isGeneralInDanger(board, side)) {\n      return \"Checkmate\";\n    }\n\n    return \"Stalemate\";\n  }\n\n  updateTmpBoard(newRow, newCol, tmpBoard) {\n    const [curRow, curCol] = this.position;\n    const tmp = tmpBoard[curRow][curCol];\n    tmpBoard[curRow][curCol] = 0;\n    tmpBoard[newRow][newCol] = tmp;\n  }\n\n  canCaptureGeneral(tmpBoard) {\n    const [curRow, curCol] = this.position;\n\n    for (let move of this.moves) {\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\n\n      if (newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10) {\n        if (tmpBoard[newRow][newCol].side) if (tmpBoard[newRow][newCol].side !== tmpBoard[curRow][curCol].side) if (this.countPiecesBetween(newRow, newCol, tmpBoard) === 1) if (tmpBoard[newRow][newCol].name.split(\"-\")[0] === \"general\") {\n          return tmpBoard[newRow][newCol].translate;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  modifyBoard(board, [newRow, newCol], dispatch) {\n    const [curRow, curCol] = this.position;\n    this.setPosition(null, newRow, newCol);\n    const tmp = board[curRow][curCol];\n\n    if (board[newRow][newCol]) {\n      dispatch({\n        type: \"setCapturedPieces\",\n        value: board[newRow][newCol]\n      });\n    }\n\n    board[curRow][curCol] = 0;\n    board[newRow][newCol] = tmp;\n    dispatch({\n      type: \"setBoard\",\n      value: [...board]\n    });\n  }\n\n  animateMove([newRow, newCol], board, dispatch) {\n    const [curRow, curCol] = this.position;\n    this.DOMNode = document.querySelector(`#p${curRow}${curCol}`);\n\n    if (curCol === newCol) {\n      this.moveVertical([newRow, newCol], board, dispatch);\n    } else this.moveDiagonal([newRow, newCol], board, dispatch);\n  }\n\n  setTransform([xB, yB], board, dispatch) {\n    if (board && board[yB][xB]) this.DOMNode.style.display = \"none\";\n    const translate = `translate(${xB * this.width}, ${yB * this.width})`;\n    this.DOMNode.setAttribute(\"transform\", translate);\n\n    if (board) {\n      this.modifyBoard(board, [yB, xB], dispatch);\n    }\n  }\n\n  moveVertical([yB, xB], board, dispatch) {\n    const [yA, xA] = this.position;\n    let step = 0;\n\n    const animate = () => {\n      if (Math.abs(step) < Math.abs(yB - yA)) {\n        step += (yB - yA) / (0.25 * 60);\n        this.setTransform([xA, yA + step], null, null);\n        window.requestAnimationFrame(animate);\n      } else if (Math.abs(step) >= Math.abs(yB - yA)) {\n        this.setTransform([xB, yB], board, dispatch);\n      }\n    };\n\n    window.requestAnimationFrame(animate);\n  }\n\n  moveDiagonal([yB, xB], board, dispatch) {\n    const [yA, xA] = this.position;\n    let step = 0;\n\n    const animate = () => {\n      if (Math.abs(step) < Math.abs(xB - xA)) {\n        step += (xB - xA) / (0.25 * 60);\n        let y = step / (xB - xA) * (yB - yA) + yA;\n        this.setTransform([xA + step, y], null, null);\n        window.requestAnimationFrame(animate);\n      } else if (Math.abs(step) >= Math.abs(xB - xA)) {\n        this.setTransform([xB, yB], board, dispatch);\n      }\n    };\n\n    window.requestAnimationFrame(animate);\n  }\n\n}\n\nexport default Piece;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/pieces/piece.js"],"names":["Piece","constructor","width","row","col","name","choosenSide","position","side","split","minCol","maxCol","minRow","maxRow","translate","move","x","y","DOMNode","document","querySelector","setAttribute","checkValidMove","newRow","newCol","board","curRow","curCol","moveRow","moveCol","valid","existMove","moves","some","moveHint","generalTranslate","putGeneralInDanger","setPosition","capture","translateX","translateY","canMoveToNewPosition","isValid","test","countPiecesBetween","showMoveHints","mode","i","j","canBeCaptured","moveResult","count","isGeneralInDanger","canCapture","canCaptureGeneral","tmpBoard","reduce","acc","push","updateTmpBoard","isLost","tmp","modifyBoard","dispatch","type","value","animateMove","moveVertical","moveDiagonal","setTransform","xB","yB","style","display","yA","xA","step","animate","Math","abs","window","requestAnimationFrame"],"mappings":"AAAA,MAAMA,KAAN,CAAY;AACVC,EAAAA,WAAW,CAACC,KAAD,EAAQC,GAAR,EAAaC,GAAb,EAAkBC,IAAlB,EAAwBC,WAAxB,EAAqC;AAC9C,SAAKJ,KAAL,GAAaA,KAAb;AACA,SAAKK,QAAL,GAAgB,CAACJ,GAAD,EAAMC,GAAN,CAAhB;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKG,IAAL,GAAYH,IAAI,CAACI,KAAL,CAAW,GAAX,EAAgB,CAAhB,CAAZ;AACA,SAAKH,WAAL,GAAmBA,WAAnB;AACA,SAAKI,MAAL,GAAc,CAAd;AACA,SAAKC,MAAL,GAAc,CAAd;AACA,SAAKC,MAAL,GAAc,CAAd;AACA,SAAKC,MAAL,GAAc,CAAd;AACA,SAAKC,SAAL,GAAkB,aAAYZ,KAAK,GAAGE,GAAI,KAAIF,KAAK,GAAGC,GAAI,GAA1D;AACD;;AAEDY,EAAAA,IAAI,CAACC,CAAD,EAAIC,CAAJ,EAAO;AACT,UAAM,CAACd,GAAD,EAAMC,GAAN,IAAa,KAAKG,QAAxB;AACA,UAAMW,OAAO,GAAGC,QAAQ,CAACC,aAAT,CAAwB,KAAIjB,GAAI,GAAEC,GAAI,EAAtC,CAAhB;AACA,UAAMU,SAAS,GAAI,aAAYE,CAAC,GAAG,KAAKd,KAAL,GAAa,CAAE,KAAIe,CAAC,GAAG,KAAKf,KAAL,GAAa,CAAE,GAAzE;AACAgB,IAAAA,OAAO,CAACG,YAAR,CAAqB,WAArB,EAAkCP,SAAlC,EAJS,CAKT;AACD;;AAEDQ,EAAAA,cAAc,CAACC,MAAD,EAASC,MAAT,EAAiBC,KAAjB,EAAwB;AACpC,UAAM,CAACC,MAAD,EAASC,MAAT,IAAmB,KAAKpB,QAA9B;AACA,UAAM,CAACqB,OAAD,EAAUC,OAAV,IAAqB,CAACN,MAAM,GAAGG,MAAV,EAAkBF,MAAM,GAAGG,MAA3B,CAA3B;AACA,UAAMG,KAAK,GACTN,MAAM,IAAI,KAAKd,MAAf,IACAc,MAAM,IAAI,KAAKb,MADf,IAEAY,MAAM,IAAI,KAAKX,MAFf,IAGAW,MAAM,IAAI,KAAKV,MAJjB;AAKA,UAAMkB,SAAS,GAAG,KAAKC,KAAL,CAAWC,IAAX,CAAiBlB,IAAD,IAAU;AAC1C,aAAOA,IAAI,CAAC,CAAD,CAAJ,KAAYa,OAAZ,IAAuBb,IAAI,CAAC,CAAD,CAAJ,KAAYc,OAA1C;AACD,KAFiB,CAAlB;;AAGA,QAAIC,KAAK,IAAIC,SAAb,EAAwB;AACtB,UAAI,CAAC,KAAKG,QAAV,EAAoB;AAClB,cAAMC,gBAAgB,GAAG,KAAKC,kBAAL,CAAwBb,MAAxB,EAAgCC,MAAhC,EAAwCC,KAAxC,CAAzB;AACA,YAAIU,gBAAJ,EAAsB,OAAOA,gBAAP;AACvB;;AACD,aAAO,IAAP;AACD;;AACD,WAAO,KAAP;AACD;;AAEDE,EAAAA,WAAW,CAACC,OAAD,EAAUf,MAAV,EAAkBC,MAAlB,EAA0B;AACnC,UAAM,CAACe,UAAD,EAAaC,UAAb,IAA2B,CAAChB,MAAM,GAAG,KAAKtB,KAAf,EAAsBqB,MAAM,GAAG,KAAKrB,KAApC,CAAjC;AACA,UAAMY,SAAS,GAAI,aAAYyB,UAAW,KAAIC,UAAW,GAAzD;AACA,SAAKjC,QAAL,GAAgB,CAACgB,MAAD,EAASC,MAAT,CAAhB;AACA,SAAKV,SAAL,GAAiBA,SAAjB;AACA,WAAO,CAACwB,OAAO,KAAK,SAAb,EAAwBf,MAAxB,EAAgCC,MAAhC,CAAP;AACD;;AAEDiB,EAAAA,oBAAoB,CAAClB,MAAD,EAASC,MAAT,EAAiBC,KAAjB,EAAwB;AAC1C,UAAM,CAACC,MAAD,EAASC,MAAT,IAAmB,KAAKpB,QAA9B;AACA,UAAM,CAACgC,UAAD,EAAaC,UAAb,IAA2B,CAACb,MAAM,GAAG,KAAKzB,KAAf,EAAsBwB,MAAM,GAAG,KAAKxB,KAApC,CAAjC;AACA,SAAKY,SAAL,GAAkB,aAAYyB,UAAW,KAAIC,UAAW,GAAxD;;AACA,QAAI,KAAKhC,IAAL,KAAc,KAAKF,WAAL,CAAiB,CAAjB,CAAlB,EAAuC;AACrC,YAAMoC,OAAO,GAAG,KAAKpB,cAAL,CAAoBC,MAApB,EAA4BC,MAA5B,EAAoCC,KAApC,CAAhB;;AACA,UAAIiB,OAAO,IAAI,CAAC,YAAYC,IAAZ,CAAiBD,OAAjB,CAAhB,EAA2C;AACzC,YAAI,CAACjB,KAAK,CAACF,MAAD,CAAL,CAAcC,MAAd,EAAsBhB,IAA3B,EAAiC;AAC/B,cAAI,KAAKoC,kBAAL,CAAwBrB,MAAxB,EAAgCC,MAAhC,EAAwCC,KAAxC,MAAmD,CAAvD,EAA0D,OAAO,IAAP;AAC3D,SAFD,MAEO,IAAIA,KAAK,CAACF,MAAD,CAAL,CAAcC,MAAd,EAAsBhB,IAAtB,KAA+BiB,KAAK,CAACC,MAAD,CAAL,CAAcC,MAAd,EAAsBnB,IAAzD,EACL,IAAI,KAAKoC,kBAAL,CAAwBrB,MAAxB,EAAgCC,MAAhC,EAAwCC,KAAxC,MAAmD,CAAvD,EACE,OAAO,SAAP;AACL,OAND,MAMO,IAAIiB,OAAJ,EAAa,OAAOA,OAAP;AACrB;;AACD,WAAO,KAAP;AACD;;AAEDG,EAAAA,aAAa,CAACC,IAAD,EAAOrB,KAAP,EAAc;AACzB,QAAIqB,IAAI,KAAK,KAAb,EAAoB;AAClB,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC1B,cAAIvB,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,MAAgB,KAApB,EAA2BvB,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,IAAc,CAAd,CAA3B,KACK,IAAIvB,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,CAAJ,EAAiBvB,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,EAAYC,aAAZ,GAA4B,KAA5B;AACvB;AACF;;AACD;AACD;;AACD,UAAM,CAACvB,MAAD,EAASC,MAAT,IAAmB,KAAKpB,QAA9B;;AACA,SAAK,IAAIQ,IAAT,IAAiB,KAAKiB,KAAtB,EAA6B;AAC3B,YAAM,CAACT,MAAD,EAASC,MAAT,IAAmB,CAACE,MAAM,GAAGX,IAAI,CAAC,CAAD,CAAd,EAAmBY,MAAM,GAAGZ,IAAI,CAAC,CAAD,CAAhC,CAAzB;AACA,WAAKmB,QAAL,GAAgB,IAAhB;AACA,YAAMgB,UAAU,GAAG,KAAKT,oBAAL,CAA0BlB,MAA1B,EAAkCC,MAAlC,EAA0CC,KAA1C,CAAnB;AACA,WAAKS,QAAL,GAAgB,KAAhB;;AACA,UAAIgB,UAAJ,EAAgB;AACd,YAAIA,UAAU,KAAK,SAAnB,EAA8B;AAC5BzB,UAAAA,KAAK,CAACF,MAAD,CAAL,CAAcC,MAAd,EAAsByB,aAAtB,GAAsC,IAAtC;AACD,SAFD,MAEOxB,KAAK,CAACF,MAAD,CAAL,CAAcC,MAAd,IAAwB,KAAxB;AACR;AACF;AACF;;AAEDoB,EAAAA,kBAAkB,CAACrB,MAAD,EAASC,MAAT,EAAiBC,KAAjB,EAAwB;AACxC,QAAI,CAACC,MAAD,EAASC,MAAT,IAAmB,KAAKpB,QAA5B;AACA,QAAI4C,KAAK,GAAG,CAAZ;;AACA,QAAI5B,MAAM,KAAKG,MAAf,EAAuB;AACrB,SAAG;AACDC,QAAAA,MAAM,IAAIA,MAAM,GAAGH,MAAT,GAAkB,CAAC,CAAnB,GAAuB,CAAjC;AACA,YAAIC,KAAK,CAACC,MAAD,CAAL,CAAcC,MAAd,CAAJ,EAA2BwB,KAAK;AACjC,OAHD,QAGSxB,MAAM,KAAKH,MAHpB;AAID,KALD,MAKO;AACL,SAAG;AACDE,QAAAA,MAAM,IAAIA,MAAM,GAAGH,MAAT,GAAkB,CAAC,CAAnB,GAAuB,CAAjC;AACA,YAAIE,KAAK,CAACC,MAAD,CAAL,CAAcC,MAAd,CAAJ,EAA2BwB,KAAK;AACjC,OAHD,QAGSzB,MAAM,KAAKH,MAHpB;AAID;;AACD,WAAO4B,KAAP;AACD;;AAEuB,SAAjBC,iBAAiB,CAAC3B,KAAD,EAAQjB,IAAR,EAAc;AACpC,SAAK,IAAIuC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC1B,YAAIvB,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,KAAevB,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,EAAYxC,IAAZ,KAAqBA,IAAxC,EAA8C;AAC5C,gBAAM6C,UAAU,GAAG5B,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,EAAYM,iBAAZ,CAA8B7B,KAA9B,CAAnB;AACA,cAAI,YAAYkB,IAAZ,CAAiBU,UAAjB,CAAJ,EAAkC,OAAOA,UAAP;AACnC;AACF;AACF;;AACD,WAAO,KAAP;AACD;;AAEDjB,EAAAA,kBAAkB,CAACb,MAAD,EAASC,MAAT,EAAiBC,KAAjB,EAAwB;AACxC,UAAM8B,QAAQ,GAAG9B,KAAK,CAAC+B,MAAN,CAAa,CAACC,GAAD,EAAMtD,GAAN,KAAc;AAC1CsD,MAAAA,GAAG,CAACC,IAAJ,CAAS,CAAC,GAAGvD,GAAJ,CAAT;AACA,aAAOsD,GAAP;AACD,KAHgB,EAGd,EAHc,CAAjB;AAIA,SAAKE,cAAL,CAAoBpC,MAApB,EAA4BC,MAA5B,EAAoC+B,QAApC;AACA,WAAOvD,KAAK,CAACoD,iBAAN,CAAwBG,QAAxB,EAAkC,KAAK/C,IAAvC,CAAP;AACD;;AAEY,SAANoD,MAAM,CAACnC,KAAD,EAAQjB,IAAR,EAAc;AACzB,SAAK,IAAIuC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC1B,YAAIvB,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,KAAevB,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,EAAYxC,IAAZ,KAAqBA,IAAxC,EAA8C;AAC5C,gBAAM,CAACkB,MAAD,EAASC,MAAT,IAAmBF,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,EAAYzC,QAArC;;AACA,eAAK,IAAIQ,IAAT,IAAiBU,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,EAAYhB,KAA7B,EAAoC;AAClC,kBAAM,CAACT,MAAD,EAASC,MAAT,IAAmB,CAACE,MAAM,GAAGX,IAAI,CAAC,CAAD,CAAd,EAAmBY,MAAM,GAAGZ,IAAI,CAAC,CAAD,CAAhC,CAAzB;AACA,kBAAM8C,GAAG,GAAGpC,KAAK,CAACsB,CAAD,CAAL,CAASC,CAAT,EAAYP,oBAAZ,CAAiClB,MAAjC,EAAyCC,MAAzC,EAAiDC,KAAjD,CAAZ;AACA,gBAAIoC,GAAG,IAAI,CAAC,YAAYlB,IAAZ,CAAiBkB,GAAjB,CAAZ,EAAmC,OAAO,IAAP;AACpC;AACF;AACF;AACF;;AACD,QAAI7D,KAAK,CAACoD,iBAAN,CAAwB3B,KAAxB,EAA+BjB,IAA/B,CAAJ,EAA0C;AACxC,aAAO,WAAP;AACD;;AACD,WAAO,WAAP;AACD;;AAEDmD,EAAAA,cAAc,CAACpC,MAAD,EAASC,MAAT,EAAiB+B,QAAjB,EAA2B;AACvC,UAAM,CAAC7B,MAAD,EAASC,MAAT,IAAmB,KAAKpB,QAA9B;AACA,UAAMsD,GAAG,GAAGN,QAAQ,CAAC7B,MAAD,CAAR,CAAiBC,MAAjB,CAAZ;AACA4B,IAAAA,QAAQ,CAAC7B,MAAD,CAAR,CAAiBC,MAAjB,IAA2B,CAA3B;AACA4B,IAAAA,QAAQ,CAAChC,MAAD,CAAR,CAAiBC,MAAjB,IAA2BqC,GAA3B;AACD;;AAEDP,EAAAA,iBAAiB,CAACC,QAAD,EAAW;AAC1B,UAAM,CAAC7B,MAAD,EAASC,MAAT,IAAmB,KAAKpB,QAA9B;;AACA,SAAK,IAAIQ,IAAT,IAAiB,KAAKiB,KAAtB,EAA6B;AAC3B,YAAM,CAACT,MAAD,EAASC,MAAT,IAAmB,CAACE,MAAM,GAAGX,IAAI,CAAC,CAAD,CAAd,EAAmBY,MAAM,GAAGZ,IAAI,CAAC,CAAD,CAAhC,CAAzB;;AACA,UAAIS,MAAM,IAAI,CAAV,IAAeA,MAAM,GAAG,CAAxB,IAA6BD,MAAM,IAAI,CAAvC,IAA4CA,MAAM,GAAG,EAAzD,EAA6D;AAC3D,YAAIgC,QAAQ,CAAChC,MAAD,CAAR,CAAiBC,MAAjB,EAAyBhB,IAA7B,EACE,IAAI+C,QAAQ,CAAChC,MAAD,CAAR,CAAiBC,MAAjB,EAAyBhB,IAAzB,KAAkC+C,QAAQ,CAAC7B,MAAD,CAAR,CAAiBC,MAAjB,EAAyBnB,IAA/D,EACE,IAAI,KAAKoC,kBAAL,CAAwBrB,MAAxB,EAAgCC,MAAhC,EAAwC+B,QAAxC,MAAsD,CAA1D,EACE,IAAIA,QAAQ,CAAChC,MAAD,CAAR,CAAiBC,MAAjB,EAAyBnB,IAAzB,CAA8BI,KAA9B,CAAoC,GAApC,EAAyC,CAAzC,MAAgD,SAApD,EAA+D;AAC7D,iBAAO8C,QAAQ,CAAChC,MAAD,CAAR,CAAiBC,MAAjB,EAAyBV,SAAhC;AACD;AACR;AACF;;AACD,WAAO,KAAP;AACD;;AAEDgD,EAAAA,WAAW,CAACrC,KAAD,EAAQ,CAACF,MAAD,EAASC,MAAT,CAAR,EAA0BuC,QAA1B,EAAoC;AAC7C,UAAM,CAACrC,MAAD,EAASC,MAAT,IAAmB,KAAKpB,QAA9B;AACA,SAAK8B,WAAL,CAAiB,IAAjB,EAAuBd,MAAvB,EAA+BC,MAA/B;AACA,UAAMqC,GAAG,GAAGpC,KAAK,CAACC,MAAD,CAAL,CAAcC,MAAd,CAAZ;;AACA,QAAIF,KAAK,CAACF,MAAD,CAAL,CAAcC,MAAd,CAAJ,EAA2B;AACzBuC,MAAAA,QAAQ,CAAC;AAAEC,QAAAA,IAAI,EAAE,mBAAR;AAA6BC,QAAAA,KAAK,EAAExC,KAAK,CAACF,MAAD,CAAL,CAAcC,MAAd;AAApC,OAAD,CAAR;AACD;;AACDC,IAAAA,KAAK,CAACC,MAAD,CAAL,CAAcC,MAAd,IAAwB,CAAxB;AACAF,IAAAA,KAAK,CAACF,MAAD,CAAL,CAAcC,MAAd,IAAwBqC,GAAxB;AACAE,IAAAA,QAAQ,CAAC;AAAEC,MAAAA,IAAI,EAAE,UAAR;AAAoBC,MAAAA,KAAK,EAAE,CAAC,GAAGxC,KAAJ;AAA3B,KAAD,CAAR;AACD;;AAEDyC,EAAAA,WAAW,CAAC,CAAC3C,MAAD,EAASC,MAAT,CAAD,EAAmBC,KAAnB,EAA0BsC,QAA1B,EAAoC;AAC7C,UAAM,CAACrC,MAAD,EAASC,MAAT,IAAmB,KAAKpB,QAA9B;AACA,SAAKW,OAAL,GAAeC,QAAQ,CAACC,aAAT,CAAwB,KAAIM,MAAO,GAAEC,MAAO,EAA5C,CAAf;;AACA,QAAIA,MAAM,KAAKH,MAAf,EAAuB;AACrB,WAAK2C,YAAL,CAAkB,CAAC5C,MAAD,EAASC,MAAT,CAAlB,EAAoCC,KAApC,EAA2CsC,QAA3C;AACD,KAFD,MAEO,KAAKK,YAAL,CAAkB,CAAC7C,MAAD,EAASC,MAAT,CAAlB,EAAoCC,KAApC,EAA2CsC,QAA3C;AACR;;AAEDM,EAAAA,YAAY,CAAC,CAACC,EAAD,EAAKC,EAAL,CAAD,EAAW9C,KAAX,EAAkBsC,QAAlB,EAA4B;AACtC,QAAItC,KAAK,IAAIA,KAAK,CAAC8C,EAAD,CAAL,CAAUD,EAAV,CAAb,EAA4B,KAAKpD,OAAL,CAAasD,KAAb,CAAmBC,OAAnB,GAA6B,MAA7B;AAC5B,UAAM3D,SAAS,GAAI,aAAYwD,EAAE,GAAG,KAAKpE,KAAM,KAAIqE,EAAE,GAAG,KAAKrE,KAAM,GAAnE;AACA,SAAKgB,OAAL,CAAaG,YAAb,CAA0B,WAA1B,EAAuCP,SAAvC;;AACA,QAAIW,KAAJ,EAAW;AACT,WAAKqC,WAAL,CAAiBrC,KAAjB,EAAwB,CAAC8C,EAAD,EAAKD,EAAL,CAAxB,EAAkCP,QAAlC;AACD;AACF;;AAEDI,EAAAA,YAAY,CAAC,CAACI,EAAD,EAAKD,EAAL,CAAD,EAAW7C,KAAX,EAAkBsC,QAAlB,EAA4B;AACtC,UAAM,CAACW,EAAD,EAAKC,EAAL,IAAW,KAAKpE,QAAtB;AACA,QAAIqE,IAAI,GAAG,CAAX;;AAEA,UAAMC,OAAO,GAAG,MAAM;AACpB,UAAIC,IAAI,CAACC,GAAL,CAASH,IAAT,IAAiBE,IAAI,CAACC,GAAL,CAASR,EAAE,GAAGG,EAAd,CAArB,EAAwC;AACtCE,QAAAA,IAAI,IAAI,CAACL,EAAE,GAAGG,EAAN,KAAa,OAAO,EAApB,CAAR;AACA,aAAKL,YAAL,CAAkB,CAACM,EAAD,EAAKD,EAAE,GAAGE,IAAV,CAAlB,EAAmC,IAAnC,EAAyC,IAAzC;AACAI,QAAAA,MAAM,CAACC,qBAAP,CAA6BJ,OAA7B;AACD,OAJD,MAIO,IAAIC,IAAI,CAACC,GAAL,CAASH,IAAT,KAAkBE,IAAI,CAACC,GAAL,CAASR,EAAE,GAAGG,EAAd,CAAtB,EAAyC;AAC9C,aAAKL,YAAL,CAAkB,CAACC,EAAD,EAAKC,EAAL,CAAlB,EAA4B9C,KAA5B,EAAmCsC,QAAnC;AACD;AACF,KARD;;AAUAiB,IAAAA,MAAM,CAACC,qBAAP,CAA6BJ,OAA7B;AACD;;AAEDT,EAAAA,YAAY,CAAC,CAACG,EAAD,EAAKD,EAAL,CAAD,EAAW7C,KAAX,EAAkBsC,QAAlB,EAA4B;AACtC,UAAM,CAACW,EAAD,EAAKC,EAAL,IAAW,KAAKpE,QAAtB;AACA,QAAIqE,IAAI,GAAG,CAAX;;AAEA,UAAMC,OAAO,GAAG,MAAM;AACpB,UAAIC,IAAI,CAACC,GAAL,CAASH,IAAT,IAAiBE,IAAI,CAACC,GAAL,CAAST,EAAE,GAAGK,EAAd,CAArB,EAAwC;AACtCC,QAAAA,IAAI,IAAI,CAACN,EAAE,GAAGK,EAAN,KAAa,OAAO,EAApB,CAAR;AACA,YAAI1D,CAAC,GAAI2D,IAAI,IAAIN,EAAE,GAAGK,EAAT,CAAL,IAAsBJ,EAAE,GAAGG,EAA3B,IAAiCA,EAAzC;AACA,aAAKL,YAAL,CAAkB,CAACM,EAAE,GAAGC,IAAN,EAAY3D,CAAZ,CAAlB,EAAkC,IAAlC,EAAwC,IAAxC;AACA+D,QAAAA,MAAM,CAACC,qBAAP,CAA6BJ,OAA7B;AACD,OALD,MAKO,IAAIC,IAAI,CAACC,GAAL,CAASH,IAAT,KAAkBE,IAAI,CAACC,GAAL,CAAST,EAAE,GAAGK,EAAd,CAAtB,EAAyC;AAC9C,aAAKN,YAAL,CAAkB,CAACC,EAAD,EAAKC,EAAL,CAAlB,EAA4B9C,KAA5B,EAAmCsC,QAAnC;AACD;AACF,KATD;;AAWAiB,IAAAA,MAAM,CAACC,qBAAP,CAA6BJ,OAA7B;AACD;;AA1OS;;AA6OZ,eAAe7E,KAAf","sourcesContent":["class Piece {\r\n  constructor(width, row, col, name, choosenSide) {\r\n    this.width = width;\r\n    this.position = [row, col];\r\n    this.name = name;\r\n    this.side = name.split(\"-\")[1];\r\n    this.choosenSide = choosenSide;\r\n    this.minCol = 0;\r\n    this.maxCol = 8;\r\n    this.minRow = 0;\r\n    this.maxRow = 9;\r\n    this.translate = `translate(${width * col}, ${width * row})`;\r\n  }\r\n\r\n  move(x, y) {\r\n    const [row, col] = this.position;\r\n    const DOMNode = document.querySelector(`#p${row}${col}`);\r\n    const translate = `translate(${x - this.width / 2}, ${y - this.width / 2})`;\r\n    DOMNode.setAttribute(\"transform\", translate);\r\n    // this.translate = translate;\r\n  }\r\n\r\n  checkValidMove(newRow, newCol, board) {\r\n    const [curRow, curCol] = this.position;\r\n    const [moveRow, moveCol] = [newRow - curRow, newCol - curCol];\r\n    const valid =\r\n      newCol >= this.minCol &&\r\n      newCol <= this.maxCol &&\r\n      newRow >= this.minRow &&\r\n      newRow <= this.maxRow;\r\n    const existMove = this.moves.some((move) => {\r\n      return move[0] === moveRow && move[1] === moveCol;\r\n    });\r\n    if (valid && existMove) {\r\n      if (!this.moveHint) {\r\n        const generalTranslate = this.putGeneralInDanger(newRow, newCol, board);\r\n        if (generalTranslate) return generalTranslate;\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  setPosition(capture, newRow, newCol) {\r\n    const [translateX, translateY] = [newCol * this.width, newRow * this.width];\r\n    const translate = `translate(${translateX}, ${translateY})`;\r\n    this.position = [newRow, newCol];\r\n    this.translate = translate;\r\n    return [capture === \"capture\", newRow, newCol];\r\n  }\r\n\r\n  canMoveToNewPosition(newRow, newCol, board) {\r\n    const [curRow, curCol] = this.position;\r\n    const [translateX, translateY] = [curCol * this.width, curRow * this.width];\r\n    this.translate = `translate(${translateX}, ${translateY})`;\r\n    if (this.side === this.choosenSide[1]) {\r\n      const isValid = this.checkValidMove(newRow, newCol, board);\r\n      if (isValid && !/translate/.test(isValid)) {\r\n        if (!board[newRow][newCol].side) {\r\n          if (this.countPiecesBetween(newRow, newCol, board) === 0) return true;\r\n        } else if (board[newRow][newCol].side !== board[curRow][curCol].side)\r\n          if (this.countPiecesBetween(newRow, newCol, board) === 1)\r\n            return \"capture\";\r\n      } else if (isValid) return isValid;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  showMoveHints(mode, board) {\r\n    if (mode === \"off\") {\r\n      for (let i = 0; i < 10; i++) {\r\n        for (let j = 0; j < 9; j++) {\r\n          if (board[i][j] === false) board[i][j] = 0;\r\n          else if (board[i][j]) board[i][j].canBeCaptured = false;\r\n        }\r\n      }\r\n      return;\r\n    }\r\n    const [curRow, curCol] = this.position;\r\n    for (let move of this.moves) {\r\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n      this.moveHint = true;\r\n      const moveResult = this.canMoveToNewPosition(newRow, newCol, board);\r\n      this.moveHint = false;\r\n      if (moveResult) {\r\n        if (moveResult === \"capture\") {\r\n          board[newRow][newCol].canBeCaptured = true;\r\n        } else board[newRow][newCol] = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  countPiecesBetween(newRow, newCol, board) {\r\n    let [curRow, curCol] = this.position;\r\n    let count = 0;\r\n    if (newRow === curRow) {\r\n      do {\r\n        curCol += curCol > newCol ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curCol !== newCol);\r\n    } else {\r\n      do {\r\n        curRow += curRow > newRow ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curRow !== newRow);\r\n    }\r\n    return count;\r\n  }\r\n\r\n  static isGeneralInDanger(board, side) {\r\n    for (let i = 0; i < 10; i++) {\r\n      for (let j = 0; j < 9; j++) {\r\n        if (board[i][j] && board[i][j].side !== side) {\r\n          const canCapture = board[i][j].canCaptureGeneral(board);\r\n          if (/translate/.test(canCapture)) return canCapture;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  putGeneralInDanger(newRow, newCol, board) {\r\n    const tmpBoard = board.reduce((acc, row) => {\r\n      acc.push([...row]);\r\n      return acc;\r\n    }, []);\r\n    this.updateTmpBoard(newRow, newCol, tmpBoard);\r\n    return Piece.isGeneralInDanger(tmpBoard, this.side);\r\n  }\r\n\r\n  static isLost(board, side) {\r\n    for (let i = 0; i < 10; i++) {\r\n      for (let j = 0; j < 9; j++) {\r\n        if (board[i][j] && board[i][j].side === side) {\r\n          const [curRow, curCol] = board[i][j].position;\r\n          for (let move of board[i][j].moves) {\r\n            const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n            const tmp = board[i][j].canMoveToNewPosition(newRow, newCol, board);\r\n            if (tmp && !/translate/.test(tmp)) return null;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (Piece.isGeneralInDanger(board, side)) {\r\n      return \"Checkmate\";\r\n    }\r\n    return \"Stalemate\";\r\n  }\r\n\r\n  updateTmpBoard(newRow, newCol, tmpBoard) {\r\n    const [curRow, curCol] = this.position;\r\n    const tmp = tmpBoard[curRow][curCol];\r\n    tmpBoard[curRow][curCol] = 0;\r\n    tmpBoard[newRow][newCol] = tmp;\r\n  }\r\n\r\n  canCaptureGeneral(tmpBoard) {\r\n    const [curRow, curCol] = this.position;\r\n    for (let move of this.moves) {\r\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n      if (newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10) {\r\n        if (tmpBoard[newRow][newCol].side)\r\n          if (tmpBoard[newRow][newCol].side !== tmpBoard[curRow][curCol].side)\r\n            if (this.countPiecesBetween(newRow, newCol, tmpBoard) === 1)\r\n              if (tmpBoard[newRow][newCol].name.split(\"-\")[0] === \"general\") {\r\n                return tmpBoard[newRow][newCol].translate;\r\n              }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  modifyBoard(board, [newRow, newCol], dispatch) {\r\n    const [curRow, curCol] = this.position;\r\n    this.setPosition(null, newRow, newCol);\r\n    const tmp = board[curRow][curCol];\r\n    if (board[newRow][newCol]) {\r\n      dispatch({ type: \"setCapturedPieces\", value: board[newRow][newCol] });\r\n    }\r\n    board[curRow][curCol] = 0;\r\n    board[newRow][newCol] = tmp;\r\n    dispatch({ type: \"setBoard\", value: [...board] });\r\n  }\r\n\r\n  animateMove([newRow, newCol], board, dispatch) {\r\n    const [curRow, curCol] = this.position;\r\n    this.DOMNode = document.querySelector(`#p${curRow}${curCol}`);\r\n    if (curCol === newCol) {\r\n      this.moveVertical([newRow, newCol], board, dispatch);\r\n    } else this.moveDiagonal([newRow, newCol], board, dispatch);\r\n  }\r\n\r\n  setTransform([xB, yB], board, dispatch) {\r\n    if (board && board[yB][xB]) this.DOMNode.style.display = \"none\";\r\n    const translate = `translate(${xB * this.width}, ${yB * this.width})`;\r\n    this.DOMNode.setAttribute(\"transform\", translate);\r\n    if (board) {\r\n      this.modifyBoard(board, [yB, xB], dispatch);\r\n    }\r\n  }\r\n\r\n  moveVertical([yB, xB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    let step = 0;\r\n\r\n    const animate = () => {\r\n      if (Math.abs(step) < Math.abs(yB - yA)) {\r\n        step += (yB - yA) / (0.25 * 60);\r\n        this.setTransform([xA, yA + step], null, null);\r\n        window.requestAnimationFrame(animate);\r\n      } else if (Math.abs(step) >= Math.abs(yB - yA)) {\r\n        this.setTransform([xB, yB], board, dispatch);\r\n      }\r\n    };\r\n\r\n    window.requestAnimationFrame(animate);\r\n  }\r\n\r\n  moveDiagonal([yB, xB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    let step = 0;\r\n\r\n    const animate = () => {\r\n      if (Math.abs(step) < Math.abs(xB - xA)) {\r\n        step += (xB - xA) / (0.25 * 60);\r\n        let y = (step / (xB - xA)) * (yB - yA) + yA;\r\n        this.setTransform([xA + step, y], null, null);\r\n        window.requestAnimationFrame(animate);\r\n      } else if (Math.abs(step) >= Math.abs(xB - xA)) {\r\n        this.setTransform([xB, yB], board, dispatch);\r\n      }\r\n    };\r\n\r\n    window.requestAnimationFrame(animate);\r\n  }\r\n}\r\n\r\nexport default Piece;\r\n"]},"metadata":{},"sourceType":"module"}