{"ast":null,"code":"class Piece {\n  constructor(width, row, col, name, choosenSide) {\n    this.width = width;\n    this.position = [row, col];\n    this.name = name;\n    this.side = name.split(\"-\")[1];\n    this.choosenSide = choosenSide;\n    this.minCol = 0;\n    this.maxCol = 8;\n    this.minRow = 0;\n    this.maxRow = 9;\n    this.translate = `translate(${width * col}, ${width * row})`;\n  }\n\n  move(x, y) {\n    const translate = `translate(${x - this.width / 2}, ${y - this.width / 2})`;\n    this.translate = translate;\n  }\n\n  checkValidMove(newRow, newCol, board) {\n    const [curRow, curCol] = this.position;\n    const [moveRow, moveCol] = [newRow - curRow, newCol - curCol];\n    const valid = newCol >= this.minCol && newCol <= this.maxCol && newRow >= this.minRow && newRow <= this.maxRow;\n    const existMove = this.moves.some(move => {\n      return move[0] === moveRow && move[1] === moveCol;\n    });\n    return valid && existMove && !this.putGeneralInDanger(newRow, newCol, board);\n  }\n\n  setPosition(capture, newRow, newCol) {\n    const [translateX, translateY] = [newCol * this.width, newRow * this.width];\n    const translate = `translate(${translateX}, ${translateY})`;\n    this.position = [newRow, newCol];\n    this.translate = translate;\n    return [capture, newRow, newCol];\n  }\n\n  setNewPosition(x, y, board, turnToMove) {\n    const newCol = Math.floor(x / this.width);\n    const newRow = Math.floor(y / this.width);\n    const [curRow, curCol] = this.position;\n    const [translateX, translateY] = [curCol * this.width, curRow * this.width];\n    this.translate = `translate(${translateX}, ${translateY})`;\n\n    if (turnToMove && this.side === this.choosenSide[1]) {\n      if (this.checkValidMove(newRow, newCol, board)) {\n        if (!board[newRow][newCol].side) {\n          if (this.countPiecesBetween(newRow, newCol, board) === 0) return this.setPosition(false, newRow, newCol);\n        } else if (board[newRow][newCol].side !== board[curRow][curCol].side) if (this.countPiecesBetween(newRow, newCol, board) === 1) return this.setPosition(true, newRow, newCol);\n      }\n    }\n\n    return null;\n  }\n\n  countPiecesBetween(newRow, newCol, board) {\n    let [curRow, curCol] = this.position;\n    let count = 0;\n\n    if (newRow === curRow) {\n      do {\n        curCol += curCol > newCol ? -1 : 1;\n        if (board[curRow][curCol]) count++;\n      } while (curCol !== newCol);\n    } else {\n      do {\n        curRow += curRow > newRow ? -1 : 1;\n        if (board[curRow][curCol]) count++;\n      } while (curRow !== newRow);\n    }\n\n    return count;\n  }\n\n  static isGeneralInDanger(board, side) {\n    for (let i = 0; i < 10; i++) {\n      for (let j = 0; j < 9; j++) {\n        if (board[i][j] && board[i][j].side !== side) if (board[i][j].canCaptureGeneral(board)) return true;\n      }\n    }\n\n    return false;\n  }\n\n  putGeneralInDanger(newRow, newCol, board) {\n    const tmpBoard = board.reduce((acc, row) => {\n      acc.push([...row]);\n      return acc;\n    }, []);\n    this.updateTmpBoard(newRow, newCol, tmpBoard);\n\n    for (let i = 0; i < 10; i++) {\n      for (let j = 0; j < 9; j++) {\n        if (tmpBoard[i][j] && tmpBoard[i][j].side !== this.side) if (tmpBoard[i][j].canCaptureGeneral(tmpBoard)) {\n          return true;\n        }\n      }\n    }\n\n    return false;\n  }\n\n  canSaveGeneral(piece, board) {\n    console.log(\"can save general\");\n    console.log(this);\n    console.log(piece);\n    const [curRow, curCol] = piece.position;\n\n    for (let move of piece.moves) {\n      const tmpBoard = board.reduce((acc, row) => {\n        acc.push([...row]);\n        return acc;\n      }, []);\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\n\n      if (newCol >= piece.minCol && newCol <= piece.maxCol && newRow >= piece.minRow && newRow <= piece.maxRow) {\n        if (!tmpBoard[newRow][newCol]) {\n          if (piece.countPiecesBetween(newRow, newCol, tmpBoard) === 0) {\n            this.updateTmpBoard(newRow, newCol, tmpBoard);\n            if (!Piece.isGeneralInDanger(tmpBoard, piece.side)) return true;\n          }\n        } else if (tmpBoard[newRow][newCol].side !== piece.side) {\n          if (piece.countPiecesBetween(newRow, newCol, tmpBoard) === 1) {\n            this.updateTmpBoard(newRow, newCol, tmpBoard);\n            if (!Piece.isGeneralInDanger(tmpBoard, piece.side)) return true;\n          }\n        }\n      }\n    }\n\n    return false;\n  }\n\n  static isCheckmated(board, side) {\n    if (Piece.isGeneralInDanger(board, side)) {\n      console.log(\"in danger\");\n\n      for (let i = 0; i < 10; i++) {\n        for (let j = 0; j < 9; j++) {\n          if (board[i][j] && board[i][j].side === side) {\n            console.log(board[i][j]);\n            if (board[i][j].canSaveGeneral(board[i][j], board)) return false;\n          }\n        }\n      }\n\n      return true;\n    }\n\n    return false;\n  }\n\n  updateTmpBoard(newRow, newCol, tmpBoard) {\n    const [curRow, curCol] = this.position;\n    const tmp = tmpBoard[curRow][curCol];\n    tmpBoard[curRow][curCol] = 0;\n    tmpBoard[newRow][newCol] = tmp;\n  }\n\n  canCaptureGeneral(tmpBoard) {\n    const [curRow, curCol] = this.position;\n\n    for (let move of this.moves) {\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\n\n      if (newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10) {\n        if (tmpBoard[newRow][newCol].side) if (tmpBoard[newRow][newCol].side !== tmpBoard[curRow][curCol].side) if (this.countPiecesBetween(newRow, newCol, tmpBoard) === 1) if (tmpBoard[newRow][newCol].name.split(\"-\")[0] === \"general\") return true;\n      }\n    }\n  }\n\n  animateMove([newRow, newCol], board, dispatch) {\n    const [curRow, curCol] = this.position;\n    this.DOMNode = document.querySelector(`#p${curRow}${curCol}`);\n\n    if (curCol === newCol) {\n      this.moveVertical([newRow, newCol], board, dispatch);\n    } else this.moveDiagonal([newRow, newCol], board, dispatch);\n  }\n\n  setTransform([xB, yB], board, dispatch) {\n    const [yA, xA] = this.position;\n    const translate = `translate(${xB * this.width}, ${yB * this.width})`;\n    this.DOMNode.setAttribute(\"transform\", translate);\n\n    if (board) {\n      this.setPosition(null, yB, xB);\n      const tmp = board[yA][xA];\n      if (board[yB][xB]) dispatch({\n        type: \"setCapturedPieces\",\n        value: board[yB][xB]\n      });\n      board[yA][xA] = 0;\n      board[yB][xB] = tmp;\n      dispatch({\n        type: \"setTurnToMove\",\n        value: true\n      });\n      dispatch({\n        type: \"setBoard\",\n        value: [...board]\n      });\n    }\n  }\n\n  moveVertical([yB, xB], board, dispatch) {\n    const [yA, xA] = this.position;\n    let step = 0;\n\n    const animate = () => {\n      if (Math.abs(step) < Math.abs(yB - yA)) {\n        step += (yB - yA) / (0.25 * 60);\n        this.setTransform([xA, yA + step], null, null);\n        window.requestAnimationFrame(animate);\n      } else if (Math.abs(step) >= Math.abs(yB - yA)) {\n        this.setTransform([xB, yB], board, dispatch);\n      }\n    };\n\n    window.requestAnimationFrame(animate);\n  }\n\n  moveDiagonal([yB, xB], board, dispatch) {\n    const [yA, xA] = this.position;\n    let step = 0;\n\n    const animate = () => {\n      if (Math.abs(step) < Math.abs(xB - xA)) {\n        step += (xB - xA) / (0.25 * 60);\n        let y = step / (xB - xA) * (yB - yA) + yA;\n        this.setTransform([xA + step, y], null, null);\n        window.requestAnimationFrame(animate);\n      } else if (Math.abs(step) >= Math.abs(xB - xA)) {\n        this.setTransform([xB, yB], board, dispatch);\n      }\n    };\n\n    window.requestAnimationFrame(animate);\n  }\n\n}\n\nexport default Piece;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/pieces/piece.js"],"names":["Piece","constructor","width","row","col","name","choosenSide","position","side","split","minCol","maxCol","minRow","maxRow","translate","move","x","y","checkValidMove","newRow","newCol","board","curRow","curCol","moveRow","moveCol","valid","existMove","moves","some","putGeneralInDanger","setPosition","capture","translateX","translateY","setNewPosition","turnToMove","Math","floor","countPiecesBetween","count","isGeneralInDanger","i","j","canCaptureGeneral","tmpBoard","reduce","acc","push","updateTmpBoard","canSaveGeneral","piece","console","log","isCheckmated","tmp","animateMove","dispatch","DOMNode","document","querySelector","moveVertical","moveDiagonal","setTransform","xB","yB","yA","xA","setAttribute","type","value","step","animate","abs","window","requestAnimationFrame"],"mappings":"AAAA,MAAMA,KAAN,CAAY;AACVC,EAAAA,WAAW,CAACC,KAAD,EAAQC,GAAR,EAAaC,GAAb,EAAkBC,IAAlB,EAAwBC,WAAxB,EAAqC;AAC9C,SAAKJ,KAAL,GAAaA,KAAb;AACA,SAAKK,QAAL,GAAgB,CAACJ,GAAD,EAAMC,GAAN,CAAhB;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,SAAKG,IAAL,GAAYH,IAAI,CAACI,KAAL,CAAW,GAAX,EAAgB,CAAhB,CAAZ;AACA,SAAKH,WAAL,GAAmBA,WAAnB;AACA,SAAKI,MAAL,GAAc,CAAd;AACA,SAAKC,MAAL,GAAc,CAAd;AACA,SAAKC,MAAL,GAAc,CAAd;AACA,SAAKC,MAAL,GAAc,CAAd;AACA,SAAKC,SAAL,GAAkB,aAAYZ,KAAK,GAAGE,GAAI,KAAIF,KAAK,GAAGC,GAAI,GAA1D;AACD;;AAEDY,EAAAA,IAAI,CAACC,CAAD,EAAIC,CAAJ,EAAO;AACT,UAAMH,SAAS,GAAI,aAAYE,CAAC,GAAG,KAAKd,KAAL,GAAa,CAAE,KAAIe,CAAC,GAAG,KAAKf,KAAL,GAAa,CAAE,GAAzE;AACA,SAAKY,SAAL,GAAiBA,SAAjB;AACD;;AAEDI,EAAAA,cAAc,CAACC,MAAD,EAASC,MAAT,EAAiBC,KAAjB,EAAwB;AACpC,UAAM,CAACC,MAAD,EAASC,MAAT,IAAmB,KAAKhB,QAA9B;AACA,UAAM,CAACiB,OAAD,EAAUC,OAAV,IAAqB,CAACN,MAAM,GAAGG,MAAV,EAAkBF,MAAM,GAAGG,MAA3B,CAA3B;AACA,UAAMG,KAAK,GACTN,MAAM,IAAI,KAAKV,MAAf,IACAU,MAAM,IAAI,KAAKT,MADf,IAEAQ,MAAM,IAAI,KAAKP,MAFf,IAGAO,MAAM,IAAI,KAAKN,MAJjB;AAKA,UAAMc,SAAS,GAAG,KAAKC,KAAL,CAAWC,IAAX,CAAiBd,IAAD,IAAU;AAC1C,aAAOA,IAAI,CAAC,CAAD,CAAJ,KAAYS,OAAZ,IAAuBT,IAAI,CAAC,CAAD,CAAJ,KAAYU,OAA1C;AACD,KAFiB,CAAlB;AAGA,WACEC,KAAK,IAAIC,SAAT,IAAsB,CAAC,KAAKG,kBAAL,CAAwBX,MAAxB,EAAgCC,MAAhC,EAAwCC,KAAxC,CADzB;AAGD;;AAEDU,EAAAA,WAAW,CAACC,OAAD,EAAUb,MAAV,EAAkBC,MAAlB,EAA0B;AACnC,UAAM,CAACa,UAAD,EAAaC,UAAb,IAA2B,CAACd,MAAM,GAAG,KAAKlB,KAAf,EAAsBiB,MAAM,GAAG,KAAKjB,KAApC,CAAjC;AACA,UAAMY,SAAS,GAAI,aAAYmB,UAAW,KAAIC,UAAW,GAAzD;AACA,SAAK3B,QAAL,GAAgB,CAACY,MAAD,EAASC,MAAT,CAAhB;AACA,SAAKN,SAAL,GAAiBA,SAAjB;AACA,WAAO,CAACkB,OAAD,EAAUb,MAAV,EAAkBC,MAAlB,CAAP;AACD;;AAEDe,EAAAA,cAAc,CAACnB,CAAD,EAAIC,CAAJ,EAAOI,KAAP,EAAce,UAAd,EAA0B;AACtC,UAAMhB,MAAM,GAAGiB,IAAI,CAACC,KAAL,CAAWtB,CAAC,GAAG,KAAKd,KAApB,CAAf;AACA,UAAMiB,MAAM,GAAGkB,IAAI,CAACC,KAAL,CAAWrB,CAAC,GAAG,KAAKf,KAApB,CAAf;AACA,UAAM,CAACoB,MAAD,EAASC,MAAT,IAAmB,KAAKhB,QAA9B;AACA,UAAM,CAAC0B,UAAD,EAAaC,UAAb,IAA2B,CAACX,MAAM,GAAG,KAAKrB,KAAf,EAAsBoB,MAAM,GAAG,KAAKpB,KAApC,CAAjC;AACA,SAAKY,SAAL,GAAkB,aAAYmB,UAAW,KAAIC,UAAW,GAAxD;;AACA,QAAIE,UAAU,IAAI,KAAK5B,IAAL,KAAc,KAAKF,WAAL,CAAiB,CAAjB,CAAhC,EAAqD;AACnD,UAAI,KAAKY,cAAL,CAAoBC,MAApB,EAA4BC,MAA5B,EAAoCC,KAApC,CAAJ,EAAgD;AAC9C,YAAI,CAACA,KAAK,CAACF,MAAD,CAAL,CAAcC,MAAd,EAAsBZ,IAA3B,EAAiC;AAC/B,cAAI,KAAK+B,kBAAL,CAAwBpB,MAAxB,EAAgCC,MAAhC,EAAwCC,KAAxC,MAAmD,CAAvD,EACE,OAAO,KAAKU,WAAL,CAAiB,KAAjB,EAAwBZ,MAAxB,EAAgCC,MAAhC,CAAP;AACH,SAHD,MAGO,IAAIC,KAAK,CAACF,MAAD,CAAL,CAAcC,MAAd,EAAsBZ,IAAtB,KAA+Ba,KAAK,CAACC,MAAD,CAAL,CAAcC,MAAd,EAAsBf,IAAzD,EACL,IAAI,KAAK+B,kBAAL,CAAwBpB,MAAxB,EAAgCC,MAAhC,EAAwCC,KAAxC,MAAmD,CAAvD,EACE,OAAO,KAAKU,WAAL,CAAiB,IAAjB,EAAuBZ,MAAvB,EAA+BC,MAA/B,CAAP;AACL;AACF;;AACD,WAAO,IAAP;AACD;;AAEDmB,EAAAA,kBAAkB,CAACpB,MAAD,EAASC,MAAT,EAAiBC,KAAjB,EAAwB;AACxC,QAAI,CAACC,MAAD,EAASC,MAAT,IAAmB,KAAKhB,QAA5B;AACA,QAAIiC,KAAK,GAAG,CAAZ;;AACA,QAAIrB,MAAM,KAAKG,MAAf,EAAuB;AACrB,SAAG;AACDC,QAAAA,MAAM,IAAIA,MAAM,GAAGH,MAAT,GAAkB,CAAC,CAAnB,GAAuB,CAAjC;AACA,YAAIC,KAAK,CAACC,MAAD,CAAL,CAAcC,MAAd,CAAJ,EAA2BiB,KAAK;AACjC,OAHD,QAGSjB,MAAM,KAAKH,MAHpB;AAID,KALD,MAKO;AACL,SAAG;AACDE,QAAAA,MAAM,IAAIA,MAAM,GAAGH,MAAT,GAAkB,CAAC,CAAnB,GAAuB,CAAjC;AACA,YAAIE,KAAK,CAACC,MAAD,CAAL,CAAcC,MAAd,CAAJ,EAA2BiB,KAAK;AACjC,OAHD,QAGSlB,MAAM,KAAKH,MAHpB;AAID;;AACD,WAAOqB,KAAP;AACD;;AAEuB,SAAjBC,iBAAiB,CAACpB,KAAD,EAAQb,IAAR,EAAc;AACpC,SAAK,IAAIkC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC1B,YAAItB,KAAK,CAACqB,CAAD,CAAL,CAASC,CAAT,KAAetB,KAAK,CAACqB,CAAD,CAAL,CAASC,CAAT,EAAYnC,IAAZ,KAAqBA,IAAxC,EACE,IAAIa,KAAK,CAACqB,CAAD,CAAL,CAASC,CAAT,EAAYC,iBAAZ,CAA8BvB,KAA9B,CAAJ,EAA0C,OAAO,IAAP;AAC7C;AACF;;AACD,WAAO,KAAP;AACD;;AAEDS,EAAAA,kBAAkB,CAACX,MAAD,EAASC,MAAT,EAAiBC,KAAjB,EAAwB;AACxC,UAAMwB,QAAQ,GAAGxB,KAAK,CAACyB,MAAN,CAAa,CAACC,GAAD,EAAM5C,GAAN,KAAc;AAC1C4C,MAAAA,GAAG,CAACC,IAAJ,CAAS,CAAC,GAAG7C,GAAJ,CAAT;AACA,aAAO4C,GAAP;AACD,KAHgB,EAGd,EAHc,CAAjB;AAIA,SAAKE,cAAL,CAAoB9B,MAApB,EAA4BC,MAA5B,EAAoCyB,QAApC;;AACA,SAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC1B,YAAIE,QAAQ,CAACH,CAAD,CAAR,CAAYC,CAAZ,KAAkBE,QAAQ,CAACH,CAAD,CAAR,CAAYC,CAAZ,EAAenC,IAAf,KAAwB,KAAKA,IAAnD,EACE,IAAIqC,QAAQ,CAACH,CAAD,CAAR,CAAYC,CAAZ,EAAeC,iBAAf,CAAiCC,QAAjC,CAAJ,EAAgD;AAC9C,iBAAO,IAAP;AACD;AACJ;AACF;;AACD,WAAO,KAAP;AACD;;AAEDK,EAAAA,cAAc,CAACC,KAAD,EAAQ9B,KAAR,EAAe;AAC3B+B,IAAAA,OAAO,CAACC,GAAR,CAAY,kBAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAY,IAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACA,UAAM,CAAC7B,MAAD,EAASC,MAAT,IAAmB4B,KAAK,CAAC5C,QAA/B;;AACA,SAAK,IAAIQ,IAAT,IAAiBoC,KAAK,CAACvB,KAAvB,EAA8B;AAC5B,YAAMiB,QAAQ,GAAGxB,KAAK,CAACyB,MAAN,CAAa,CAACC,GAAD,EAAM5C,GAAN,KAAc;AAC1C4C,QAAAA,GAAG,CAACC,IAAJ,CAAS,CAAC,GAAG7C,GAAJ,CAAT;AACA,eAAO4C,GAAP;AACD,OAHgB,EAGd,EAHc,CAAjB;AAIA,YAAM,CAAC5B,MAAD,EAASC,MAAT,IAAmB,CAACE,MAAM,GAAGP,IAAI,CAAC,CAAD,CAAd,EAAmBQ,MAAM,GAAGR,IAAI,CAAC,CAAD,CAAhC,CAAzB;;AACA,UACEK,MAAM,IAAI+B,KAAK,CAACzC,MAAhB,IACAU,MAAM,IAAI+B,KAAK,CAACxC,MADhB,IAEAQ,MAAM,IAAIgC,KAAK,CAACvC,MAFhB,IAGAO,MAAM,IAAIgC,KAAK,CAACtC,MAJlB,EAKE;AACA,YAAI,CAACgC,QAAQ,CAAC1B,MAAD,CAAR,CAAiBC,MAAjB,CAAL,EAA+B;AAC7B,cAAI+B,KAAK,CAACZ,kBAAN,CAAyBpB,MAAzB,EAAiCC,MAAjC,EAAyCyB,QAAzC,MAAuD,CAA3D,EAA8D;AAC5D,iBAAKI,cAAL,CAAoB9B,MAApB,EAA4BC,MAA5B,EAAoCyB,QAApC;AACA,gBAAI,CAAC7C,KAAK,CAACyC,iBAAN,CAAwBI,QAAxB,EAAkCM,KAAK,CAAC3C,IAAxC,CAAL,EAAoD,OAAO,IAAP;AACrD;AACF,SALD,MAKO,IAAIqC,QAAQ,CAAC1B,MAAD,CAAR,CAAiBC,MAAjB,EAAyBZ,IAAzB,KAAkC2C,KAAK,CAAC3C,IAA5C,EAAkD;AACvD,cAAI2C,KAAK,CAACZ,kBAAN,CAAyBpB,MAAzB,EAAiCC,MAAjC,EAAyCyB,QAAzC,MAAuD,CAA3D,EAA8D;AAC5D,iBAAKI,cAAL,CAAoB9B,MAApB,EAA4BC,MAA5B,EAAoCyB,QAApC;AACA,gBAAI,CAAC7C,KAAK,CAACyC,iBAAN,CAAwBI,QAAxB,EAAkCM,KAAK,CAAC3C,IAAxC,CAAL,EAAoD,OAAO,IAAP;AACrD;AACF;AACF;AACF;;AACD,WAAO,KAAP;AACD;;AAEkB,SAAZ8C,YAAY,CAACjC,KAAD,EAAQb,IAAR,EAAc;AAC/B,QAAIR,KAAK,CAACyC,iBAAN,CAAwBpB,KAAxB,EAA+Bb,IAA/B,CAAJ,EAA0C;AACxC4C,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;;AACA,WAAK,IAAIX,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,EAApB,EAAwBA,CAAC,EAAzB,EAA6B;AAC3B,aAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AAC1B,cAAItB,KAAK,CAACqB,CAAD,CAAL,CAASC,CAAT,KAAetB,KAAK,CAACqB,CAAD,CAAL,CAASC,CAAT,EAAYnC,IAAZ,KAAqBA,IAAxC,EAA8C;AAC5C4C,YAAAA,OAAO,CAACC,GAAR,CAAYhC,KAAK,CAACqB,CAAD,CAAL,CAASC,CAAT,CAAZ;AACA,gBAAItB,KAAK,CAACqB,CAAD,CAAL,CAASC,CAAT,EAAYO,cAAZ,CAA2B7B,KAAK,CAACqB,CAAD,CAAL,CAASC,CAAT,CAA3B,EAAwCtB,KAAxC,CAAJ,EAAoD,OAAO,KAAP;AACrD;AACF;AACF;;AACD,aAAO,IAAP;AACD;;AACD,WAAO,KAAP;AACD;;AAED4B,EAAAA,cAAc,CAAC9B,MAAD,EAASC,MAAT,EAAiByB,QAAjB,EAA2B;AACvC,UAAM,CAACvB,MAAD,EAASC,MAAT,IAAmB,KAAKhB,QAA9B;AACA,UAAMgD,GAAG,GAAGV,QAAQ,CAACvB,MAAD,CAAR,CAAiBC,MAAjB,CAAZ;AACAsB,IAAAA,QAAQ,CAACvB,MAAD,CAAR,CAAiBC,MAAjB,IAA2B,CAA3B;AACAsB,IAAAA,QAAQ,CAAC1B,MAAD,CAAR,CAAiBC,MAAjB,IAA2BmC,GAA3B;AACD;;AAEDX,EAAAA,iBAAiB,CAACC,QAAD,EAAW;AAC1B,UAAM,CAACvB,MAAD,EAASC,MAAT,IAAmB,KAAKhB,QAA9B;;AACA,SAAK,IAAIQ,IAAT,IAAiB,KAAKa,KAAtB,EAA6B;AAC3B,YAAM,CAACT,MAAD,EAASC,MAAT,IAAmB,CAACE,MAAM,GAAGP,IAAI,CAAC,CAAD,CAAd,EAAmBQ,MAAM,GAAGR,IAAI,CAAC,CAAD,CAAhC,CAAzB;;AACA,UAAIK,MAAM,IAAI,CAAV,IAAeA,MAAM,GAAG,CAAxB,IAA6BD,MAAM,IAAI,CAAvC,IAA4CA,MAAM,GAAG,EAAzD,EAA6D;AAC3D,YAAI0B,QAAQ,CAAC1B,MAAD,CAAR,CAAiBC,MAAjB,EAAyBZ,IAA7B,EACE,IAAIqC,QAAQ,CAAC1B,MAAD,CAAR,CAAiBC,MAAjB,EAAyBZ,IAAzB,KAAkCqC,QAAQ,CAACvB,MAAD,CAAR,CAAiBC,MAAjB,EAAyBf,IAA/D,EACE,IAAI,KAAK+B,kBAAL,CAAwBpB,MAAxB,EAAgCC,MAAhC,EAAwCyB,QAAxC,MAAsD,CAA1D,EACE,IAAIA,QAAQ,CAAC1B,MAAD,CAAR,CAAiBC,MAAjB,EAAyBf,IAAzB,CAA8BI,KAA9B,CAAoC,GAApC,EAAyC,CAAzC,MAAgD,SAApD,EACE,OAAO,IAAP;AACT;AACF;AACF;;AAED+C,EAAAA,WAAW,CAAC,CAACrC,MAAD,EAASC,MAAT,CAAD,EAAmBC,KAAnB,EAA0BoC,QAA1B,EAAoC;AAC7C,UAAM,CAACnC,MAAD,EAASC,MAAT,IAAmB,KAAKhB,QAA9B;AACA,SAAKmD,OAAL,GAAeC,QAAQ,CAACC,aAAT,CAAwB,KAAItC,MAAO,GAAEC,MAAO,EAA5C,CAAf;;AACA,QAAIA,MAAM,KAAKH,MAAf,EAAuB;AACrB,WAAKyC,YAAL,CAAkB,CAAC1C,MAAD,EAASC,MAAT,CAAlB,EAAoCC,KAApC,EAA2CoC,QAA3C;AACD,KAFD,MAEO,KAAKK,YAAL,CAAkB,CAAC3C,MAAD,EAASC,MAAT,CAAlB,EAAoCC,KAApC,EAA2CoC,QAA3C;AACR;;AAEDM,EAAAA,YAAY,CAAC,CAACC,EAAD,EAAKC,EAAL,CAAD,EAAW5C,KAAX,EAAkBoC,QAAlB,EAA4B;AACtC,UAAM,CAACS,EAAD,EAAKC,EAAL,IAAW,KAAK5D,QAAtB;AACA,UAAMO,SAAS,GAAI,aAAYkD,EAAE,GAAG,KAAK9D,KAAM,KAAI+D,EAAE,GAAG,KAAK/D,KAAM,GAAnE;AACA,SAAKwD,OAAL,CAAaU,YAAb,CAA0B,WAA1B,EAAuCtD,SAAvC;;AACA,QAAIO,KAAJ,EAAW;AACT,WAAKU,WAAL,CAAiB,IAAjB,EAAuBkC,EAAvB,EAA2BD,EAA3B;AACA,YAAMT,GAAG,GAAGlC,KAAK,CAAC6C,EAAD,CAAL,CAAUC,EAAV,CAAZ;AACA,UAAI9C,KAAK,CAAC4C,EAAD,CAAL,CAAUD,EAAV,CAAJ,EACEP,QAAQ,CAAC;AAAEY,QAAAA,IAAI,EAAE,mBAAR;AAA6BC,QAAAA,KAAK,EAAEjD,KAAK,CAAC4C,EAAD,CAAL,CAAUD,EAAV;AAApC,OAAD,CAAR;AACF3C,MAAAA,KAAK,CAAC6C,EAAD,CAAL,CAAUC,EAAV,IAAgB,CAAhB;AACA9C,MAAAA,KAAK,CAAC4C,EAAD,CAAL,CAAUD,EAAV,IAAgBT,GAAhB;AACAE,MAAAA,QAAQ,CAAC;AAAEY,QAAAA,IAAI,EAAE,eAAR;AAAyBC,QAAAA,KAAK,EAAE;AAAhC,OAAD,CAAR;AACAb,MAAAA,QAAQ,CAAC;AAAEY,QAAAA,IAAI,EAAE,UAAR;AAAoBC,QAAAA,KAAK,EAAE,CAAC,GAAGjD,KAAJ;AAA3B,OAAD,CAAR;AACD;AACF;;AAEDwC,EAAAA,YAAY,CAAC,CAACI,EAAD,EAAKD,EAAL,CAAD,EAAW3C,KAAX,EAAkBoC,QAAlB,EAA4B;AACtC,UAAM,CAACS,EAAD,EAAKC,EAAL,IAAW,KAAK5D,QAAtB;AACA,QAAIgE,IAAI,GAAG,CAAX;;AAEA,UAAMC,OAAO,GAAG,MAAM;AACpB,UAAInC,IAAI,CAACoC,GAAL,CAASF,IAAT,IAAiBlC,IAAI,CAACoC,GAAL,CAASR,EAAE,GAAGC,EAAd,CAArB,EAAwC;AACtCK,QAAAA,IAAI,IAAI,CAACN,EAAE,GAAGC,EAAN,KAAa,OAAO,EAApB,CAAR;AACA,aAAKH,YAAL,CAAkB,CAACI,EAAD,EAAKD,EAAE,GAAGK,IAAV,CAAlB,EAAmC,IAAnC,EAAyC,IAAzC;AACAG,QAAAA,MAAM,CAACC,qBAAP,CAA6BH,OAA7B;AACD,OAJD,MAIO,IAAInC,IAAI,CAACoC,GAAL,CAASF,IAAT,KAAkBlC,IAAI,CAACoC,GAAL,CAASR,EAAE,GAAGC,EAAd,CAAtB,EAAyC;AAC9C,aAAKH,YAAL,CAAkB,CAACC,EAAD,EAAKC,EAAL,CAAlB,EAA4B5C,KAA5B,EAAmCoC,QAAnC;AACD;AACF,KARD;;AAUAiB,IAAAA,MAAM,CAACC,qBAAP,CAA6BH,OAA7B;AACD;;AAEDV,EAAAA,YAAY,CAAC,CAACG,EAAD,EAAKD,EAAL,CAAD,EAAW3C,KAAX,EAAkBoC,QAAlB,EAA4B;AACtC,UAAM,CAACS,EAAD,EAAKC,EAAL,IAAW,KAAK5D,QAAtB;AACA,QAAIgE,IAAI,GAAG,CAAX;;AAEA,UAAMC,OAAO,GAAG,MAAM;AACpB,UAAInC,IAAI,CAACoC,GAAL,CAASF,IAAT,IAAiBlC,IAAI,CAACoC,GAAL,CAAST,EAAE,GAAGG,EAAd,CAArB,EAAwC;AACtCI,QAAAA,IAAI,IAAI,CAACP,EAAE,GAAGG,EAAN,KAAa,OAAO,EAApB,CAAR;AACA,YAAIlD,CAAC,GAAIsD,IAAI,IAAIP,EAAE,GAAGG,EAAT,CAAL,IAAsBF,EAAE,GAAGC,EAA3B,IAAiCA,EAAzC;AACA,aAAKH,YAAL,CAAkB,CAACI,EAAE,GAAGI,IAAN,EAAYtD,CAAZ,CAAlB,EAAkC,IAAlC,EAAwC,IAAxC;AACAyD,QAAAA,MAAM,CAACC,qBAAP,CAA6BH,OAA7B;AACD,OALD,MAKO,IAAInC,IAAI,CAACoC,GAAL,CAASF,IAAT,KAAkBlC,IAAI,CAACoC,GAAL,CAAST,EAAE,GAAGG,EAAd,CAAtB,EAAyC;AAC9C,aAAKJ,YAAL,CAAkB,CAACC,EAAD,EAAKC,EAAL,CAAlB,EAA4B5C,KAA5B,EAAmCoC,QAAnC;AACD;AACF,KATD;;AAWAiB,IAAAA,MAAM,CAACC,qBAAP,CAA6BH,OAA7B;AACD;;AAzOS;;AA4OZ,eAAexE,KAAf","sourcesContent":["class Piece {\r\n  constructor(width, row, col, name, choosenSide) {\r\n    this.width = width;\r\n    this.position = [row, col];\r\n    this.name = name;\r\n    this.side = name.split(\"-\")[1];\r\n    this.choosenSide = choosenSide;\r\n    this.minCol = 0;\r\n    this.maxCol = 8;\r\n    this.minRow = 0;\r\n    this.maxRow = 9;\r\n    this.translate = `translate(${width * col}, ${width * row})`;\r\n  }\r\n\r\n  move(x, y) {\r\n    const translate = `translate(${x - this.width / 2}, ${y - this.width / 2})`;\r\n    this.translate = translate;\r\n  }\r\n\r\n  checkValidMove(newRow, newCol, board) {\r\n    const [curRow, curCol] = this.position;\r\n    const [moveRow, moveCol] = [newRow - curRow, newCol - curCol];\r\n    const valid =\r\n      newCol >= this.minCol &&\r\n      newCol <= this.maxCol &&\r\n      newRow >= this.minRow &&\r\n      newRow <= this.maxRow;\r\n    const existMove = this.moves.some((move) => {\r\n      return move[0] === moveRow && move[1] === moveCol;\r\n    });\r\n    return (\r\n      valid && existMove && !this.putGeneralInDanger(newRow, newCol, board)\r\n    );\r\n  }\r\n\r\n  setPosition(capture, newRow, newCol) {\r\n    const [translateX, translateY] = [newCol * this.width, newRow * this.width];\r\n    const translate = `translate(${translateX}, ${translateY})`;\r\n    this.position = [newRow, newCol];\r\n    this.translate = translate;\r\n    return [capture, newRow, newCol];\r\n  }\r\n\r\n  setNewPosition(x, y, board, turnToMove) {\r\n    const newCol = Math.floor(x / this.width);\r\n    const newRow = Math.floor(y / this.width);\r\n    const [curRow, curCol] = this.position;\r\n    const [translateX, translateY] = [curCol * this.width, curRow * this.width];\r\n    this.translate = `translate(${translateX}, ${translateY})`;\r\n    if (turnToMove && this.side === this.choosenSide[1]) {\r\n      if (this.checkValidMove(newRow, newCol, board)) {\r\n        if (!board[newRow][newCol].side) {\r\n          if (this.countPiecesBetween(newRow, newCol, board) === 0)\r\n            return this.setPosition(false, newRow, newCol);\r\n        } else if (board[newRow][newCol].side !== board[curRow][curCol].side)\r\n          if (this.countPiecesBetween(newRow, newCol, board) === 1)\r\n            return this.setPosition(true, newRow, newCol);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  countPiecesBetween(newRow, newCol, board) {\r\n    let [curRow, curCol] = this.position;\r\n    let count = 0;\r\n    if (newRow === curRow) {\r\n      do {\r\n        curCol += curCol > newCol ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curCol !== newCol);\r\n    } else {\r\n      do {\r\n        curRow += curRow > newRow ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curRow !== newRow);\r\n    }\r\n    return count;\r\n  }\r\n\r\n  static isGeneralInDanger(board, side) {\r\n    for (let i = 0; i < 10; i++) {\r\n      for (let j = 0; j < 9; j++) {\r\n        if (board[i][j] && board[i][j].side !== side)\r\n          if (board[i][j].canCaptureGeneral(board)) return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  putGeneralInDanger(newRow, newCol, board) {\r\n    const tmpBoard = board.reduce((acc, row) => {\r\n      acc.push([...row]);\r\n      return acc;\r\n    }, []);\r\n    this.updateTmpBoard(newRow, newCol, tmpBoard);\r\n    for (let i = 0; i < 10; i++) {\r\n      for (let j = 0; j < 9; j++) {\r\n        if (tmpBoard[i][j] && tmpBoard[i][j].side !== this.side)\r\n          if (tmpBoard[i][j].canCaptureGeneral(tmpBoard)) {\r\n            return true;\r\n          }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  canSaveGeneral(piece, board) {\r\n    console.log(\"can save general\");\r\n    console.log(this);\r\n    console.log(piece);\r\n    const [curRow, curCol] = piece.position;\r\n    for (let move of piece.moves) {\r\n      const tmpBoard = board.reduce((acc, row) => {\r\n        acc.push([...row]);\r\n        return acc;\r\n      }, []);\r\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n      if (\r\n        newCol >= piece.minCol &&\r\n        newCol <= piece.maxCol &&\r\n        newRow >= piece.minRow &&\r\n        newRow <= piece.maxRow\r\n      ) {\r\n        if (!tmpBoard[newRow][newCol]) {\r\n          if (piece.countPiecesBetween(newRow, newCol, tmpBoard) === 0) {\r\n            this.updateTmpBoard(newRow, newCol, tmpBoard);\r\n            if (!Piece.isGeneralInDanger(tmpBoard, piece.side)) return true;\r\n          }\r\n        } else if (tmpBoard[newRow][newCol].side !== piece.side) {\r\n          if (piece.countPiecesBetween(newRow, newCol, tmpBoard) === 1) {\r\n            this.updateTmpBoard(newRow, newCol, tmpBoard);\r\n            if (!Piece.isGeneralInDanger(tmpBoard, piece.side)) return true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  static isCheckmated(board, side) {\r\n    if (Piece.isGeneralInDanger(board, side)) {\r\n      console.log(\"in danger\");\r\n      for (let i = 0; i < 10; i++) {\r\n        for (let j = 0; j < 9; j++) {\r\n          if (board[i][j] && board[i][j].side === side) {\r\n            console.log(board[i][j]);\r\n            if (board[i][j].canSaveGeneral(board[i][j], board)) return false;\r\n          }\r\n        }\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  updateTmpBoard(newRow, newCol, tmpBoard) {\r\n    const [curRow, curCol] = this.position;\r\n    const tmp = tmpBoard[curRow][curCol];\r\n    tmpBoard[curRow][curCol] = 0;\r\n    tmpBoard[newRow][newCol] = tmp;\r\n  }\r\n\r\n  canCaptureGeneral(tmpBoard) {\r\n    const [curRow, curCol] = this.position;\r\n    for (let move of this.moves) {\r\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n      if (newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10) {\r\n        if (tmpBoard[newRow][newCol].side)\r\n          if (tmpBoard[newRow][newCol].side !== tmpBoard[curRow][curCol].side)\r\n            if (this.countPiecesBetween(newRow, newCol, tmpBoard) === 1)\r\n              if (tmpBoard[newRow][newCol].name.split(\"-\")[0] === \"general\")\r\n                return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  animateMove([newRow, newCol], board, dispatch) {\r\n    const [curRow, curCol] = this.position;\r\n    this.DOMNode = document.querySelector(`#p${curRow}${curCol}`);\r\n    if (curCol === newCol) {\r\n      this.moveVertical([newRow, newCol], board, dispatch);\r\n    } else this.moveDiagonal([newRow, newCol], board, dispatch);\r\n  }\r\n\r\n  setTransform([xB, yB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    const translate = `translate(${xB * this.width}, ${yB * this.width})`;\r\n    this.DOMNode.setAttribute(\"transform\", translate);\r\n    if (board) {\r\n      this.setPosition(null, yB, xB);\r\n      const tmp = board[yA][xA];\r\n      if (board[yB][xB])\r\n        dispatch({ type: \"setCapturedPieces\", value: board[yB][xB] });\r\n      board[yA][xA] = 0;\r\n      board[yB][xB] = tmp;\r\n      dispatch({ type: \"setTurnToMove\", value: true });\r\n      dispatch({ type: \"setBoard\", value: [...board] });\r\n    }\r\n  }\r\n\r\n  moveVertical([yB, xB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    let step = 0;\r\n\r\n    const animate = () => {\r\n      if (Math.abs(step) < Math.abs(yB - yA)) {\r\n        step += (yB - yA) / (0.25 * 60);\r\n        this.setTransform([xA, yA + step], null, null);\r\n        window.requestAnimationFrame(animate);\r\n      } else if (Math.abs(step) >= Math.abs(yB - yA)) {\r\n        this.setTransform([xB, yB], board, dispatch);\r\n      }\r\n    };\r\n\r\n    window.requestAnimationFrame(animate);\r\n  }\r\n\r\n  moveDiagonal([yB, xB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    let step = 0;\r\n\r\n    const animate = () => {\r\n      if (Math.abs(step) < Math.abs(xB - xA)) {\r\n        step += (xB - xA) / (0.25 * 60);\r\n        let y = (step / (xB - xA)) * (yB - yA) + yA;\r\n        this.setTransform([xA + step, y], null, null);\r\n        window.requestAnimationFrame(animate);\r\n      } else if (Math.abs(step) >= Math.abs(xB - xA)) {\r\n        this.setTransform([xB, yB], board, dispatch);\r\n      }\r\n    };\r\n\r\n    window.requestAnimationFrame(animate);\r\n  }\r\n}\r\n\r\nexport default Piece;\r\n"]},"metadata":{},"sourceType":"module"}