{"ast":null,"code":"import _toConsumableArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useContext,useState}from\"react\";import Piece from\"./Piece/Piece.jsx\";import\"./Board.scss\";import{useSelector,useDispatch}from\"react-redux\";import getSVGLocation from\"./getSVGLocation.js\";import{SocketContext,SetMoveTimerContext}from\"../../../App/context.js\";import PieceClass from\"../../../../pieces/piece.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Board(){var dispatch=useDispatch();var board=useSelector(function(state){return state.boardState.board;});var targetDisplay=useSelector(function(state){return state.boardState.targetDisplay;});var boardSize=useSelector(function(state){return state.boardState.boardSize;});var currentPiece=useSelector(function(state){return state.boardState.currentPiece;});var getClicked=useSelector(function(state){return state.boardState.getClicked;});var draggable=useSelector(function(state){return state.boardState.draggable;});var _useState=useState(\"none\"),_useState2=_slicedToArray(_useState,2),warningDisplay=_useState2[0],setWarningDisplay=_useState2[1];var _useState3=useState(\"translate(0, 0)\"),_useState4=_slicedToArray(_useState3,2),warningTranslate=_useState4[0],setWarningTranslate=_useState4[1];var side=useSelector(function(state){return state.boardState.side;});var svgRef=useRef();var targetTranslate=useSelector(function(state){return state.boardState.targetTranslate;});var turnToMove=useSelector(function(state){return state.boardState.turnToMove;});var socket=useContext(SocketContext);var setMoveTimer=useContext(SetMoveTimerContext);var opponentInfo=useSelector(function(state){return state.gameState.opponentInfo;});var handleMouseDown=function handleMouseDown(event){var elementId=event.currentTarget.id;var row=+elementId[1],col=+elementId[2];var translate=board[row][col].translate;if(!currentPiece||board[row][col].side===currentPiece.side){if(currentPiece){var _currentPiece$positio=_slicedToArray(currentPiece.position,2),curRow=_currentPiece$positio[0],curCol=_currentPiece$positio[1];if(row!==curRow||curCol!==col){dispatch({type:\"setGetClicked\",value:false});}}dispatch({type:\"setTargetDisplay\",value:\"inline\"});dispatch({type:\"setDraggable\",value:true});dispatch({type:\"setTargetTranslate\",value:translate});dispatch({type:\"setCurrentPiece\",value:board[row][col]});}};var updateBoard=function updateBoard(moveResult,_ref){var _ref2=_slicedToArray(_ref,2),curRow=_ref2[0],curCol=_ref2[1];if(moveResult&&!/translate/.test(moveResult)){var _moveResult=_slicedToArray(moveResult,3),capture=_moveResult[0],newRow=_moveResult[1],newCol=_moveResult[2];if(capture){dispatch({type:\"setCapturedPieces\",value:board[newRow][newCol]});}board[curRow][curCol]=0;board[newRow][newCol]=currentPiece;}else if(moveResult){setTimeout(function(){setWarningDisplay(\"none\");},400);setWarningDisplay(\"inline\");setWarningTranslate(moveResult);}};var handleOpponentMove=function handleOpponentMove(_ref3,_ref4){var _ref5=_slicedToArray(_ref3,2),curRow=_ref5[0],curCol=_ref5[1];var _ref6=_slicedToArray(_ref4,2),newRow=_ref6[0],newCol=_ref6[1];if(board[curRow][curCol]&&board[curRow][curCol].side===side[0]){board[curRow][curCol].animateMove([newRow,newCol],board,dispatch);setMoveTimer(true,false,dispatch);}};var updateCurrentPiece=function updateCurrentPiece(moveResult){if(moveResult&&!/translate/.test(moveResult)||getClicked){dispatch({type:\"setTargetDisplay\",value:\"none\"});dispatch({type:\"setCurrentPiece\",value:null});dispatch({type:\"setGetClicked\",value:false});}else{dispatch({type:\"setGetClicked\",value:true});}};var handleMouseUp=function handleMouseUp(event){if(currentPiece){var moveResult=null;var svg=svgRef.current;var _getSVGLocation=getSVGLocation(+event.clientX,+event.clientY,svg),_getSVGLocation2=_slicedToArray(_getSVGLocation,2),x=_getSVGLocation2[0],y=_getSVGLocation2[1];var newCol=Math.floor(x/currentPiece.width);var newRow=Math.floor(y/currentPiece.width);var _currentPiece$positio2=_slicedToArray(currentPiece.position,2),curRow=_currentPiece$positio2[0],curCol=_currentPiece$positio2[1];var canMove=currentPiece.canMoveToNewPosition(newRow,newCol,board);if(turnToMove&&canMove&&!/translate/.test(canMove))moveResult=currentPiece.setPosition(canMove,newRow,newCol);else if(/translate/.test(canMove))moveResult=canMove;updateBoard(moveResult,[curRow,curCol]);dispatch({type:\"setDraggable\",value:false});updateCurrentPiece(moveResult);dispatch({type:\"setBoard\",value:_toConsumableArray(board)});if(moveResult&&!/translate/.test(moveResult)){dispatch({type:\"setTurnToMove\",value:!turnToMove});setMoveTimer(false,false,dispatch);socket.emit(\"opponentMove\",moveResult,[curRow,curCol]);}}};var handleMouseMove=function handleMouseMove(event){var svg=svgRef.current;var _getSVGLocation3=getSVGLocation(+event.clientX,+event.clientY,svg),_getSVGLocation4=_slicedToArray(_getSVGLocation3,2),x=_getSVGLocation4[0],y=_getSVGLocation4[1];if(x>=0&&x<boardSize[0]&&y>=0&&y<boardSize[1]&&draggable){currentPiece.move(x,y,board);dispatch({type:\"setBoard\",value:_toConsumableArray(board)});}};var moveOnClick=function moveOnClick(currentPiece,x,y){var moveResult=null;var _currentPiece$positio3=_slicedToArray(currentPiece.position,2),curRow=_currentPiece$positio3[0],curCol=_currentPiece$positio3[1];var newCol=Math.floor(x/currentPiece.width);var newRow=Math.floor(y/currentPiece.width);var canMove=currentPiece.canMoveToNewPosition(newRow,newCol,board);if(turnToMove&&canMove&&!/translate/.test(canMove))moveResult=currentPiece.setPosition(canMove,newRow,newCol);updateBoard(moveResult,[curRow,curCol]);dispatch({type:\"setTargetDisplay\",value:\"none\"});dispatch({type:\"setCurrentPiece\",value:null});dispatch({type:\"setBoard\",value:_toConsumableArray(board)});if(moveResult&&!/translate/.test(moveResult)){dispatch({type:\"setTurnToMove\",value:!turnToMove});setMoveTimer(false,false,dispatch);socket.emit(\"opponentMove\",moveResult,[curRow,curCol]);}};var handleClick=function handleClick(event){if(currentPiece){var svg=svgRef.current;var _getSVGLocation5=getSVGLocation(+event.clientX,+event.clientY,svg),_getSVGLocation6=_slicedToArray(_getSVGLocation5,2),x=_getSVGLocation6[0],y=_getSVGLocation6[1];if(!event.target.id)moveOnClick(currentPiece,x,y);}};var constructNewBoard=function constructNewBoard(width){var newBoard=board.map(function(row){var newRow=row.map(function(piece){if(piece){var _piece$position=_slicedToArray(piece.position,2),_row=_piece$position[0],col=_piece$position[1];piece.width=width;piece.translate=\"translate(\".concat(width*col,\", \").concat(width*_row,\")\");return piece;}return 0;});return newRow;});return newBoard;};var handleResize=function handleResize(){var width=document.querySelector(\".board-container\").offsetWidth;dispatch({type:\"setBoardSize\",value:[width,width/(521/577)]});dispatch({type:\"setBoard\",value:constructNewBoard(width/9)});};useEffect(function(){var width=document.querySelector(\".board-container\").offsetWidth;dispatch({type:\"setBoardSize\",value:[width,width/(521/577)]});dispatch({type:\"setBoard\",value:constructNewBoard(width/9)});window.ondragstart=function(){return false;};},[]);useEffect(function(){window.onmousemove=handleMouseMove;window.onmouseup=handleMouseUp;window.onresize=handleResize;socket.on(\"move\",function(_ref7,_ref8){var _ref9=_slicedToArray(_ref7,2),curRow=_ref9[0],curCol=_ref9[1];var _ref10=_slicedToArray(_ref8,2),newRow=_ref10[0],newCol=_ref10[1];handleOpponentMove([curRow,curCol],[newRow,newCol]);});return function(){window.onmouseup=null;window.onmousemove=null;window.onresize=null;socket.removeAllListeners(\"move\");};});useEffect(function(){if(turnToMove){var lostReason=PieceClass.isLost(board,side[1]);if(lostReason){var listItemRef=/*#__PURE__*/React.createRef();dispatch({type:\"setGameResult\",value:\"Lose\"});dispatch({type:\"setMessage\",value:{type:\"game result message\",winner:\"\".concat(opponentInfo.playername,\" Won - \"),reason:lostReason,className:\"game-message\",ref:listItemRef}});setMoveTimer(null,true,dispatch);socket.emit(\"gameFinish\",[\"Won\",lostReason]);}}},[turnToMove]);return/*#__PURE__*/_jsxs(\"svg\",{width:boardSize[0],height:boardSize[1],onClick:handleClick,style:{backgroundImage:'url(\"/images/Board/board.jpg\")'},ref:svgRef,children:[/*#__PURE__*/_jsx(\"image\",{href:\"/images/Target_Icon/target.gif\",width:boardSize[0]/9-3,height:boardSize[0]/9-3,style:{display:targetDisplay},transform:targetTranslate}),/*#__PURE__*/_jsx(\"rect\",{width:boardSize[0]/9-3,height:boardSize[0]/9-3,style:{display:warningDisplay},transform:warningTranslate,fill:\"brown\"}),/*#__PURE__*/_jsx(Piece,{board:board,handleMouseDown:handleMouseDown})]});}export default/*#__PURE__*/React.memo(Board);","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/Components/Main/Game/Board/Board.jsx"],"names":["React","useEffect","useRef","useContext","useState","Piece","useSelector","useDispatch","getSVGLocation","SocketContext","SetMoveTimerContext","PieceClass","Board","dispatch","board","state","boardState","targetDisplay","boardSize","currentPiece","getClicked","draggable","warningDisplay","setWarningDisplay","warningTranslate","setWarningTranslate","side","svgRef","targetTranslate","turnToMove","socket","setMoveTimer","opponentInfo","gameState","handleMouseDown","event","elementId","currentTarget","id","row","col","translate","position","curRow","curCol","type","value","updateBoard","moveResult","test","capture","newRow","newCol","setTimeout","handleOpponentMove","animateMove","updateCurrentPiece","handleMouseUp","svg","current","clientX","clientY","x","y","Math","floor","width","canMove","canMoveToNewPosition","setPosition","emit","handleMouseMove","move","moveOnClick","handleClick","target","constructNewBoard","newBoard","map","piece","handleResize","document","querySelector","offsetWidth","window","ondragstart","onmousemove","onmouseup","onresize","on","removeAllListeners","lostReason","isLost","listItemRef","createRef","winner","playername","reason","className","ref","backgroundImage","display","memo"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useContext, useState } from \"react\";\r\nimport Piece from \"./Piece/Piece.jsx\";\r\nimport \"./Board.scss\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport getSVGLocation from \"./getSVGLocation.js\";\r\nimport { SocketContext, SetMoveTimerContext } from \"../../../App/context.js\";\r\nimport PieceClass from \"../../../../pieces/piece.js\";\r\n\r\nfunction Board() {\r\n  const dispatch = useDispatch();\r\n  const board = useSelector((state) => state.boardState.board);\r\n  const targetDisplay = useSelector((state) => state.boardState.targetDisplay);\r\n  const boardSize = useSelector((state) => state.boardState.boardSize);\r\n  const currentPiece = useSelector((state) => state.boardState.currentPiece);\r\n  const getClicked = useSelector((state) => state.boardState.getClicked);\r\n  const draggable = useSelector((state) => state.boardState.draggable);\r\n  const [warningDisplay, setWarningDisplay] = useState(\"none\");\r\n  const [warningTranslate, setWarningTranslate] = useState(\"translate(0, 0)\");\r\n  const side = useSelector((state) => state.boardState.side);\r\n  const svgRef = useRef();\r\n  const targetTranslate = useSelector(\r\n    (state) => state.boardState.targetTranslate\r\n  );\r\n  const turnToMove = useSelector((state) => state.boardState.turnToMove);\r\n  const socket = useContext(SocketContext);\r\n  const setMoveTimer = useContext(SetMoveTimerContext);\r\n\r\n  const opponentInfo = useSelector((state) => state.gameState.opponentInfo);\r\n\r\n  const handleMouseDown = (event) => {\r\n    const elementId = event.currentTarget.id;\r\n    const [row, col] = [+elementId[1], +elementId[2]];\r\n    const translate = board[row][col].translate;\r\n    if (!currentPiece || board[row][col].side === currentPiece.side) {\r\n      if (currentPiece) {\r\n        const [curRow, curCol] = currentPiece.position;\r\n        if (row !== curRow || curCol !== col) {\r\n          dispatch({ type: \"setGetClicked\", value: false });\r\n        }\r\n      }\r\n      dispatch({ type: \"setTargetDisplay\", value: \"inline\" });\r\n      dispatch({ type: \"setDraggable\", value: true });\r\n      dispatch({ type: \"setTargetTranslate\", value: translate });\r\n      dispatch({ type: \"setCurrentPiece\", value: board[row][col] });\r\n    }\r\n  };\r\n\r\n  const updateBoard = (moveResult, [curRow, curCol]) => {\r\n    if (moveResult && !/translate/.test(moveResult)) {\r\n      const [capture, newRow, newCol] = moveResult;\r\n      if (capture) {\r\n        dispatch({ type: \"setCapturedPieces\", value: board[newRow][newCol] });\r\n      }\r\n      board[curRow][curCol] = 0;\r\n      board[newRow][newCol] = currentPiece;\r\n    } else if (moveResult) {\r\n      setTimeout(() => {\r\n        setWarningDisplay(\"none\");\r\n      }, 400);\r\n      setWarningDisplay(\"inline\");\r\n      setWarningTranslate(moveResult);\r\n    }\r\n  };\r\n\r\n  const handleOpponentMove = ([curRow, curCol], [newRow, newCol]) => {\r\n    if (board[curRow][curCol] && board[curRow][curCol].side === side[0]) {\r\n      board[curRow][curCol].animateMove([newRow, newCol], board, dispatch);\r\n      setMoveTimer(true, false, dispatch);\r\n    }\r\n  };\r\n\r\n  const updateCurrentPiece = (moveResult) => {\r\n    if ((moveResult && !/translate/.test(moveResult)) || getClicked) {\r\n      dispatch({ type: \"setTargetDisplay\", value: \"none\" });\r\n      dispatch({ type: \"setCurrentPiece\", value: null });\r\n      dispatch({ type: \"setGetClicked\", value: false });\r\n    } else {\r\n      dispatch({ type: \"setGetClicked\", value: true });\r\n    }\r\n  };\r\n\r\n  const handleMouseUp = (event) => {\r\n    if (currentPiece) {\r\n      let moveResult = null;\r\n      const svg = svgRef.current;\r\n      const [x, y] = getSVGLocation(+event.clientX, +event.clientY, svg);\r\n      const newCol = Math.floor(x / currentPiece.width);\r\n      const newRow = Math.floor(y / currentPiece.width);\r\n      const [curRow, curCol] = currentPiece.position;\r\n      const canMove = currentPiece.canMoveToNewPosition(newRow, newCol, board);\r\n      if (turnToMove && canMove && !/translate/.test(canMove))\r\n        moveResult = currentPiece.setPosition(canMove, newRow, newCol);\r\n      else if (/translate/.test(canMove)) moveResult = canMove;\r\n      updateBoard(moveResult, [curRow, curCol]);\r\n      dispatch({ type: \"setDraggable\", value: false });\r\n      updateCurrentPiece(moveResult);\r\n      dispatch({ type: \"setBoard\", value: [...board] });\r\n      if (moveResult && !/translate/.test(moveResult)) {\r\n        dispatch({ type: \"setTurnToMove\", value: !turnToMove });\r\n        setMoveTimer(false, false, dispatch);\r\n        socket.emit(\"opponentMove\", moveResult, [curRow, curCol]);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleMouseMove = (event) => {\r\n    const svg = svgRef.current;\r\n    const [x, y] = getSVGLocation(+event.clientX, +event.clientY, svg);\r\n    if (x >= 0 && x < boardSize[0] && y >= 0 && y < boardSize[1] && draggable) {\r\n      currentPiece.move(x, y, board);\r\n      dispatch({ type: \"setBoard\", value: [...board] });\r\n    }\r\n  };\r\n\r\n  const moveOnClick = (currentPiece, x, y) => {\r\n    let moveResult = null;\r\n    const [curRow, curCol] = currentPiece.position;\r\n    const newCol = Math.floor(x / currentPiece.width);\r\n    const newRow = Math.floor(y / currentPiece.width);\r\n    const canMove = currentPiece.canMoveToNewPosition(newRow, newCol, board);\r\n    if (turnToMove && canMove && !/translate/.test(canMove))\r\n      moveResult = currentPiece.setPosition(canMove, newRow, newCol);\r\n    updateBoard(moveResult, [curRow, curCol]);\r\n    dispatch({ type: \"setTargetDisplay\", value: \"none\" });\r\n    dispatch({ type: \"setCurrentPiece\", value: null });\r\n    dispatch({ type: \"setBoard\", value: [...board] });\r\n    if (moveResult && !/translate/.test(moveResult)) {\r\n      dispatch({ type: \"setTurnToMove\", value: !turnToMove });\r\n      setMoveTimer(false, false, dispatch);\r\n      socket.emit(\"opponentMove\", moveResult, [curRow, curCol]);\r\n    }\r\n  };\r\n\r\n  const handleClick = (event) => {\r\n    if (currentPiece) {\r\n      const svg = svgRef.current;\r\n      const [x, y] = getSVGLocation(+event.clientX, +event.clientY, svg);\r\n      if (!event.target.id) moveOnClick(currentPiece, x, y);\r\n    }\r\n  };\r\n\r\n  const constructNewBoard = (width) => {\r\n    const newBoard = board.map((row) => {\r\n      const newRow = row.map((piece) => {\r\n        if (piece) {\r\n          const [row, col] = piece.position;\r\n          piece.width = width;\r\n          piece.translate = `translate(${width * col}, ${width * row})`;\r\n          return piece;\r\n        }\r\n        return 0;\r\n      });\r\n      return newRow;\r\n    });\r\n    return newBoard;\r\n  };\r\n\r\n  const handleResize = () => {\r\n    const width = document.querySelector(\".board-container\").offsetWidth;\r\n    dispatch({\r\n      type: \"setBoardSize\",\r\n      value: [width, width / (521 / 577)],\r\n    });\r\n    dispatch({\r\n      type: \"setBoard\",\r\n      value: constructNewBoard(width / 9),\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    const width = document.querySelector(\".board-container\").offsetWidth;\r\n    dispatch({ type: \"setBoardSize\", value: [width, width / (521 / 577)] });\r\n    dispatch({ type: \"setBoard\", value: constructNewBoard(width / 9) });\r\n\r\n    window.ondragstart = () => false;\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    window.onmousemove = handleMouseMove;\r\n    window.onmouseup = handleMouseUp;\r\n    window.onresize = handleResize;\r\n    socket.on(\"move\", ([curRow, curCol], [newRow, newCol]) => {\r\n      handleOpponentMove([curRow, curCol], [newRow, newCol]);\r\n    });\r\n\r\n    return () => {\r\n      window.onmouseup = null;\r\n      window.onmousemove = null;\r\n      window.onresize = null;\r\n      socket.removeAllListeners(\"move\");\r\n    };\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (turnToMove) {\r\n      const lostReason = PieceClass.isLost(board, side[1]);\r\n      if (lostReason) {\r\n        const listItemRef = React.createRef();\r\n        dispatch({ type: \"setGameResult\", value: \"Lose\" });\r\n        dispatch({\r\n          type: \"setMessage\",\r\n          value: {\r\n            type: \"game result message\",\r\n            winner: `${opponentInfo.playername} Won - `,\r\n            reason: lostReason,\r\n            className: \"game-message\",\r\n            ref: listItemRef,\r\n          },\r\n        });\r\n        setMoveTimer(null, true, dispatch);\r\n        socket.emit(\"gameFinish\", [\"Won\", lostReason]);\r\n      }\r\n    }\r\n  }, [turnToMove]);\r\n\r\n  return (\r\n    <svg\r\n      width={boardSize[0]}\r\n      height={boardSize[1]}\r\n      onClick={handleClick}\r\n      style={{\r\n        backgroundImage: 'url(\"/images/Board/board.jpg\")',\r\n      }}\r\n      ref={svgRef}\r\n    >\r\n      <image\r\n        href=\"/images/Target_Icon/target.gif\"\r\n        width={boardSize[0] / 9 - 3}\r\n        height={boardSize[0] / 9 - 3}\r\n        style={{ display: targetDisplay }}\r\n        transform={targetTranslate}\r\n      ></image>\r\n      <rect\r\n        width={boardSize[0] / 9 - 3}\r\n        height={boardSize[0] / 9 - 3}\r\n        style={{ display: warningDisplay }}\r\n        transform={warningTranslate}\r\n        fill=\"brown\"\r\n      ></rect>\r\n      <Piece board={board} handleMouseDown={handleMouseDown} />\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport default React.memo(Board);\r\n"]},"metadata":{},"sourceType":"module"}