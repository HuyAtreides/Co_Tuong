{"ast":null,"code":"import _regeneratorRuntime from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useRef}from\"react\";import{Container,Form,InputGroup,Button,Spinner,Row,Col}from\"react-bootstrap\";import{useDispatch,useSelector}from\"react-redux\";import{Redirect}from\"react-router-dom\";import callAPI from\"../App/callAPI.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var VerifyEmail=function VerifyEmail(){var dispatch=useDispatch();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),verified=_useState2[0],setVerified=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),waitForResponse=_useState4[0],setWaitForResponse=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),resend=_useState6[0],setResend=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),verificationCode=_useState8[0],setVerficationCode=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),invalidCodeMess=_useState10[0],setInvalidCodeMess=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),error=_useState12[0],setError=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),waitForSendingCode=_useState14[0],setWaitForSendingCode=_useState14[1];var codeRef=useRef();var playerInfo=useSelector(function(state){return state.appState.playerInfo;});var isAuthenticated=useSelector(function(state){return state.appState.isAuthenticated;});var handleVerificationCodeChange=function handleVerificationCodeChange(event){var value=event.target.value;if(/[^0-9]/.test(value)||value.length>5)setInvalidCodeMess(\"Invalid verification code\");else setInvalidCodeMess(\"\");setVerficationCode(value);};var handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var _yield$callAPI,message,ok,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();if(verificationCode){_context.next=5;break;}setInvalidCodeMess(\"Please fill in this field\");_context.next=15;break;case 5:if(invalidCodeMess){_context.next=15;break;}setWaitForResponse(true);_context.next=9;return callAPI(\"POST\",\"/verify-email/code\",{username:playerInfo.username,correct:+codeRef.current===+verificationCode});case 9:_yield$callAPI=_context.sent;message=_yield$callAPI.message;ok=_yield$callAPI.ok;user=_yield$callAPI.user;setWaitForResponse(false);if(!ok)setError(message);else if(user){setVerified(true);dispatch({type:\"setPlayerInfo\",value:user});}else if(+codeRef.current===+verificationCode)setInvalidCodeMess(\"Incorrect Code\");else setError(message);case 15:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref.apply(this,arguments);};}();var sendVerificationCode=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$callAPI2,message,code,ok;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!resend)setResend(true);setWaitForSendingCode(true);setError(\"\");_context2.next=5;return callAPI(\"POST\",\"/verify-email\",{email:playerInfo.email.value,lastname:playerInfo.name.lastname});case 5:_yield$callAPI2=_context2.sent;message=_yield$callAPI2.message;code=_yield$callAPI2.code;ok=_yield$callAPI2.ok;setWaitForSendingCode(false);if(!ok)setError(message);else codeRef.current=code;case 11:case\"end\":return _context2.stop();}}},_callee2);}));return function sendVerificationCode(){return _ref2.apply(this,arguments);};}();if(!playerInfo||verified)return/*#__PURE__*/_jsx(Redirect,{to:\"/\"});return/*#__PURE__*/_jsxs(Container,{fluid:true,children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Xiangqi\"}),/*#__PURE__*/_jsx(Row,{className:\"justify-content-center\",children:/*#__PURE__*/_jsxs(Col,{md:{span:3},xs:{span:10},className:\"login-component d-flex flex-column  align-items-center\",children:[error?/*#__PURE__*/_jsx(\"p\",{className:\"error-message\",children:error}):null,/*#__PURE__*/_jsxs(Form,{onSubmit:handleSubmit,method:\"POST\",children:[/*#__PURE__*/_jsxs(Form.Group,{controlId:\"verificationCode\",children:[/*#__PURE__*/_jsx(Form.Label,{style:{float:\"left\"},children:\"Enter your verification code\"}),/*#__PURE__*/_jsxs(InputGroup,{hasValidation:true,children:[/*#__PURE__*/_jsx(Form.Control,{type:\"text\",name:\"verificationCode\",isInvalid:invalidCodeMess!==\"\",onChange:handleVerificationCodeChange,value:verificationCode,placeholder:\"Verification Code\"}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",style:{textAlign:\"left\"},children:invalidCodeMess})]})]}),/*#__PURE__*/_jsx(Button,{type:\"submit\",children:waitForResponse?/*#__PURE__*/_jsx(Spinner,{animation:\"border\",variant:\"dark\"}):\"Submit\"}),/*#__PURE__*/_jsx(Button,{onClick:sendVerificationCode,style:{marginTop:\"10px\"},children:waitForSendingCode?/*#__PURE__*/_jsx(Spinner,{animation:\"border\",variant:\"dark\"}):resend?\"Resend Verification Code\":\"Send Verification Code\"})]})]})})]});};export default VerifyEmail;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/Components/VerifyEmail/VerifyEmail.jsx"],"names":["React","useState","useRef","Container","Form","InputGroup","Button","Spinner","Row","Col","useDispatch","useSelector","Redirect","callAPI","VerifyEmail","dispatch","verified","setVerified","waitForResponse","setWaitForResponse","resend","setResend","verificationCode","setVerficationCode","invalidCodeMess","setInvalidCodeMess","error","setError","waitForSendingCode","setWaitForSendingCode","codeRef","playerInfo","state","appState","isAuthenticated","handleVerificationCodeChange","event","value","target","test","length","handleSubmit","preventDefault","username","correct","current","message","ok","user","type","sendVerificationCode","email","lastname","name","code","span","float","textAlign","marginTop"],"mappings":"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","sourcesContent":["import React, { useState, useRef } from \"react\";\r\nimport {\r\n  Container,\r\n  Form,\r\n  InputGroup,\r\n  Button,\r\n  Spinner,\r\n  Row,\r\n  Col,\r\n} from \"react-bootstrap\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport callAPI from \"../App/callAPI.js\";\r\n\r\nconst VerifyEmail = () => {\r\n  const dispatch = useDispatch();\r\n  const [verified, setVerified] = useState(false);\r\n  const [waitForResponse, setWaitForResponse] = useState(false);\r\n  const [resend, setResend] = useState(false);\r\n  const [verificationCode, setVerficationCode] = useState(\"\");\r\n  const [invalidCodeMess, setInvalidCodeMess] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const [waitForSendingCode, setWaitForSendingCode] = useState(false);\r\n  const codeRef = useRef();\r\n  const playerInfo = useSelector((state) => state.appState.playerInfo);\r\n  const isAuthenticated = useSelector(\r\n    (state) => state.appState.isAuthenticated\r\n  );\r\n\r\n  const handleVerificationCodeChange = (event) => {\r\n    const value = event.target.value;\r\n    if (/[^0-9]/.test(value) || value.length > 5)\r\n      setInvalidCodeMess(\"Invalid verification code\");\r\n    else setInvalidCodeMess(\"\");\r\n    setVerficationCode(value);\r\n  };\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n    if (!verificationCode) setInvalidCodeMess(\"Please fill in this field\");\r\n    else if (!invalidCodeMess) {\r\n      setWaitForResponse(true);\r\n      const { message, ok, user } = await callAPI(\r\n        \"POST\",\r\n        \"/verify-email/code\",\r\n        {\r\n          username: playerInfo.username,\r\n          correct: +codeRef.current === +verificationCode,\r\n        }\r\n      );\r\n      setWaitForResponse(false);\r\n      if (!ok) setError(message);\r\n      else if (user) {\r\n        setVerified(true);\r\n        dispatch({ type: \"setPlayerInfo\", value: user });\r\n      } else if (+codeRef.current === +verificationCode)\r\n        setInvalidCodeMess(\"Incorrect Code\");\r\n      else setError(message);\r\n    }\r\n  };\r\n\r\n  const sendVerificationCode = async () => {\r\n    if (!resend) setResend(true);\r\n    setWaitForSendingCode(true);\r\n    setError(\"\");\r\n    const { message, code, ok } = await callAPI(\"POST\", \"/verify-email\", {\r\n      email: playerInfo.email.value,\r\n      lastname: playerInfo.name.lastname,\r\n    });\r\n    setWaitForSendingCode(false);\r\n    if (!ok) setError(message);\r\n    else codeRef.current = code;\r\n  };\r\n\r\n  if (!playerInfo || verified) return <Redirect to=\"/\" />;\r\n\r\n  return (\r\n    <Container fluid>\r\n      <h1>Xiangqi</h1>\r\n      <Row className=\"justify-content-center\">\r\n        <Col\r\n          md={{ span: 3 }}\r\n          xs={{ span: 10 }}\r\n          className=\"login-component d-flex flex-column  align-items-center\"\r\n        >\r\n          {error ? <p className=\"error-message\">{error}</p> : null}\r\n          <Form onSubmit={handleSubmit} method=\"POST\">\r\n            <Form.Group controlId=\"verificationCode\">\r\n              <Form.Label style={{ float: \"left\" }}>\r\n                Enter your verification code\r\n              </Form.Label>\r\n              <InputGroup hasValidation>\r\n                <Form.Control\r\n                  type=\"text\"\r\n                  name=\"verificationCode\"\r\n                  isInvalid={invalidCodeMess !== \"\"}\r\n                  onChange={handleVerificationCodeChange}\r\n                  value={verificationCode}\r\n                  placeholder=\"Verification Code\"\r\n                />\r\n                <Form.Control.Feedback\r\n                  type=\"invalid\"\r\n                  style={{ textAlign: \"left\" }}\r\n                >\r\n                  {invalidCodeMess}\r\n                </Form.Control.Feedback>\r\n              </InputGroup>\r\n            </Form.Group>\r\n\r\n            <Button type=\"submit\">\r\n              {waitForResponse ? (\r\n                <Spinner animation=\"border\" variant=\"dark\" />\r\n              ) : (\r\n                \"Submit\"\r\n              )}\r\n            </Button>\r\n            <Button\r\n              onClick={sendVerificationCode}\r\n              style={{ marginTop: \"10px\" }}\r\n            >\r\n              {waitForSendingCode ? (\r\n                <Spinner animation=\"border\" variant=\"dark\" />\r\n              ) : resend ? (\r\n                \"Resend Verification Code\"\r\n              ) : (\r\n                \"Send Verification Code\"\r\n              )}\r\n            </Button>\r\n          </Form>\r\n        </Col>\r\n      </Row>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default VerifyEmail;\r\n"]},"metadata":{},"sourceType":"module"}