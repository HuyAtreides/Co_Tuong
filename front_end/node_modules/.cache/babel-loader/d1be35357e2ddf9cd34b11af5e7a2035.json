{"ast":null,"code":"import React,{useEffect,useContext}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import\"./DrawOffer.scss\";import{Button}from\"react-bootstrap\";import{SocketContext,SetMoveTimerContext}from\"../../../../../App/context.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var DrawOffer=function DrawOffer(props){var dispatch=useDispatch();var socket=useContext(SocketContext);var setMoveTimer=useContext(SetMoveTimerContext);var playerInfo=useSelector(function(state){return state.appState.playerInfo;});var opponentInfo=useSelector(function(state){return state.gameState.opponentInfo;});var receiveDrawOffer=useSelector(function(state){return state.gameState.receiveDrawOffer;});var handleDrawResult=function handleDrawResult(){var listItemRef=/*#__PURE__*/React.createRef();dispatch({type:\"setGameResult\",value:\"Draw\"});dispatch({type:\"setMessage\",value:{type:\"game result message\",winner:\"\",reason:\"Game Draw By Agreement\",className:\"game-message\",ref:listItemRef}});setMoveTimer(null,true,dispatch);};var handleAcceptOffer=function handleAcceptOffer(){dispatch({type:\"setReceiveDrawOffer\",value:false});handleDrawResult();socket.emit(\"gameFinish\",\"Draw\");};var handleDeclineOffer=function handleDeclineOffer(){var listItemRef=/*#__PURE__*/React.createRef();dispatch({type:\"setReceiveDrawOffer\",value:false});dispatch({type:\"setMessage\",value:{from:\"\".concat(playerInfo.username),message:\"Declined A Draw\",className:\"game-message\",ref:listItemRef}});socket.emit(\"sendMessage\",{from:\"\".concat(playerInfo.username),message:\"Declined A Draw\",className:\"game-message\",ref:listItemRef});};useEffect(function(){socket.on(\"receiveDrawOffer\",function(){dispatch({type:\"setReceiveDrawOffer\",value:true});});socket.on(\"draw\",function(){handleDrawResult();});return function(){socket.removeAllListeners(\"draw\");socket.removeAllListeners(\"receiveDrawOffer\");};});if(!receiveDrawOffer)return null;return/*#__PURE__*/_jsxs(\"li\",{className:\"draw-offer\",style:{display:props.display},children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"span\",{children:opponentInfo.playername}),\" Offer A Draw\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"answer\",children:[/*#__PURE__*/_jsxs(Button,{className:\"accept-offer\",onClick:handleAcceptOffer,children:[\"Accept \",/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-check\"})]}),/*#__PURE__*/_jsxs(Button,{className:\"decline-offer\",onClick:handleDeclineOffer,children:[\"Decline \",/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\"})]})]})]});};export default DrawOffer;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/Components/Main/Game/GameBar/ChatSection/DrawOffer/DrawOffer.jsx"],"names":["React","useEffect","useContext","useSelector","useDispatch","Button","SocketContext","SetMoveTimerContext","DrawOffer","props","dispatch","socket","setMoveTimer","playerInfo","state","appState","opponentInfo","gameState","receiveDrawOffer","handleDrawResult","listItemRef","createRef","type","value","winner","reason","className","ref","handleAcceptOffer","emit","handleDeclineOffer","from","username","message","on","removeAllListeners","display","playername"],"mappings":"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","sourcesContent":["import React, { useEffect, useContext } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport \"./DrawOffer.scss\";\r\nimport { Button } from \"react-bootstrap\";\r\nimport {\r\n  SocketContext,\r\n  SetMoveTimerContext,\r\n} from \"../../../../../App/context.js\";\r\n\r\nconst DrawOffer = (props) => {\r\n  const dispatch = useDispatch();\r\n  const socket = useContext(SocketContext);\r\n  const setMoveTimer = useContext(SetMoveTimerContext);\r\n  const playerInfo = useSelector((state) => state.appState.playerInfo);\r\n  const opponentInfo = useSelector((state) => state.gameState.opponentInfo);\r\n  const receiveDrawOffer = useSelector(\r\n    (state) => state.gameState.receiveDrawOffer\r\n  );\r\n\r\n  const handleDrawResult = () => {\r\n    const listItemRef = React.createRef();\r\n    dispatch({ type: \"setGameResult\", value: \"Draw\" });\r\n    dispatch({\r\n      type: \"setMessage\",\r\n      value: {\r\n        type: \"game result message\",\r\n        winner: \"\",\r\n        reason: \"Game Draw By Agreement\",\r\n        className: \"game-message\",\r\n        ref: listItemRef,\r\n      },\r\n    });\r\n    setMoveTimer(null, true, dispatch);\r\n  };\r\n\r\n  const handleAcceptOffer = () => {\r\n    dispatch({ type: \"setReceiveDrawOffer\", value: false });\r\n    handleDrawResult();\r\n    socket.emit(\"gameFinish\", \"Draw\");\r\n  };\r\n\r\n  const handleDeclineOffer = () => {\r\n    const listItemRef = React.createRef();\r\n    dispatch({ type: \"setReceiveDrawOffer\", value: false });\r\n    dispatch({\r\n      type: \"setMessage\",\r\n      value: {\r\n        from: `${playerInfo.username}`,\r\n        message: \"Declined A Draw\",\r\n        className: \"game-message\",\r\n        ref: listItemRef,\r\n      },\r\n    });\r\n    socket.emit(\"sendMessage\", {\r\n      from: `${playerInfo.username}`,\r\n      message: \"Declined A Draw\",\r\n      className: \"game-message\",\r\n      ref: listItemRef,\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    socket.on(\"receiveDrawOffer\", () => {\r\n      dispatch({ type: \"setReceiveDrawOffer\", value: true });\r\n    });\r\n\r\n    socket.on(\"draw\", () => {\r\n      handleDrawResult();\r\n    });\r\n\r\n    return () => {\r\n      socket.removeAllListeners(\"draw\");\r\n      socket.removeAllListeners(\"receiveDrawOffer\");\r\n    };\r\n  });\r\n\r\n  if (!receiveDrawOffer) return null;\r\n  return (\r\n    <li className=\"draw-offer\" style={{ display: props.display }}>\r\n      <p>\r\n        <span>{opponentInfo.playername}</span> Offer A Draw\r\n      </p>\r\n      <div className=\"answer\">\r\n        <Button className=\"accept-offer\" onClick={handleAcceptOffer}>\r\n          Accept <i className=\"fas fa-check\"></i>\r\n        </Button>\r\n        <Button className=\"decline-offer\" onClick={handleDeclineOffer}>\r\n          Decline <i className=\"fas fa-times\"></i>\r\n        </Button>\r\n      </div>\r\n    </li>\r\n  );\r\n};\r\n\r\nexport default DrawOffer;\r\n"]},"metadata":{},"sourceType":"module"}