{"ast":null,"code":"import _slicedToArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useRef,useEffect,useContext}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{Button}from\"react-bootstrap\";import\"./ChatSection.scss\";import renderMessages from\"./renderMessages.js\";import DrawOffer from\"./DrawOffer/DrawOffer.jsx\";import{SocketContext}from\"../../../../App/context.js\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ChatSection=function ChatSection(){var dispatch=useDispatch();var socket=useContext(SocketContext);var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),input=_useState2[0],setInput=_useState2[1];var messagesContainerRef=useRef();var messages=useSelector(function(state){return state.gameState.messages;});var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),hideChat=_useState4[0],setHideChat=_useState4[1];var displayMessages=renderMessages(messages);var playerInfo=useSelector(function(state){return state.appState.playerInfo;});var opponentInfo=useSelector(function(state){return state.gameState.opponentInfo;});var handleOnChange=function handleOnChange(event){setInput(event.currentTarget.value);};var handleHideChat=function handleHideChat(){setHideChat(true);};var handleShowChat=function handleShowChat(){setHideChat(false);};var handleSendMessage=function handleSendMessage(event){if(input){var listItemRef=/*#__PURE__*/React.createRef();var message={from:\"\".concat(playerInfo.username,\": \"),message:input,className:\"\",ref:listItemRef};dispatch({type:\"setMessage\",value:message});setInput(\"\");socket.emit(\"sendMessage\",message);event.preventDefault();}};useEffect(function(){if(messages.length>0){var list=messagesContainerRef.current;var lastListItem=messages[messages.length-1].ref.current;if(lastListItem){list.scrollTop=lastListItem.offsetTop;}}socket.on(\"incomingMessage\",function(message){if(message.from&&message.className!==\"game-message\")message.from=\"\".concat(opponentInfo.playername,\": \");dispatch({type:\"setMessage\",value:message});});return function(){socket.removeAllListeners(\"incomingMessage\");};});return hideChat?/*#__PURE__*/_jsxs(Button,{className:\"show-chat\",onClick:handleShowChat,children:[\"Show Chat\",/*#__PURE__*/_jsx(DrawOffer,{display:\"none\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"chat-section\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times hide-chat\",onClick:handleHideChat}),/*#__PURE__*/_jsxs(\"ul\",{className:\"message-container\",ref:messagesContainerRef,children:[/*#__PURE__*/_jsx(\"li\",{className:\"announce-new-game\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"versus game-message\",children:[/*#__PURE__*/_jsx(\"span\",{children:opponentInfo.playername}),\" vs\",\" \",/*#__PURE__*/_jsx(\"span\",{children:playerInfo.username})]})}),displayMessages]}),/*#__PURE__*/_jsx(DrawOffer,{display:\"flex\"}),/*#__PURE__*/_jsxs(\"form\",{className:\"chat-input\",onSubmit:handleSendMessage,children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Message...\",onChange:handleOnChange,value:input}),/*#__PURE__*/_jsx(Button,{className:\"send-btn\",type:\"submit\",children:\"Send\"})]})]});};export default ChatSection;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/Components/Main/Game/GameBar/ChatSection/ChatSection.jsx"],"names":["React","useState","useRef","useEffect","useContext","useSelector","useDispatch","Button","renderMessages","DrawOffer","SocketContext","ChatSection","dispatch","socket","input","setInput","messagesContainerRef","messages","state","gameState","hideChat","setHideChat","displayMessages","playerInfo","appState","opponentInfo","handleOnChange","event","currentTarget","value","handleHideChat","handleShowChat","handleSendMessage","listItemRef","createRef","message","from","username","className","ref","type","emit","preventDefault","length","list","current","lastListItem","scrollTop","offsetTop","on","playername","removeAllListeners"],"mappings":"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","sourcesContent":["import React, { useState, useRef, useEffect, useContext } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { Button } from \"react-bootstrap\";\r\nimport \"./ChatSection.scss\";\r\nimport renderMessages from \"./renderMessages.js\";\r\nimport DrawOffer from \"./DrawOffer/DrawOffer.jsx\";\r\nimport { SocketContext } from \"../../../../App/context.js\";\r\n\r\nconst ChatSection = () => {\r\n  const dispatch = useDispatch();\r\n  const socket = useContext(SocketContext);\r\n  const [input, setInput] = useState(\"\");\r\n  const messagesContainerRef = useRef();\r\n  const messages = useSelector((state) => state.gameState.messages);\r\n  const [hideChat, setHideChat] = useState(false);\r\n  const displayMessages = renderMessages(messages);\r\n  const playerInfo = useSelector((state) => state.appState.playerInfo);\r\n  const opponentInfo = useSelector((state) => state.gameState.opponentInfo);\r\n\r\n  const handleOnChange = (event) => {\r\n    setInput(event.currentTarget.value);\r\n  };\r\n\r\n  const handleHideChat = () => {\r\n    setHideChat(true);\r\n  };\r\n\r\n  const handleShowChat = () => {\r\n    setHideChat(false);\r\n  };\r\n\r\n  const handleSendMessage = (event) => {\r\n    if (input) {\r\n      const listItemRef = React.createRef();\r\n      const message = {\r\n        from: `${playerInfo.username}: `,\r\n        message: input,\r\n        className: \"\",\r\n        ref: listItemRef,\r\n      };\r\n      dispatch({ type: \"setMessage\", value: message });\r\n      setInput(\"\");\r\n      socket.emit(\"sendMessage\", message);\r\n      event.preventDefault();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (messages.length > 0) {\r\n      const list = messagesContainerRef.current;\r\n      const lastListItem = messages[messages.length - 1].ref.current;\r\n      if (lastListItem) {\r\n        list.scrollTop = lastListItem.offsetTop;\r\n      }\r\n    }\r\n    socket.on(\"incomingMessage\", (message) => {\r\n      if (message.from && message.className !== \"game-message\")\r\n        message.from = `${opponentInfo.playername}: `;\r\n      dispatch({ type: \"setMessage\", value: message });\r\n    });\r\n\r\n    return () => {\r\n      socket.removeAllListeners(\"incomingMessage\");\r\n    };\r\n  });\r\n\r\n  return hideChat ? (\r\n    <Button className=\"show-chat\" onClick={handleShowChat}>\r\n      Show Chat\r\n      <DrawOffer display=\"none\" />\r\n    </Button>\r\n  ) : (\r\n    <div className=\"chat-section\">\r\n      <i className=\"fas fa-times hide-chat\" onClick={handleHideChat}></i>\r\n      <ul className=\"message-container\" ref={messagesContainerRef}>\r\n        <li className=\"announce-new-game\">\r\n          <p className=\"versus game-message\">\r\n            <span>{opponentInfo.playername}</span> vs{\" \"}\r\n            <span>{playerInfo.username}</span>\r\n          </p>\r\n        </li>\r\n        {displayMessages}\r\n      </ul>\r\n      <DrawOffer display=\"flex\" />\r\n      <form className=\"chat-input\" onSubmit={handleSendMessage}>\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Message...\"\r\n          onChange={handleOnChange}\r\n          value={input}\r\n        />\r\n        <Button className=\"send-btn\" type=\"submit\">\r\n          Send\r\n        </Button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatSection;\r\n"]},"metadata":{},"sourceType":"module"}