{"ast":null,"code":"import _toConsumableArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useContext,useState}from\"react\";import{SocketContext}from\"../../../App/context.js\";import renderInvites from\"./renderInvites.js\";import\"./Invites.scss\";import{jsx as _jsx}from\"react/jsx-runtime\";var Invites=function Invites(_ref){var lang=_ref.lang;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),invites=_useState2[0],setInvites=_useState2[1];var socket=useContext(SocketContext);var handleAccept=function handleAccept(event){var playername=event.currentTarget.getAttribute(\"playername\");var index=invites.findIndex(function(player){return player.playername===playername;});var socketID=invites[index].socketID;socket.emit(\"acceptInvite\",socketID);setInvites([]);};var handleDecline=function handleDecline(event){var playername=event.currentTarget.getAttribute(\"playername\");var index=invites.findIndex(function(player){return player.playername===playername;});socket.emit(\"declineInvite\",invites[index].socketID,false);setInvites(function(prevState){prevState.splice(index,1);return _toConsumableArray(prevState);});};useEffect(function(){socket.on(\"receiveInvite\",function(sender,senderSocketID,time){setInvites(function(prevState){sender.socketID=senderSocketID;sender.time=time;prevState.push(sender);return _toConsumableArray(prevState);});socket.emit(\"inviteReceived\",senderSocketID);});socket.on(\"clearInvites\",function(){setInvites([]);});socket.on(\"inviteCanceled\",function(senderInfo){var index=invites.findIndex(function(player){return player.playername===senderInfo.playername;});if(index!==-1){setInvites(function(prevState){prevState[index].cancelInvite=true;return _toConsumableArray(prevState);});setTimeout(function(){setInvites(function(prevState){prevState.splice(index,1);return _toConsumableArray(prevState);});},1000);}});return function(){socket.removeAllListeners(\"receiveInvite\");socket.removeAllListeners(\"inviteCanceled\");socket.removeAllListeners(\"clearInvites\");};},[invites]);useEffect(function(){return function(){socket.emit(\"declineInvite\",null,true);};},[]);return/*#__PURE__*/_jsx(\"ul\",{className:\"invites-list\",children:renderInvites(invites,handleAccept,handleDecline,lang)});};export default Invites;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/Components/Main/NavBar/Invites/Invites.jsx"],"names":["React","useEffect","useContext","useState","SocketContext","renderInvites","Invites","lang","invites","setInvites","socket","handleAccept","event","playername","currentTarget","getAttribute","index","findIndex","player","socketID","emit","handleDecline","prevState","splice","on","sender","senderSocketID","time","push","senderInfo","cancelInvite","setTimeout","removeAllListeners"],"mappings":"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","sourcesContent":["import React, { useEffect, useContext, useState } from \"react\";\r\nimport { SocketContext } from \"../../../App/context.js\";\r\nimport renderInvites from \"./renderInvites.js\";\r\nimport \"./Invites.scss\";\r\n\r\nconst Invites = ({ lang }) => {\r\n  const [invites, setInvites] = useState([]);\r\n  const socket = useContext(SocketContext);\r\n\r\n  const handleAccept = (event) => {\r\n    const playername = event.currentTarget.getAttribute(\"playername\");\r\n    const index = invites.findIndex(\r\n      (player) => player.playername === playername\r\n    );\r\n    const { socketID } = invites[index];\r\n    socket.emit(\"acceptInvite\", socketID);\r\n    setInvites([]);\r\n  };\r\n\r\n  const handleDecline = (event) => {\r\n    const playername = event.currentTarget.getAttribute(\"playername\");\r\n    const index = invites.findIndex(\r\n      (player) => player.playername === playername\r\n    );\r\n    socket.emit(\"declineInvite\", invites[index].socketID, false);\r\n    setInvites((prevState) => {\r\n      prevState.splice(index, 1);\r\n      return [...prevState];\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    socket.on(\"receiveInvite\", (sender, senderSocketID, time) => {\r\n      setInvites((prevState) => {\r\n        sender.socketID = senderSocketID;\r\n        sender.time = time;\r\n        prevState.push(sender);\r\n        return [...prevState];\r\n      });\r\n      socket.emit(\"inviteReceived\", senderSocketID);\r\n    });\r\n\r\n    socket.on(\"clearInvites\", () => {\r\n      setInvites([]);\r\n    });\r\n\r\n    socket.on(\"inviteCanceled\", (senderInfo) => {\r\n      const index = invites.findIndex(\r\n        (player) => player.playername === senderInfo.playername\r\n      );\r\n      if (index !== -1) {\r\n        setInvites((prevState) => {\r\n          prevState[index].cancelInvite = true;\r\n          return [...prevState];\r\n        });\r\n\r\n        setTimeout(() => {\r\n          setInvites((prevState) => {\r\n            prevState.splice(index, 1);\r\n            return [...prevState];\r\n          });\r\n        }, 1000);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      socket.removeAllListeners(\"receiveInvite\");\r\n      socket.removeAllListeners(\"inviteCanceled\");\r\n      socket.removeAllListeners(\"clearInvites\");\r\n    };\r\n  }, [invites]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      socket.emit(\"declineInvite\", null, true);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <ul className=\"invites-list\">\r\n      {renderInvites(invites, handleAccept, handleDecline, lang)}\r\n    </ul>\r\n  );\r\n};\r\n\r\nexport default Invites;\r\n"]},"metadata":{},"sourceType":"module"}