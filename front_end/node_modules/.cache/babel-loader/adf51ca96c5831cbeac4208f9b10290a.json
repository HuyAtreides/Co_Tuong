{"ast":null,"code":"import _createForOfIteratorHelper from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _toConsumableArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";var Piece=/*#__PURE__*/function(){function Piece(width,row,col,name,choosenSide){_classCallCheck(this,Piece);this.width=width;this.position=[row,col];this.name=name;this.side=name.split(\"-\")[1];this.choosenSide=choosenSide;this.minCol=0;this.maxCol=8;this.minRow=0;this.maxRow=9;this.translate=\"translate(\".concat(width*col,\", \").concat(width*row,\")\");}_createClass(Piece,[{key:\"move\",value:function move(x,y){var translate=\"translate(\".concat(x-this.width/2,\", \").concat(y-this.width/2,\")\");this.translate=translate;}},{key:\"checkValidMove\",value:function checkValidMove(newRow,newCol,board){var _this$position=_slicedToArray(this.position,2),curRow=_this$position[0],curCol=_this$position[1];var moveRow=newRow-curRow,moveCol=newCol-curCol;var valid=newCol>=this.minCol&&newCol<=this.maxCol&&newRow>=this.minRow&&newRow<=this.maxRow;var existMove=this.moves.some(function(move){return move[0]===moveRow&&move[1]===moveCol;});if(valid&&existMove){var generalTranslate=this.putGeneralInDanger(newRow,newCol,board);if(generalTranslate)return generalTranslate;return true;}return false;}},{key:\"setPosition\",value:function setPosition(capture,newRow,newCol){var translateX=newCol*this.width,translateY=newRow*this.width;var translate=\"translate(\".concat(translateX,\", \").concat(translateY,\")\");this.position=[newRow,newCol];this.translate=translate;return[capture===\"capture\",newRow,newCol];}},{key:\"canMoveToNewPosition\",value:function canMoveToNewPosition(newRow,newCol,board){var _this$position2=_slicedToArray(this.position,2),curRow=_this$position2[0],curCol=_this$position2[1];var translateX=curCol*this.width,translateY=curRow*this.width;this.translate=\"translate(\".concat(translateX,\", \").concat(translateY,\")\");if(this.side===this.choosenSide[1]){var isValid=this.checkValidMove(newRow,newCol,board);if(isValid&&!/translate/.test(isValid)){if(!board[newRow][newCol].side){if(this.countPiecesBetween(newRow,newCol,board)===0)return true;}else if(board[newRow][newCol].side!==board[curRow][curCol].side)if(this.countPiecesBetween(newRow,newCol,board)===1)return\"capture\";}else if(isValid)return isValid;}return false;}},{key:\"countPiecesBetween\",value:function countPiecesBetween(newRow,newCol,board){var _this$position3=_slicedToArray(this.position,2),curRow=_this$position3[0],curCol=_this$position3[1];var count=0;if(newRow===curRow){do{curCol+=curCol>newCol?-1:1;if(board[curRow][curCol])count++;}while(curCol!==newCol);}else{do{curRow+=curRow>newRow?-1:1;if(board[curRow][curCol])count++;}while(curRow!==newRow);}return count;}},{key:\"putGeneralInDanger\",value:function putGeneralInDanger(newRow,newCol,board){var tmpBoard=board.reduce(function(acc,row){acc.push(_toConsumableArray(row));return acc;},[]);this.updateTmpBoard(newRow,newCol,tmpBoard);return Piece.isGeneralInDanger(tmpBoard,this.side);}},{key:\"updateTmpBoard\",value:function updateTmpBoard(newRow,newCol,tmpBoard){var _this$position4=_slicedToArray(this.position,2),curRow=_this$position4[0],curCol=_this$position4[1];var tmp=tmpBoard[curRow][curCol];tmpBoard[curRow][curCol]=0;tmpBoard[newRow][newCol]=tmp;}},{key:\"canCaptureGeneral\",value:function canCaptureGeneral(tmpBoard){var _this$position5=_slicedToArray(this.position,2),curRow=_this$position5[0],curCol=_this$position5[1];var _iterator=_createForOfIteratorHelper(this.moves),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var move=_step.value;var newRow=curRow+move[0],newCol=curCol+move[1];if(newCol>=0&&newCol<9&&newRow>=0&&newRow<10){if(tmpBoard[newRow][newCol].side)if(tmpBoard[newRow][newCol].side!==tmpBoard[curRow][curCol].side)if(this.countPiecesBetween(newRow,newCol,tmpBoard)===1)if(tmpBoard[newRow][newCol].name.split(\"-\")[0]===\"general\"){return tmpBoard[newRow][newCol].translate;}}}}catch(err){_iterator.e(err);}finally{_iterator.f();}return false;}},{key:\"animateMove\",value:function animateMove(_ref,board,dispatch){var _ref2=_slicedToArray(_ref,2),newRow=_ref2[0],newCol=_ref2[1];var _this$position6=_slicedToArray(this.position,2),curRow=_this$position6[0],curCol=_this$position6[1];this.DOMNode=document.querySelector(\"#p\".concat(curRow).concat(curCol));if(curCol===newCol){this.moveVertical([newRow,newCol],board,dispatch);}else this.moveDiagonal([newRow,newCol],board,dispatch);}},{key:\"setTransform\",value:function setTransform(_ref3,board,dispatch){var _ref4=_slicedToArray(_ref3,2),xB=_ref4[0],yB=_ref4[1];var _this$position7=_slicedToArray(this.position,2),yA=_this$position7[0],xA=_this$position7[1];var translate=\"translate(\".concat(xB*this.width,\", \").concat(yB*this.width,\")\");this.DOMNode.setAttribute(\"transform\",translate);if(board){this.setPosition(null,yB,xB);var tmp=board[yA][xA];if(board[yB][xB])dispatch({type:\"setCapturedPieces\",value:board[yB][xB]});board[yA][xA]=0;board[yB][xB]=tmp;dispatch({type:\"setTurnToMove\",value:true});dispatch({type:\"setBoard\",value:_toConsumableArray(board)});}}},{key:\"moveVertical\",value:function moveVertical(_ref5,board,dispatch){var _this=this;var _ref6=_slicedToArray(_ref5,2),yB=_ref6[0],xB=_ref6[1];var _this$position8=_slicedToArray(this.position,2),yA=_this$position8[0],xA=_this$position8[1];var step=0;var animate=function animate(){if(Math.abs(step)<Math.abs(yB-yA)){step+=(yB-yA)/(0.25*60);_this.setTransform([xA,yA+step],null,null);window.requestAnimationFrame(animate);}else if(Math.abs(step)>=Math.abs(yB-yA)){_this.setTransform([xB,yB],board,dispatch);}};window.requestAnimationFrame(animate);}},{key:\"moveDiagonal\",value:function moveDiagonal(_ref7,board,dispatch){var _this2=this;var _ref8=_slicedToArray(_ref7,2),yB=_ref8[0],xB=_ref8[1];var _this$position9=_slicedToArray(this.position,2),yA=_this$position9[0],xA=_this$position9[1];var step=0;var animate=function animate(){if(Math.abs(step)<Math.abs(xB-xA)){step+=(xB-xA)/(0.25*60);var y=step/(xB-xA)*(yB-yA)+yA;_this2.setTransform([xA+step,y],null,null);window.requestAnimationFrame(animate);}else if(Math.abs(step)>=Math.abs(xB-xA)){_this2.setTransform([xB,yB],board,dispatch);}};window.requestAnimationFrame(animate);}}],[{key:\"isGeneralInDanger\",value:function isGeneralInDanger(board,side){for(var i=0;i<10;i++){for(var j=0;j<9;j++){if(board[i][j]&&board[i][j].side!==side){var canCapture=board[i][j].canCaptureGeneral(board);if(/translate/.test(canCapture))return canCapture;}}}return false;}},{key:\"isLost\",value:function isLost(board,side){for(var i=0;i<10;i++){for(var j=0;j<9;j++){if(board[i][j]&&board[i][j].side===side){var _board$i$j$position=_slicedToArray(board[i][j].position,2),curRow=_board$i$j$position[0],curCol=_board$i$j$position[1];var _iterator2=_createForOfIteratorHelper(board[i][j].moves),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var move=_step2.value;var newRow=curRow+move[0],newCol=curCol+move[1];var tmp=board[i][j].canMoveToNewPosition(newRow,newCol,board);if(tmp&&!/translate/.test(tmp))return null;}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}}}}if(Piece.isGeneralInDanger(board,side)){return\"Checkmate\";}return\"Stalemate\";}}]);return Piece;}();export default Piece;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/pieces/piece.js"],"names":["Piece","width","row","col","name","choosenSide","position","side","split","minCol","maxCol","minRow","maxRow","translate","x","y","newRow","newCol","board","curRow","curCol","moveRow","moveCol","valid","existMove","moves","some","move","generalTranslate","putGeneralInDanger","capture","translateX","translateY","isValid","checkValidMove","test","countPiecesBetween","count","tmpBoard","reduce","acc","push","updateTmpBoard","isGeneralInDanger","tmp","dispatch","DOMNode","document","querySelector","moveVertical","moveDiagonal","xB","yB","yA","xA","setAttribute","setPosition","type","value","step","animate","Math","abs","setTransform","window","requestAnimationFrame","i","j","canCapture","canCaptureGeneral","canMoveToNewPosition"],"mappings":"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","sourcesContent":["class Piece {\r\n  constructor(width, row, col, name, choosenSide) {\r\n    this.width = width;\r\n    this.position = [row, col];\r\n    this.name = name;\r\n    this.side = name.split(\"-\")[1];\r\n    this.choosenSide = choosenSide;\r\n    this.minCol = 0;\r\n    this.maxCol = 8;\r\n    this.minRow = 0;\r\n    this.maxRow = 9;\r\n    this.translate = `translate(${width * col}, ${width * row})`;\r\n  }\r\n\r\n  move(x, y) {\r\n    const translate = `translate(${x - this.width / 2}, ${y - this.width / 2})`;\r\n    this.translate = translate;\r\n  }\r\n\r\n  checkValidMove(newRow, newCol, board) {\r\n    const [curRow, curCol] = this.position;\r\n    const [moveRow, moveCol] = [newRow - curRow, newCol - curCol];\r\n    const valid =\r\n      newCol >= this.minCol &&\r\n      newCol <= this.maxCol &&\r\n      newRow >= this.minRow &&\r\n      newRow <= this.maxRow;\r\n    const existMove = this.moves.some((move) => {\r\n      return move[0] === moveRow && move[1] === moveCol;\r\n    });\r\n    if (valid && existMove) {\r\n      const generalTranslate = this.putGeneralInDanger(newRow, newCol, board);\r\n      if (generalTranslate) return generalTranslate;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  setPosition(capture, newRow, newCol) {\r\n    const [translateX, translateY] = [newCol * this.width, newRow * this.width];\r\n    const translate = `translate(${translateX}, ${translateY})`;\r\n    this.position = [newRow, newCol];\r\n    this.translate = translate;\r\n    return [capture === \"capture\", newRow, newCol];\r\n  }\r\n\r\n  canMoveToNewPosition(newRow, newCol, board) {\r\n    const [curRow, curCol] = this.position;\r\n    const [translateX, translateY] = [curCol * this.width, curRow * this.width];\r\n    this.translate = `translate(${translateX}, ${translateY})`;\r\n    if (this.side === this.choosenSide[1]) {\r\n      const isValid = this.checkValidMove(newRow, newCol, board);\r\n      if (isValid && !/translate/.test(isValid)) {\r\n        if (!board[newRow][newCol].side) {\r\n          if (this.countPiecesBetween(newRow, newCol, board) === 0) return true;\r\n        } else if (board[newRow][newCol].side !== board[curRow][curCol].side)\r\n          if (this.countPiecesBetween(newRow, newCol, board) === 1)\r\n            return \"capture\";\r\n      } else if (isValid) return isValid;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  countPiecesBetween(newRow, newCol, board) {\r\n    let [curRow, curCol] = this.position;\r\n    let count = 0;\r\n    if (newRow === curRow) {\r\n      do {\r\n        curCol += curCol > newCol ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curCol !== newCol);\r\n    } else {\r\n      do {\r\n        curRow += curRow > newRow ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curRow !== newRow);\r\n    }\r\n    return count;\r\n  }\r\n\r\n  static isGeneralInDanger(board, side) {\r\n    for (let i = 0; i < 10; i++) {\r\n      for (let j = 0; j < 9; j++) {\r\n        if (board[i][j] && board[i][j].side !== side) {\r\n          const canCapture = board[i][j].canCaptureGeneral(board);\r\n          if (/translate/.test(canCapture)) return canCapture;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  putGeneralInDanger(newRow, newCol, board) {\r\n    const tmpBoard = board.reduce((acc, row) => {\r\n      acc.push([...row]);\r\n      return acc;\r\n    }, []);\r\n    this.updateTmpBoard(newRow, newCol, tmpBoard);\r\n    return Piece.isGeneralInDanger(tmpBoard, this.side);\r\n  }\r\n\r\n  static isLost(board, side) {\r\n    for (let i = 0; i < 10; i++) {\r\n      for (let j = 0; j < 9; j++) {\r\n        if (board[i][j] && board[i][j].side === side) {\r\n          const [curRow, curCol] = board[i][j].position;\r\n          for (let move of board[i][j].moves) {\r\n            const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n            const tmp = board[i][j].canMoveToNewPosition(newRow, newCol, board);\r\n            if (tmp && !/translate/.test(tmp)) return null;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (Piece.isGeneralInDanger(board, side)) {\r\n      return \"Checkmate\";\r\n    }\r\n    return \"Stalemate\";\r\n  }\r\n\r\n  updateTmpBoard(newRow, newCol, tmpBoard) {\r\n    const [curRow, curCol] = this.position;\r\n    const tmp = tmpBoard[curRow][curCol];\r\n    tmpBoard[curRow][curCol] = 0;\r\n    tmpBoard[newRow][newCol] = tmp;\r\n  }\r\n\r\n  canCaptureGeneral(tmpBoard) {\r\n    const [curRow, curCol] = this.position;\r\n    for (let move of this.moves) {\r\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n      if (newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10) {\r\n        if (tmpBoard[newRow][newCol].side)\r\n          if (tmpBoard[newRow][newCol].side !== tmpBoard[curRow][curCol].side)\r\n            if (this.countPiecesBetween(newRow, newCol, tmpBoard) === 1)\r\n              if (tmpBoard[newRow][newCol].name.split(\"-\")[0] === \"general\") {\r\n                return tmpBoard[newRow][newCol].translate;\r\n              }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  animateMove([newRow, newCol], board, dispatch) {\r\n    const [curRow, curCol] = this.position;\r\n    this.DOMNode = document.querySelector(`#p${curRow}${curCol}`);\r\n    if (curCol === newCol) {\r\n      this.moveVertical([newRow, newCol], board, dispatch);\r\n    } else this.moveDiagonal([newRow, newCol], board, dispatch);\r\n  }\r\n\r\n  setTransform([xB, yB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    const translate = `translate(${xB * this.width}, ${yB * this.width})`;\r\n    this.DOMNode.setAttribute(\"transform\", translate);\r\n    if (board) {\r\n      this.setPosition(null, yB, xB);\r\n      const tmp = board[yA][xA];\r\n      if (board[yB][xB])\r\n        dispatch({ type: \"setCapturedPieces\", value: board[yB][xB] });\r\n      board[yA][xA] = 0;\r\n      board[yB][xB] = tmp;\r\n      dispatch({ type: \"setTurnToMove\", value: true });\r\n      dispatch({ type: \"setBoard\", value: [...board] });\r\n    }\r\n  }\r\n\r\n  moveVertical([yB, xB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    let step = 0;\r\n\r\n    const animate = () => {\r\n      if (Math.abs(step) < Math.abs(yB - yA)) {\r\n        step += (yB - yA) / (0.25 * 60);\r\n        this.setTransform([xA, yA + step], null, null);\r\n        window.requestAnimationFrame(animate);\r\n      } else if (Math.abs(step) >= Math.abs(yB - yA)) {\r\n        this.setTransform([xB, yB], board, dispatch);\r\n      }\r\n    };\r\n\r\n    window.requestAnimationFrame(animate);\r\n  }\r\n\r\n  moveDiagonal([yB, xB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    let step = 0;\r\n\r\n    const animate = () => {\r\n      if (Math.abs(step) < Math.abs(xB - xA)) {\r\n        step += (xB - xA) / (0.25 * 60);\r\n        let y = (step / (xB - xA)) * (yB - yA) + yA;\r\n        this.setTransform([xA + step, y], null, null);\r\n        window.requestAnimationFrame(animate);\r\n      } else if (Math.abs(step) >= Math.abs(xB - xA)) {\r\n        this.setTransform([xB, yB], board, dispatch);\r\n      }\r\n    };\r\n\r\n    window.requestAnimationFrame(animate);\r\n  }\r\n}\r\n\r\nexport default Piece;\r\n"]},"metadata":{},"sourceType":"module"}