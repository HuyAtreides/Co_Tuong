{"ast":null,"code":"import _regeneratorRuntime from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{useSelector,useDispatch}from\"react-redux\";import{Redirect}from\"react-router-dom\";import useFetchData from\"../App/useFetchData.js\";import{Form,Container,Row,Col,InputGroup,Spinner,Button}from\"react-bootstrap\";import NavBar from\"../Main/NavBar/NavBar.jsx\";import\"./Settings.scss\";import callAPI from\"../App/callAPI.js\";import useValidateInput from\"../Signup/useValidateInput.js\";import ProfileHeader from\"../Home/ProfileHeader/ProfileHeader.jsx\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Settings=function Settings(){var dispatch=useDispatch();var playerInfo=useSelector(function(state){return state.appState.playerInfo;});var lang=useSelector(function(state){return state.appState.lang;});var _useState=useState(lang===\"English\"?\"Save\":\"Lưu\"),_useState2=_slicedToArray(_useState,2),buttonText=_useState2[0],setButtonText=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),uploadErr=_useState4[0],setUploadErr=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),waitForServer=_useState6[0],setWaitForServer=_useState6[1];var validateInput=useValidateInput(false,true,lang);var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),waitForResponse=_useState8[0],setWaitForResponse=_useState8[1];var getChanges=function getChanges(){var changes={};var username=validateInput.username,email=validateInput.email,lastname=validateInput.lastname,firstname=validateInput.firstname;if(playerInfo.username!==username)changes[\"username\"]=username;if(playerInfo.email.value!==email){changes[\"email\"]={value:email,verified:false};}changes[\"name.lastname\"]=lastname;changes[\"name.firstname\"]=firstname;if(validateInput.password)changes[\"password\"]=validateInput.password;return changes;};var handleSaveChange=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var password,confirmPassword,missingField,changes,_yield$callAPI,user,message,ok;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;event.preventDefault();if(!waitForServer){_context.next=4;break;}return _context.abrupt(\"return\");case 4:setUploadErr(\"\");validateInput.setError(null);password=validateInput.password,confirmPassword=validateInput.confirmPassword;missingField=validateInput.handleMissingField(!playerInfo.email.value);if(!(password!==confirmPassword)){_context.next=11;break;}validateInput.setConfirmPasswordMess(lang===\"English\"?\"Password doesn't match\":\"Mật khẩu không khớp\");return _context.abrupt(\"return\");case 11:if(!(!missingField&&!validateInput.invalidEmailMess&&!validateInput.invalidPasswordMess&&!validateInput.invalidUsernameMess&&!validateInput.confirmPasswordMess)){_context.next=22;break;}changes=getChanges();setWaitForServer(true);_context.next=16;return callAPI(\"POST\",\"api/signup/settings\",{changes:changes,currentPassword:validateInput.currentPassword,user:playerInfo.username});case 16:_yield$callAPI=_context.sent;user=_yield$callAPI.user;message=_yield$callAPI.message;ok=_yield$callAPI.ok;setWaitForServer(false);if(user){dispatch({type:\"setPlayerInfo\",value:user});setButtonText(lang===\"English\"?\"Your settings have been saved.\":\"Thay đổi của bạn đã được lưu\");setTimeout(function(){setButtonText(lang===\"English\"?\"Save\":\"Lưu\");},1000);}else if(message)validateInput.handleError(ok,message);case 22:_context.next=28;break;case 24:_context.prev=24;_context.t0=_context[\"catch\"](0);setWaitForServer(false);setUploadErr(_context.t0.message);case 28:case\"end\":return _context.stop();}}},_callee,null,[[0,24]]);}));return function handleSaveChange(_x){return _ref.apply(this,arguments);};}();useEffect(function(){if(playerInfo){var username=playerInfo.username,email=playerInfo.email,name=playerInfo.name;validateInput.setUsername(username?username:\"\");validateInput.setEmail(email.value?email.value:\"\");validateInput.setLastname(name.lastname?name.lastname:\"\");validateInput.setFirstname(name.firstname?name.firstname:\"\");}},[]);if(!playerInfo)return/*#__PURE__*/_jsx(Redirect,{to:\"/\"});if(waitForResponse)return/*#__PURE__*/_jsx(Spinner,{animation:\"border\",variant:\"secondary\",className:\"spinner\"});return/*#__PURE__*/_jsxs(Container,{fluid:true,className:\"settings-container\",children:[/*#__PURE__*/_jsx(NavBar,{setWaitForResponse:setWaitForResponse}),/*#__PURE__*/_jsxs(Row,{className:\"home-row mt-3\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"upload-pic-err\",style:{display:uploadErr||validateInput.error?\"block\":\" none\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\",onClick:function onClick(){validateInput.setError(null);setUploadErr(null);}}),uploadErr?uploadErr:validateInput.error]}),/*#__PURE__*/_jsxs(Col,{xs:11,md:7,children:[/*#__PURE__*/_jsx(ProfileHeader,{setError:setUploadErr,setting:true,playerInfo:playerInfo}),/*#__PURE__*/_jsxs(Form,{className:\"mt-3 mb-3 settings-form\",method:\"POST\",onSubmit:handleSaveChange,children:[/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mt-4 form-group-row\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,xs:12,lg:2,children:lang===\"English\"?\"Username\":\"Tên tài khoản\"}),/*#__PURE__*/_jsx(Col,{sm:12,lg:10,children:/*#__PURE__*/_jsxs(InputGroup,{hasValidation:true,children:[/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:validateInput.username,onChange:validateInput.handleUsernameChange,isInvalid:validateInput.invalidUsernameMess!==\"\"}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:validateInput.invalidUsernameMess})]})})]}),/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mt-4 form-group-row\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,xs:12,lg:2,children:\"Email\"}),/*#__PURE__*/_jsx(Col,{sm:12,lg:10,children:/*#__PURE__*/_jsxs(InputGroup,{hasValidation:true,children:[/*#__PURE__*/_jsx(Form.Control,{type:\"email\",value:validateInput.email,onChange:validateInput.handleEmailChange,isInvalid:validateInput.invalidEmailMess!==\"\"}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:validateInput.invalidEmailMess})]})})]}),/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mt-4 form-group-row\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,xs:12,lg:2,children:lang===\"English\"?\"Firstname\":\"Họ\"}),/*#__PURE__*/_jsx(Col,{sm:12,lg:10,children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:validateInput.firstname,onChange:validateInput.handleFirstnameChange})})]}),/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mt-4 form-group-row\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,xs:12,lg:2,children:lang===\"English\"?\"Lastname\":\"Tên\"}),/*#__PURE__*/_jsx(Col,{sm:12,lg:10,children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",value:validateInput.lastname,onChange:validateInput.handleLastnameChange})})]}),/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mt-4 form-group-row\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,xs:12,lg:2,children:lang===\"English\"?\"Current Password\":\"Mật khẩu hiện tại\"}),/*#__PURE__*/_jsx(Col,{sm:12,lg:10,children:/*#__PURE__*/_jsxs(InputGroup,{hasValidation:true,children:[/*#__PURE__*/_jsx(Form.Control,{type:\"password\",value:validateInput.currentPassword,onChange:validateInput.handleCurrentPasswordChange,isInvalid:validateInput.invalidCurrentPassword!==\"\"}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:validateInput.invalidCurrentPassword})]})})]}),/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mt-4 form-group-row\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,xs:12,lg:2,children:lang===\"English\"?\"New Password\":\"Mật khẩu mới\"}),/*#__PURE__*/_jsx(Col,{sm:12,lg:10,children:/*#__PURE__*/_jsxs(InputGroup,{hasValidation:true,className:\"password-group\",children:[/*#__PURE__*/_jsx(Form.Control,{type:validateInput.showPassword?\"text\":\"password\",value:validateInput.password,isInvalid:validateInput.invalidPasswordMess!==\"\",onChange:validateInput.handlePasswordChange}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:validateInput.invalidPasswordMess}),/*#__PURE__*/_jsx(\"button\",{className:\"toggle-password\",type:\"button\",style:{display:validateInput.invalidPasswordMess?\"none\":\"inline\"},onClick:function onClick(){validateInput.setShowPassword(!validateInput.showPassword);},children:validateInput.showPassword?\"Hide\":\"Show\"})]})})]}),/*#__PURE__*/_jsxs(Form.Group,{as:Row,className:\"mt-4 form-group-row\",children:[/*#__PURE__*/_jsx(Form.Label,{column:true,xs:12,lg:2,children:lang===\"English\"?\"Confirm New Password\":\"Xác nhận mật khẩu mới\"}),/*#__PURE__*/_jsx(Col,{sm:12,lg:10,children:/*#__PURE__*/_jsxs(InputGroup,{hasValidation:true,children:[/*#__PURE__*/_jsx(Form.Control,{type:\"password\",value:validateInput.confirmPassword,onChange:validateInput.handleConfirmPasswordChange,isInvalid:validateInput.confirmPasswordMess!==\"\"}),/*#__PURE__*/_jsx(Form.Control.Feedback,{type:\"invalid\",children:validateInput.confirmPasswordMess})]})})]}),/*#__PURE__*/_jsx(Col,{className:\"mt-4\",children:/*#__PURE__*/_jsx(Button,{type:\"submit\",className:\"submit-form-button\",children:waitForServer?/*#__PURE__*/_jsx(Spinner,{animation:\"border\",variant:\"dark\"}):buttonText})})]})]})]})]});};export default Settings;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/Components/Settings/Settings.jsx"],"names":["React","useState","useEffect","useSelector","useDispatch","Redirect","useFetchData","Form","Container","Row","Col","InputGroup","Spinner","Button","NavBar","callAPI","useValidateInput","ProfileHeader","Settings","dispatch","playerInfo","state","appState","lang","buttonText","setButtonText","uploadErr","setUploadErr","waitForServer","setWaitForServer","validateInput","waitForResponse","setWaitForResponse","getChanges","changes","username","email","lastname","firstname","value","verified","password","handleSaveChange","event","preventDefault","setError","confirmPassword","missingField","handleMissingField","setConfirmPasswordMess","invalidEmailMess","invalidPasswordMess","invalidUsernameMess","confirmPasswordMess","currentPassword","user","message","ok","type","setTimeout","handleError","name","setUsername","setEmail","setLastname","setFirstname","display","error","handleUsernameChange","handleEmailChange","handleFirstnameChange","handleLastnameChange","handleCurrentPasswordChange","invalidCurrentPassword","showPassword","handlePasswordChange","setShowPassword","handleConfirmPasswordChange"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport useFetchData from \"../App/useFetchData.js\";\r\nimport {\r\n  Form,\r\n  Container,\r\n  Row,\r\n  Col,\r\n  InputGroup,\r\n  Spinner,\r\n  Button,\r\n} from \"react-bootstrap\";\r\nimport NavBar from \"../Main/NavBar/NavBar.jsx\";\r\nimport \"./Settings.scss\";\r\nimport callAPI from \"../App/callAPI.js\";\r\nimport useValidateInput from \"../Signup/useValidateInput.js\";\r\nimport ProfileHeader from \"../Home/ProfileHeader/ProfileHeader.jsx\";\r\n\r\nconst Settings = () => {\r\n  const dispatch = useDispatch();\r\n  const playerInfo = useSelector((state) => state.appState.playerInfo);\r\n  const lang = useSelector((state) => state.appState.lang);\r\n  const [buttonText, setButtonText] = useState(\r\n    lang === \"English\" ? \"Save\" : \"Lưu\"\r\n  );\r\n  const [uploadErr, setUploadErr] = useState(null);\r\n  const [waitForServer, setWaitForServer] = useState(false);\r\n  const validateInput = useValidateInput(false, true, lang);\r\n  const [waitForResponse, setWaitForResponse] = useState(false);\r\n\r\n  const getChanges = () => {\r\n    const changes = {};\r\n    const { username, email, lastname, firstname } = validateInput;\r\n    if (playerInfo.username !== username) changes[\"username\"] = username;\r\n    if (playerInfo.email.value !== email) {\r\n      changes[\"email\"] = { value: email, verified: false };\r\n    }\r\n    changes[\"name.lastname\"] = lastname;\r\n    changes[\"name.firstname\"] = firstname;\r\n    if (validateInput.password) changes[\"password\"] = validateInput.password;\r\n    return changes;\r\n  };\r\n\r\n  const handleSaveChange = async (event) => {\r\n    try {\r\n      event.preventDefault();\r\n      if (waitForServer) return;\r\n      setUploadErr(\"\");\r\n      validateInput.setError(null);\r\n      const { password, confirmPassword } = validateInput;\r\n      const missingField = validateInput.handleMissingField(\r\n        !playerInfo.email.value\r\n      );\r\n      if (password !== confirmPassword) {\r\n        validateInput.setConfirmPasswordMess(\r\n          lang === \"English\" ? \"Password doesn't match\" : \"Mật khẩu không khớp\"\r\n        );\r\n        return;\r\n      }\r\n      if (\r\n        !missingField &&\r\n        !validateInput.invalidEmailMess &&\r\n        !validateInput.invalidPasswordMess &&\r\n        !validateInput.invalidUsernameMess &&\r\n        !validateInput.confirmPasswordMess\r\n      ) {\r\n        const changes = getChanges();\r\n        setWaitForServer(true);\r\n        const { user, message, ok } = await callAPI(\r\n          \"POST\",\r\n          \"api/signup/settings\",\r\n          {\r\n            changes: changes,\r\n            currentPassword: validateInput.currentPassword,\r\n            user: playerInfo.username,\r\n          }\r\n        );\r\n        setWaitForServer(false);\r\n        if (user) {\r\n          dispatch({ type: \"setPlayerInfo\", value: user });\r\n          setButtonText(\r\n            lang === \"English\"\r\n              ? \"Your settings have been saved.\"\r\n              : \"Thay đổi của bạn đã được lưu\"\r\n          );\r\n          setTimeout(() => {\r\n            setButtonText(lang === \"English\" ? \"Save\" : \"Lưu\");\r\n          }, 1000);\r\n        } else if (message) validateInput.handleError(ok, message);\r\n      }\r\n    } catch (err) {\r\n      setWaitForServer(false);\r\n      setUploadErr(err.message);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (playerInfo) {\r\n      const { username, email, name } = playerInfo;\r\n      validateInput.setUsername(username ? username : \"\");\r\n      validateInput.setEmail(email.value ? email.value : \"\");\r\n      validateInput.setLastname(name.lastname ? name.lastname : \"\");\r\n      validateInput.setFirstname(name.firstname ? name.firstname : \"\");\r\n    }\r\n  }, []);\r\n\r\n  if (!playerInfo) return <Redirect to=\"/\" />;\r\n\r\n  if (waitForResponse)\r\n    return (\r\n      <Spinner animation=\"border\" variant=\"secondary\" className=\"spinner\" />\r\n    );\r\n\r\n  return (\r\n    <Container fluid className=\"settings-container\">\r\n      <NavBar setWaitForResponse={setWaitForResponse} />\r\n      <Row className=\"home-row mt-3\">\r\n        <p\r\n          className=\"upload-pic-err\"\r\n          style={{\r\n            display: uploadErr || validateInput.error ? \"block\" : \" none\",\r\n          }}\r\n        >\r\n          <i\r\n            className=\"fas fa-times\"\r\n            onClick={() => {\r\n              validateInput.setError(null);\r\n              setUploadErr(null);\r\n            }}\r\n          ></i>\r\n          {uploadErr ? uploadErr : validateInput.error}\r\n        </p>\r\n        <Col xs={11} md={7}>\r\n          <ProfileHeader\r\n            setError={setUploadErr}\r\n            setting={true}\r\n            playerInfo={playerInfo}\r\n          />\r\n          <Form\r\n            className=\"mt-3 mb-3 settings-form\"\r\n            method=\"POST\"\r\n            onSubmit={handleSaveChange}\r\n          >\r\n            <Form.Group as={Row} className=\"mt-4 form-group-row\">\r\n              <Form.Label column xs={12} lg={2}>\r\n                {lang === \"English\" ? \"Username\" : \"Tên tài khoản\"}\r\n              </Form.Label>\r\n              <Col sm={12} lg={10}>\r\n                <InputGroup hasValidation>\r\n                  <Form.Control\r\n                    type=\"text\"\r\n                    value={validateInput.username}\r\n                    onChange={validateInput.handleUsernameChange}\r\n                    isInvalid={validateInput.invalidUsernameMess !== \"\"}\r\n                  />\r\n                  <Form.Control.Feedback type=\"invalid\">\r\n                    {validateInput.invalidUsernameMess}\r\n                  </Form.Control.Feedback>\r\n                </InputGroup>\r\n              </Col>\r\n            </Form.Group>\r\n            <Form.Group as={Row} className=\"mt-4 form-group-row\">\r\n              <Form.Label column xs={12} lg={2}>\r\n                Email\r\n              </Form.Label>\r\n              <Col sm={12} lg={10}>\r\n                <InputGroup hasValidation>\r\n                  <Form.Control\r\n                    type=\"email\"\r\n                    value={validateInput.email}\r\n                    onChange={validateInput.handleEmailChange}\r\n                    isInvalid={validateInput.invalidEmailMess !== \"\"}\r\n                  />\r\n                  <Form.Control.Feedback type=\"invalid\">\r\n                    {validateInput.invalidEmailMess}\r\n                  </Form.Control.Feedback>\r\n                </InputGroup>\r\n              </Col>\r\n            </Form.Group>\r\n            <Form.Group as={Row} className=\"mt-4 form-group-row\">\r\n              <Form.Label column xs={12} lg={2}>\r\n                {lang === \"English\" ? \"Firstname\" : \"Họ\"}\r\n              </Form.Label>\r\n              <Col sm={12} lg={10}>\r\n                <Form.Control\r\n                  type=\"text\"\r\n                  value={validateInput.firstname}\r\n                  onChange={validateInput.handleFirstnameChange}\r\n                />\r\n              </Col>\r\n            </Form.Group>\r\n            <Form.Group as={Row} className=\"mt-4 form-group-row\">\r\n              <Form.Label column xs={12} lg={2}>\r\n                {lang === \"English\" ? \"Lastname\" : \"Tên\"}\r\n              </Form.Label>\r\n              <Col sm={12} lg={10}>\r\n                <Form.Control\r\n                  type=\"text\"\r\n                  value={validateInput.lastname}\r\n                  onChange={validateInput.handleLastnameChange}\r\n                />\r\n              </Col>\r\n            </Form.Group>\r\n\r\n            <Form.Group as={Row} className=\"mt-4 form-group-row\">\r\n              <Form.Label column xs={12} lg={2}>\r\n                {lang === \"English\" ? \"Current Password\" : \"Mật khẩu hiện tại\"}\r\n              </Form.Label>\r\n              <Col sm={12} lg={10}>\r\n                <InputGroup hasValidation>\r\n                  <Form.Control\r\n                    type=\"password\"\r\n                    value={validateInput.currentPassword}\r\n                    onChange={validateInput.handleCurrentPasswordChange}\r\n                    isInvalid={validateInput.invalidCurrentPassword !== \"\"}\r\n                  />\r\n                  <Form.Control.Feedback type=\"invalid\">\r\n                    {validateInput.invalidCurrentPassword}\r\n                  </Form.Control.Feedback>\r\n                </InputGroup>\r\n              </Col>\r\n            </Form.Group>\r\n\r\n            <Form.Group as={Row} className=\"mt-4 form-group-row\">\r\n              <Form.Label column xs={12} lg={2}>\r\n                {lang === \"English\" ? \"New Password\" : \"Mật khẩu mới\"}\r\n              </Form.Label>\r\n              <Col sm={12} lg={10}>\r\n                <InputGroup hasValidation className=\"password-group\">\r\n                  <Form.Control\r\n                    type={validateInput.showPassword ? \"text\" : \"password\"}\r\n                    value={validateInput.password}\r\n                    isInvalid={validateInput.invalidPasswordMess !== \"\"}\r\n                    onChange={validateInput.handlePasswordChange}\r\n                  />\r\n                  <Form.Control.Feedback type=\"invalid\">\r\n                    {validateInput.invalidPasswordMess}\r\n                  </Form.Control.Feedback>\r\n                  <button\r\n                    className=\"toggle-password\"\r\n                    type=\"button\"\r\n                    style={{\r\n                      display: validateInput.invalidPasswordMess\r\n                        ? \"none\"\r\n                        : \"inline\",\r\n                    }}\r\n                    onClick={() => {\r\n                      validateInput.setShowPassword(\r\n                        !validateInput.showPassword\r\n                      );\r\n                    }}\r\n                  >\r\n                    {validateInput.showPassword ? \"Hide\" : \"Show\"}\r\n                  </button>\r\n                </InputGroup>\r\n              </Col>\r\n            </Form.Group>\r\n\r\n            <Form.Group as={Row} className=\"mt-4 form-group-row\">\r\n              <Form.Label column xs={12} lg={2}>\r\n                {lang === \"English\"\r\n                  ? \"Confirm New Password\"\r\n                  : \"Xác nhận mật khẩu mới\"}\r\n              </Form.Label>\r\n              <Col sm={12} lg={10}>\r\n                <InputGroup hasValidation>\r\n                  <Form.Control\r\n                    type=\"password\"\r\n                    value={validateInput.confirmPassword}\r\n                    onChange={validateInput.handleConfirmPasswordChange}\r\n                    isInvalid={validateInput.confirmPasswordMess !== \"\"}\r\n                  />\r\n                  <Form.Control.Feedback type=\"invalid\">\r\n                    {validateInput.confirmPasswordMess}\r\n                  </Form.Control.Feedback>\r\n                </InputGroup>\r\n              </Col>\r\n            </Form.Group>\r\n            <Col className=\"mt-4\">\r\n              <Button type=\"submit\" className=\"submit-form-button\">\r\n                {waitForServer ? (\r\n                  <Spinner animation=\"border\" variant=\"dark\" />\r\n                ) : (\r\n                  buttonText\r\n                )}\r\n              </Button>\r\n            </Col>\r\n          </Form>\r\n        </Col>\r\n      </Row>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default Settings;\r\n"]},"metadata":{},"sourceType":"module"}