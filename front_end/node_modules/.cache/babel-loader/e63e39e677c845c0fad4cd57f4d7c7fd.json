{"ast":null,"code":"import _toConsumableArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _createForOfIteratorHelper from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _slicedToArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";var Piece=/*#__PURE__*/function(){function Piece(width,row,col,name,choosenSide){_classCallCheck(this,Piece);this.width=width;this.position=[row,col];this.name=name;this.side=name.split(\"-\")[1];this.choosenSide=choosenSide;this.minCol=0;this.maxCol=8;this.minRow=0;this.maxRow=9;this.translate=\"translate(\".concat(width*col,\", \").concat(width*row,\")\");}_createClass(Piece,[{key:\"move\",value:function move(x,y){var translate=\"translate(\".concat(x-this.width/2,\", \").concat(y-this.width/2,\")\");this.translate=translate;}},{key:\"checkValidMove\",value:function checkValidMove(newRow,newCol,board){var _this$position=_slicedToArray(this.position,2),curRow=_this$position[0],curCol=_this$position[1];var moveRow=newRow-curRow,moveCol=newCol-curCol;var valid=newCol>=this.minCol&&newCol<=this.maxCol&&newRow>=this.minRow&&newRow<=this.maxRow;var existMove=this.moves.some(function(move){return move[0]===moveRow&&move[1]===moveCol;});if(valid&&existMove){if(!this.moveHint){var generalTranslate=this.putGeneralInDanger(newRow,newCol,board);if(generalTranslate)return generalTranslate;}return true;}return false;}},{key:\"setPosition\",value:function setPosition(capture,newRow,newCol){var translateX=newCol*this.width,translateY=newRow*this.width;var translate=\"translate(\".concat(translateX,\", \").concat(translateY,\")\");this.position=[newRow,newCol];this.translate=translate;return[capture===\"capture\",newRow,newCol];}},{key:\"canMoveToNewPosition\",value:function canMoveToNewPosition(newRow,newCol,board){var _this$position2=_slicedToArray(this.position,2),curRow=_this$position2[0],curCol=_this$position2[1];var translateX=curCol*this.width,translateY=curRow*this.width;this.translate=\"translate(\".concat(translateX,\", \").concat(translateY,\")\");if(this.side===this.choosenSide[1]){var isValid=this.checkValidMove(newRow,newCol,board);if(isValid&&!/translate/.test(isValid)){if(!board[newRow][newCol].side){if(this.countPiecesBetween(newRow,newCol,board)===0)return true;}else if(board[newRow][newCol].side!==board[curRow][curCol].side)if(this.countPiecesBetween(newRow,newCol,board)===1)return\"capture\";}else if(isValid)return isValid;}return false;}},{key:\"showMoveHints\",value:function showMoveHints(mode,board){if(mode===\"off\"){for(var i=0;i<10;i++){for(var j=0;j<9;j++){if(board[i][j]===false)board[i][j]=0;else if(board[i][j])board[i][j].canBeCaptured=false;}}return;}var _this$position3=_slicedToArray(this.position,2),curRow=_this$position3[0],curCol=_this$position3[1];var _iterator=_createForOfIteratorHelper(this.moves),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var move=_step.value;var newRow=curRow+move[0],newCol=curCol+move[1];this.moveHint=true;var moveResult=this.canMoveToNewPosition(newRow,newCol,board);this.moveHint=false;if(moveResult){if(moveResult===\"capture\"){board[newRow][newCol].canBeCaptured=true;}else board[newRow][newCol]=false;}}}catch(err){_iterator.e(err);}finally{_iterator.f();}}},{key:\"countPiecesBetween\",value:function countPiecesBetween(newRow,newCol,board){var _this$position4=_slicedToArray(this.position,2),curRow=_this$position4[0],curCol=_this$position4[1];var count=0;if(newRow===curRow){do{curCol+=curCol>newCol?-1:1;if(board[curRow][curCol])count++;}while(curCol!==newCol);}else{do{curRow+=curRow>newRow?-1:1;if(board[curRow][curCol])count++;}while(curRow!==newRow);}return count;}},{key:\"putGeneralInDanger\",value:function putGeneralInDanger(newRow,newCol,board){var tmpBoard=board.reduce(function(acc,row){acc.push(_toConsumableArray(row));return acc;},[]);this.updateTmpBoard(newRow,newCol,tmpBoard);return Piece.isGeneralInDanger(tmpBoard,this.side);}},{key:\"updateTmpBoard\",value:function updateTmpBoard(newRow,newCol,tmpBoard){var _this$position5=_slicedToArray(this.position,2),curRow=_this$position5[0],curCol=_this$position5[1];var tmp=tmpBoard[curRow][curCol];tmpBoard[curRow][curCol]=0;tmpBoard[newRow][newCol]=tmp;}},{key:\"canCaptureGeneral\",value:function canCaptureGeneral(tmpBoard){var _this$position6=_slicedToArray(this.position,2),curRow=_this$position6[0],curCol=_this$position6[1];var _iterator2=_createForOfIteratorHelper(this.moves),_step2;try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var move=_step2.value;var newRow=curRow+move[0],newCol=curCol+move[1];if(newCol>=0&&newCol<9&&newRow>=0&&newRow<10){if(tmpBoard[newRow][newCol].side)if(tmpBoard[newRow][newCol].side!==tmpBoard[curRow][curCol].side)if(this.countPiecesBetween(newRow,newCol,tmpBoard)===1)if(tmpBoard[newRow][newCol].name.split(\"-\")[0]===\"general\"){return tmpBoard[newRow][newCol].translate;}}}}catch(err){_iterator2.e(err);}finally{_iterator2.f();}return false;}},{key:\"modifyBoard\",value:function modifyBoard(board,_ref,dispatch){var _ref2=_slicedToArray(_ref,2),newRow=_ref2[0],newCol=_ref2[1];var _this$position7=_slicedToArray(this.position,2),curRow=_this$position7[0],curCol=_this$position7[1];this.setPosition(null,newRow,newCol);var tmp=board[curRow][curCol];if(board[newRow][newCol]){dispatch({type:\"setCapturedPieces\",value:board[newRow][newCol]});}board[curRow][curCol]=0;board[newRow][newCol]=tmp;dispatch({type:\"setBoard\",value:_toConsumableArray(board)});}},{key:\"animateMove\",value:function animateMove(_ref3,board,dispatch){var _ref4=_slicedToArray(_ref3,2),newRow=_ref4[0],newCol=_ref4[1];var curCol=this.position[1];if(curCol===newCol){this.moveVertical([newRow,newCol],board,dispatch);}else this.moveDiagonal([newRow,newCol],board,dispatch);}},{key:\"setTransform\",value:function setTransform(_ref5,board,dispatch,finished){var _ref6=_slicedToArray(_ref5,2),xB=_ref6[0],yB=_ref6[1];var translate=\"translate(\".concat(xB*this.width,\", \").concat(yB*this.width,\")\");this.translate=translate;dispatch({type:\"setBoard\",value:_toConsumableArray(board)});if(finished){this.modifyBoard(board,[yB,xB],dispatch);}}},{key:\"moveVertical\",value:function moveVertical(_ref7,board,dispatch){var _this=this;var _ref8=_slicedToArray(_ref7,2),yB=_ref8[0],xB=_ref8[1];var _this$position8=_slicedToArray(this.position,2),yA=_this$position8[0],xA=_this$position8[1];var step=0;var start;var animate=function animate(timestamp){if(start===undefined)start=timestamp;var timeElapsed=timestamp-start;step=(yB-yA)/270*timeElapsed;if(Math.abs(step)<Math.abs(yB-yA)){_this.setTransform([xA,yA+step],board,dispatch);window.requestAnimationFrame(animate);}else if(Math.abs(step)>=Math.abs(yB-yA)){_this.setTransform([xB,yB],board,dispatch,true);}};window.requestAnimationFrame(animate);}},{key:\"moveDiagonal\",value:function moveDiagonal(_ref9,board,dispatch){var _this2=this;var _ref10=_slicedToArray(_ref9,2),yB=_ref10[0],xB=_ref10[1];var _this$position9=_slicedToArray(this.position,2),yA=_this$position9[0],xA=_this$position9[1];var step=0;var start;var animate=function animate(timestamp){if(start===undefined)start=timestamp;var timeElapsed=timestamp-start;step=(xB-xA)/270*timeElapsed;if(Math.abs(step)<Math.abs(xB-xA)){var y=step/(xB-xA)*(yB-yA)+yA;_this2.setTransform([xA+step,y],board,dispatch);window.requestAnimationFrame(animate);}else if(Math.abs(step)>=Math.abs(xB-xA)){_this2.setTransform([xB,yB],board,dispatch,true);}};window.requestAnimationFrame(animate);}}],[{key:\"isGeneralInDanger\",value:function isGeneralInDanger(board,side){for(var i=0;i<10;i++){for(var j=0;j<9;j++){if(board[i][j]&&board[i][j].side!==side){var canCapture=board[i][j].canCaptureGeneral(board);if(/translate/.test(canCapture))return canCapture;}}}return false;}},{key:\"isLost\",value:function isLost(board,side){for(var i=0;i<10;i++){for(var j=0;j<9;j++){if(board[i][j]&&board[i][j].side===side){var _board$i$j$position=_slicedToArray(board[i][j].position,2),curRow=_board$i$j$position[0],curCol=_board$i$j$position[1];var _iterator3=_createForOfIteratorHelper(board[i][j].moves),_step3;try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var move=_step3.value;var newRow=curRow+move[0],newCol=curCol+move[1];var tmp=board[i][j].canMoveToNewPosition(newRow,newCol,board);if(tmp&&!/translate/.test(tmp))return null;}}catch(err){_iterator3.e(err);}finally{_iterator3.f();}}}}if(Piece.isGeneralInDanger(board,side)){return\"Checkmate\";}return\"Stalemate\";}}]);return Piece;}();export default Piece;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/pieces/piece.js"],"names":["Piece","width","row","col","name","choosenSide","position","side","split","minCol","maxCol","minRow","maxRow","translate","x","y","newRow","newCol","board","curRow","curCol","moveRow","moveCol","valid","existMove","moves","some","move","moveHint","generalTranslate","putGeneralInDanger","capture","translateX","translateY","isValid","checkValidMove","test","countPiecesBetween","mode","i","j","canBeCaptured","moveResult","canMoveToNewPosition","count","tmpBoard","reduce","acc","push","updateTmpBoard","isGeneralInDanger","tmp","dispatch","setPosition","type","value","moveVertical","moveDiagonal","finished","xB","yB","modifyBoard","yA","xA","step","start","animate","timestamp","undefined","timeElapsed","Math","abs","setTransform","window","requestAnimationFrame","canCapture","canCaptureGeneral"],"mappings":"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","sourcesContent":["class Piece {\r\n  constructor(width, row, col, name, choosenSide) {\r\n    this.width = width;\r\n    this.position = [row, col];\r\n    this.name = name;\r\n    this.side = name.split(\"-\")[1];\r\n    this.choosenSide = choosenSide;\r\n    this.minCol = 0;\r\n    this.maxCol = 8;\r\n    this.minRow = 0;\r\n    this.maxRow = 9;\r\n    this.translate = `translate(${width * col}, ${width * row})`;\r\n  }\r\n\r\n  move(x, y) {\r\n    const translate = `translate(${x - this.width / 2}, ${y - this.width / 2})`;\r\n    this.translate = translate;\r\n  }\r\n\r\n  checkValidMove(newRow, newCol, board) {\r\n    const [curRow, curCol] = this.position;\r\n    const [moveRow, moveCol] = [newRow - curRow, newCol - curCol];\r\n    const valid =\r\n      newCol >= this.minCol &&\r\n      newCol <= this.maxCol &&\r\n      newRow >= this.minRow &&\r\n      newRow <= this.maxRow;\r\n    const existMove = this.moves.some((move) => {\r\n      return move[0] === moveRow && move[1] === moveCol;\r\n    });\r\n    if (valid && existMove) {\r\n      if (!this.moveHint) {\r\n        const generalTranslate = this.putGeneralInDanger(newRow, newCol, board);\r\n        if (generalTranslate) return generalTranslate;\r\n      }\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  setPosition(capture, newRow, newCol) {\r\n    const [translateX, translateY] = [newCol * this.width, newRow * this.width];\r\n    const translate = `translate(${translateX}, ${translateY})`;\r\n    this.position = [newRow, newCol];\r\n    this.translate = translate;\r\n    return [capture === \"capture\", newRow, newCol];\r\n  }\r\n\r\n  canMoveToNewPosition(newRow, newCol, board) {\r\n    const [curRow, curCol] = this.position;\r\n    const [translateX, translateY] = [curCol * this.width, curRow * this.width];\r\n    this.translate = `translate(${translateX}, ${translateY})`;\r\n    if (this.side === this.choosenSide[1]) {\r\n      const isValid = this.checkValidMove(newRow, newCol, board);\r\n      if (isValid && !/translate/.test(isValid)) {\r\n        if (!board[newRow][newCol].side) {\r\n          if (this.countPiecesBetween(newRow, newCol, board) === 0) return true;\r\n        } else if (board[newRow][newCol].side !== board[curRow][curCol].side)\r\n          if (this.countPiecesBetween(newRow, newCol, board) === 1)\r\n            return \"capture\";\r\n      } else if (isValid) return isValid;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  showMoveHints(mode, board) {\r\n    if (mode === \"off\") {\r\n      for (let i = 0; i < 10; i++) {\r\n        for (let j = 0; j < 9; j++) {\r\n          if (board[i][j] === false) board[i][j] = 0;\r\n          else if (board[i][j]) board[i][j].canBeCaptured = false;\r\n        }\r\n      }\r\n      return;\r\n    }\r\n    const [curRow, curCol] = this.position;\r\n    for (let move of this.moves) {\r\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n      this.moveHint = true;\r\n      const moveResult = this.canMoveToNewPosition(newRow, newCol, board);\r\n      this.moveHint = false;\r\n      if (moveResult) {\r\n        if (moveResult === \"capture\") {\r\n          board[newRow][newCol].canBeCaptured = true;\r\n        } else board[newRow][newCol] = false;\r\n      }\r\n    }\r\n  }\r\n\r\n  countPiecesBetween(newRow, newCol, board) {\r\n    let [curRow, curCol] = this.position;\r\n    let count = 0;\r\n    if (newRow === curRow) {\r\n      do {\r\n        curCol += curCol > newCol ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curCol !== newCol);\r\n    } else {\r\n      do {\r\n        curRow += curRow > newRow ? -1 : 1;\r\n        if (board[curRow][curCol]) count++;\r\n      } while (curRow !== newRow);\r\n    }\r\n    return count;\r\n  }\r\n\r\n  static isGeneralInDanger(board, side) {\r\n    for (let i = 0; i < 10; i++) {\r\n      for (let j = 0; j < 9; j++) {\r\n        if (board[i][j] && board[i][j].side !== side) {\r\n          const canCapture = board[i][j].canCaptureGeneral(board);\r\n          if (/translate/.test(canCapture)) return canCapture;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  putGeneralInDanger(newRow, newCol, board) {\r\n    const tmpBoard = board.reduce((acc, row) => {\r\n      acc.push([...row]);\r\n      return acc;\r\n    }, []);\r\n    this.updateTmpBoard(newRow, newCol, tmpBoard);\r\n    return Piece.isGeneralInDanger(tmpBoard, this.side);\r\n  }\r\n\r\n  static isLost(board, side) {\r\n    for (let i = 0; i < 10; i++) {\r\n      for (let j = 0; j < 9; j++) {\r\n        if (board[i][j] && board[i][j].side === side) {\r\n          const [curRow, curCol] = board[i][j].position;\r\n          for (let move of board[i][j].moves) {\r\n            const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n            const tmp = board[i][j].canMoveToNewPosition(newRow, newCol, board);\r\n            if (tmp && !/translate/.test(tmp)) return null;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (Piece.isGeneralInDanger(board, side)) {\r\n      return \"Checkmate\";\r\n    }\r\n    return \"Stalemate\";\r\n  }\r\n\r\n  updateTmpBoard(newRow, newCol, tmpBoard) {\r\n    const [curRow, curCol] = this.position;\r\n    const tmp = tmpBoard[curRow][curCol];\r\n    tmpBoard[curRow][curCol] = 0;\r\n    tmpBoard[newRow][newCol] = tmp;\r\n  }\r\n\r\n  canCaptureGeneral(tmpBoard) {\r\n    const [curRow, curCol] = this.position;\r\n    for (let move of this.moves) {\r\n      const [newRow, newCol] = [curRow + move[0], curCol + move[1]];\r\n      if (newCol >= 0 && newCol < 9 && newRow >= 0 && newRow < 10) {\r\n        if (tmpBoard[newRow][newCol].side)\r\n          if (tmpBoard[newRow][newCol].side !== tmpBoard[curRow][curCol].side)\r\n            if (this.countPiecesBetween(newRow, newCol, tmpBoard) === 1)\r\n              if (tmpBoard[newRow][newCol].name.split(\"-\")[0] === \"general\") {\r\n                return tmpBoard[newRow][newCol].translate;\r\n              }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  modifyBoard(board, [newRow, newCol], dispatch) {\r\n    const [curRow, curCol] = this.position;\r\n    this.setPosition(null, newRow, newCol);\r\n    const tmp = board[curRow][curCol];\r\n    if (board[newRow][newCol]) {\r\n      dispatch({ type: \"setCapturedPieces\", value: board[newRow][newCol] });\r\n    }\r\n    board[curRow][curCol] = 0;\r\n    board[newRow][newCol] = tmp;\r\n    dispatch({ type: \"setBoard\", value: [...board] });\r\n  }\r\n\r\n  animateMove([newRow, newCol], board, dispatch) {\r\n    const curCol = this.position[1];\r\n    if (curCol === newCol) {\r\n      this.moveVertical([newRow, newCol], board, dispatch);\r\n    } else this.moveDiagonal([newRow, newCol], board, dispatch);\r\n  }\r\n\r\n  setTransform([xB, yB], board, dispatch, finished) {\r\n    const translate = `translate(${xB * this.width}, ${yB * this.width})`;\r\n    this.translate = translate;\r\n    dispatch({ type: \"setBoard\", value: [...board] });\r\n    if (finished) {\r\n      this.modifyBoard(board, [yB, xB], dispatch);\r\n    }\r\n  }\r\n\r\n  moveVertical([yB, xB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    let step = 0;\r\n    let start;\r\n\r\n    const animate = (timestamp) => {\r\n      if (start === undefined) start = timestamp;\r\n      const timeElapsed = timestamp - start;\r\n      step = ((yB - yA) / 270) * timeElapsed;\r\n      if (Math.abs(step) < Math.abs(yB - yA)) {\r\n        this.setTransform([xA, yA + step], board, dispatch);\r\n        window.requestAnimationFrame(animate);\r\n      } else if (Math.abs(step) >= Math.abs(yB - yA)) {\r\n        this.setTransform([xB, yB], board, dispatch, true);\r\n      }\r\n    };\r\n\r\n    window.requestAnimationFrame(animate);\r\n  }\r\n\r\n  moveDiagonal([yB, xB], board, dispatch) {\r\n    const [yA, xA] = this.position;\r\n    let step = 0;\r\n    let start;\r\n\r\n    const animate = (timestamp) => {\r\n      if (start === undefined) start = timestamp;\r\n      const timeElapsed = timestamp - start;\r\n      step = ((xB - xA) / 270) * timeElapsed;\r\n      if (Math.abs(step) < Math.abs(xB - xA)) {\r\n        let y = (step / (xB - xA)) * (yB - yA) + yA;\r\n        this.setTransform([xA + step, y], board, dispatch);\r\n        window.requestAnimationFrame(animate);\r\n      } else if (Math.abs(step) >= Math.abs(xB - xA)) {\r\n        this.setTransform([xB, yB], board, dispatch, true);\r\n      }\r\n    };\r\n\r\n    window.requestAnimationFrame(animate);\r\n  }\r\n}\r\n\r\nexport default Piece;\r\n"]},"metadata":{},"sourceType":"module"}