{"ast":null,"code":"import _objectWithoutProperties from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";import _objectSpread from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"F:/Web/C\\u1EDD T\\u01B0\\u1EDBng/front_end/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState,useContext,useRef}from\"react\";import\"./PlayWithFriend.scss\";import{Button,Tooltip,Overlay,Spinner}from\"react-bootstrap\";import renderPlayersList from\"./renderPlayersList.js\";import renderPendingPlayers from\"./renderPendingPlayers.js\";import callAPI from\"../../../../App/callAPI.js\";import{SocketContext}from\"../../../../App/context.js\";import{useSelector}from\"react-redux\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var PlayWithFriend=function PlayWithFriend(_ref){var goBack=_ref.goBack,lang=_ref.lang;var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),input=_useState2[0],setInput=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),playersList=_useState4[0],setPlayersList=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),waitForResponse=_useState6[0],setWaitForResponse=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),pendingPlayers=_useState8[0],setPendingPlayers=_useState8[1];var playerInfo=useSelector(function(state){return state.appState.playerInfo;});var socket=useContext(SocketContext);var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),show=_useState10[0],setShow=_useState10[1];var target=useRef(null);var copyButton=useRef(null);var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),inviteLink=_useState12[0],setInviteLink=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),invitedPlayer=_useState14[0],setInvitedPlayer=_useState14[1];var time=useSelector(function(state){return state.gameState.time;});var side=useSelector(function(state){return state.boardState.side;});var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),showText=_useState16[0],setShowText=_useState16[1];var handleSelectPlayer=function handleSelectPlayer(event){var name=event.currentTarget.getAttribute(\"playername\");setInput(name);setPlayersList([]);};var replaceSpecialCharacters=function replaceSpecialCharacters(str){return str.replace(/[^0-9a-zA-Z_-]+/g,\"\");};var handleOnChange=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var value,_yield$callAPI,players,reCheck,name;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;value=event.currentTarget.value;setInput(value);if(!value){_context.next=15;break;}_context.next=6;return callAPI(\"POST\",\"api/players\",{playername:replaceSpecialCharacters(value)});case 6:_yield$callAPI=_context.sent;players=_yield$callAPI.players;reCheck=document.querySelector(\"#player-name-search\").value;if(players){_context.next=11;break;}return _context.abrupt(\"return\");case 11:name=playerInfo.username;if(reCheck)setPlayersList(renderPlayersList(players,handleSelectPlayer,name));_context.next=16;break;case 15:setPlayersList([]);case 16:_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](0);handleCanotSendInvite(lang===\"English\"?\"Something went wrong there. Try again\":\"Đã xảy ra lỗi. Xin hãy thử lại\");case 21:case\"end\":return _context.stop();}}},_callee,null,[[0,18]]);}));return function handleOnChange(_x){return _ref2.apply(this,arguments);};}();var cancelInvite=function cancelInvite(event){var playername=event.currentTarget.getAttribute(\"playername\");var index=pendingPlayers.findIndex(function(player){return player.username===playername;});socket.emit(\"cancelInvite\",pendingPlayers[index].socketID,false);setPendingPlayers(function(prevState){prevState.splice(index,1);return _toConsumableArray(prevState);});};var handleCanotSendInvite=function handleCanotSendInvite(reason){setWaitForResponse(false);setShow(reason);setTimeout(function(){setShow(\"\");},1000);};var handleSendInvite=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var index,_yield$callAPI2,players;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;event.preventDefault();if(!waitForResponse){_context2.next=4;break;}return _context2.abrupt(\"return\");case 4:index=pendingPlayers.findIndex(function(player){return player.username===input;});if(!(index===-1)){_context2.next=24;break;}setWaitForResponse(true);_context2.next=9;return callAPI(\"POST\",\"api/players\",{playername:replaceSpecialCharacters(input),exact:true});case 9:_yield$callAPI2=_context2.sent;players=_yield$callAPI2.players;if(!(players.length&&players[0].username!==playerInfo.username)){_context2.next=23;break;}if(!players[0].socketID){_context2.next=20;break;}if(!(pendingPlayers.length+1>5)){_context2.next=16;break;}handleCanotSendInvite(lang===\"English\"?\"You have sent too many invites\":\"Bạn đã gửi quá nhiều lời mời\");return _context2.abrupt(\"return\");case 16:setInvitedPlayer(players[0]);socket.emit(\"setTimeAndSide\",time,side[1],function(){socket.emit(\"sendInvite\",players[0].socketID,players[0].username);});_context2.next=21;break;case 20:handleCanotSendInvite(\"\".concat(players[0].username,\" \").concat(lang===\"English\"?\"isn't\":\"không\",\" online\"));case 21:_context2.next=24;break;case 23:handleCanotSendInvite(lang===\"English\"?\"user not found\":\"không tìm thấy\");case 24:_context2.next=29;break;case 26:_context2.prev=26;_context2.t0=_context2[\"catch\"](0);handleCanotSendInvite(lang===\"English\"?\"Something went wrong there. Try again\":\"Đã xảy ra lỗi. Xin hãy thử lại\");case 29:case\"end\":return _context2.stop();}}},_callee2,null,[[0,26]]);}));return function handleSendInvite(_x2){return _ref3.apply(this,arguments);};}();var clearInput=function clearInput(){setInput(\"\");setPlayersList([]);};var handleGenerateInviteLink=function handleGenerateInviteLink(){socket.emit(\"setTimeAndSide\",time,side[1],function(){socket.emit(\"generateInviteLink\",function(inviteLink){setInviteLink(inviteLink);});});};var handleCopyLink=function handleCopyLink(){navigator.clipboard.writeText(inviteLink).then(function(){setShowText(true);setTimeout(function(){setShowText(false);},1000);});};useEffect(function(){socket.on(\"validInvite\",function(){setWaitForResponse(false);setPendingPlayers(function(prevState){prevState.push(invitedPlayer);return _toConsumableArray(prevState);});});socket.on(\"inviteDeclined\",function(receiverInfo){var index=pendingPlayers.findIndex(function(player){return player.username===receiverInfo.playername;});if(index!==-1){setPendingPlayers(function(prevState){prevState[index].declineInvite=true;return _toConsumableArray(prevState);});setTimeout(function(){setPendingPlayers(function(prevState){prevState.splice(index,1);return _toConsumableArray(prevState);});},1000);}});socket.on(\"invalidInvite\",function(message){setWaitForResponse(false);handleCanotSendInvite(message);});return function(){socket.removeAllListeners(\"validInvite\");socket.removeAllListeners(\"invalidInvite\");socket.removeAllListeners(\"inviteDeclined\");socket.removeAllListeners(\"playerInGame\");};},[invitedPlayer,pendingPlayers]);useEffect(function(){return function(){socket.emit(\"cancelInvite\",null,true);};},[]);return/*#__PURE__*/_jsxs(\"div\",{className:\"play-with-friend-container\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-arrow-left fa-2x\",onClick:goBack}),/*#__PURE__*/_jsx(\"ul\",{className:\"players-pending players-list\",children:renderPendingPlayers(pendingPlayers,cancelInvite,lang)}),/*#__PURE__*/_jsxs(\"div\",{className:\"btn-container\",children:[/*#__PURE__*/_jsxs(\"form\",{className:\"username-input\",onSubmit:handleSendInvite,method:\"POST\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-search\"}),/*#__PURE__*/_jsx(\"input\",{id:\"player-name-search\",type:\"text\",placeholder:lang===\"English\"?\"Search...\":\"Tìm kiếm...\",onInput:handleOnChange,value:input}),/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\",onClick:clearInput,style:{display:input?\"inline\":\"none\"}}),/*#__PURE__*/_jsx(Button,{className:\"invite\",type:\"submit\",ref:target,children:waitForResponse?/*#__PURE__*/_jsx(Spinner,{animation:\"border\",variant:\"info\",style:{width:\"1.5rem\",height:\"1.5rem\"}}):lang===\"English\"?\"Invite\":/*#__PURE__*/_jsx(_Fragment,{children:\"\\xA0\\xA0M\\u1EDDi\\xA0\\xA0\"})}),/*#__PURE__*/_jsx(Overlay,{target:target.current,show:show!==\"\",children:function children(props){return/*#__PURE__*/_jsx(Tooltip,_objectSpread(_objectSpread({},props),{},{children:show}));}}),/*#__PURE__*/_jsx(\"ul\",{className:\"players-list\",children:playersList})]}),/*#__PURE__*/_jsx(Button,{className:\"invite-link\",onClick:handleGenerateInviteLink,children:lang===\"English\"?\"Invite Link\":\"Link Mời\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"link-container\",style:{display:inviteLink?\"flex\":\"none\"},children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\",onClick:function onClick(){return setInviteLink(\"\");}}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:inviteLink,className:\"link\",readOnly:true}),/*#__PURE__*/_jsx(\"button\",{className:\"copy-link\",onClick:handleCopyLink,ref:copyButton,children:lang===\"English\"?\"Copy\":\"Sao Chép\"}),/*#__PURE__*/_jsx(Overlay,{placement:\"top\",show:showText,target:copyButton.current,children:function children(_ref4){var placement=_ref4.placement,arrowProps=_ref4.arrowProps,_show=_ref4.show,popper=_ref4.popper,props=_objectWithoutProperties(_ref4,[\"placement\",\"arrowProps\",\"show\",\"popper\"]);return/*#__PURE__*/_jsx(\"div\",_objectSpread(_objectSpread({},props),{},{className:\"copied\",children:lang===\"English\"?\"Copied\":\"Đã Sao Chép\"}));}})]})]})]});};export default PlayWithFriend;","map":{"version":3,"sources":["F:/Web/Cờ Tướng/front_end/src/Components/Main/Game/GameController/PlayWithFriend/PlayWithFriend.jsx"],"names":["React","useEffect","useState","useContext","useRef","Button","Tooltip","Overlay","Spinner","renderPlayersList","renderPendingPlayers","callAPI","SocketContext","useSelector","PlayWithFriend","goBack","lang","input","setInput","playersList","setPlayersList","waitForResponse","setWaitForResponse","pendingPlayers","setPendingPlayers","playerInfo","state","appState","socket","show","setShow","target","copyButton","inviteLink","setInviteLink","invitedPlayer","setInvitedPlayer","time","gameState","side","boardState","showText","setShowText","handleSelectPlayer","event","name","currentTarget","getAttribute","replaceSpecialCharacters","str","replace","handleOnChange","value","playername","players","reCheck","document","querySelector","username","handleCanotSendInvite","cancelInvite","index","findIndex","player","emit","socketID","prevState","splice","reason","setTimeout","handleSendInvite","preventDefault","exact","length","clearInput","handleGenerateInviteLink","handleCopyLink","navigator","clipboard","writeText","then","on","push","receiverInfo","declineInvite","message","removeAllListeners","display","width","height","current","props","placement","arrowProps","_show","popper"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext, useRef } from \"react\";\r\nimport \"./PlayWithFriend.scss\";\r\nimport { Button, Tooltip, Overlay, Spinner } from \"react-bootstrap\";\r\nimport renderPlayersList from \"./renderPlayersList.js\";\r\nimport renderPendingPlayers from \"./renderPendingPlayers.js\";\r\nimport callAPI from \"../../../../App/callAPI.js\";\r\nimport { SocketContext } from \"../../../../App/context.js\";\r\nimport { useSelector } from \"react-redux\";\r\n\r\nconst PlayWithFriend = ({ goBack, lang }) => {\r\n  const [input, setInput] = useState(\"\");\r\n  const [playersList, setPlayersList] = useState([]);\r\n  const [waitForResponse, setWaitForResponse] = useState(false);\r\n  const [pendingPlayers, setPendingPlayers] = useState([]);\r\n  const playerInfo = useSelector((state) => state.appState.playerInfo);\r\n  const socket = useContext(SocketContext);\r\n  const [show, setShow] = useState(\"\");\r\n  const target = useRef(null);\r\n  const copyButton = useRef(null);\r\n  const [inviteLink, setInviteLink] = useState(\"\");\r\n  const [invitedPlayer, setInvitedPlayer] = useState(null);\r\n  const time = useSelector((state) => state.gameState.time);\r\n  const side = useSelector((state) => state.boardState.side);\r\n\r\n  const [showText, setShowText] = useState(false);\r\n\r\n  const handleSelectPlayer = (event) => {\r\n    const name = event.currentTarget.getAttribute(\"playername\");\r\n    setInput(name);\r\n    setPlayersList([]);\r\n  };\r\n\r\n  const replaceSpecialCharacters = (str) => {\r\n    return str.replace(/[^0-9a-zA-Z_-]+/g, \"\");\r\n  };\r\n\r\n  const handleOnChange = async (event) => {\r\n    try {\r\n      const value = event.currentTarget.value;\r\n      setInput(value);\r\n      if (value) {\r\n        const { players } = await callAPI(\"POST\", \"api/players\", {\r\n          playername: replaceSpecialCharacters(value),\r\n        });\r\n        const reCheck = document.querySelector(\"#player-name-search\").value;\r\n        if (!players) return;\r\n        const name = playerInfo.username;\r\n        if (reCheck)\r\n          setPlayersList(renderPlayersList(players, handleSelectPlayer, name));\r\n      } else setPlayersList([]);\r\n    } catch (_) {\r\n      handleCanotSendInvite(\r\n        lang === \"English\"\r\n          ? \"Something went wrong there. Try again\"\r\n          : \"Đã xảy ra lỗi. Xin hãy thử lại\"\r\n      );\r\n    }\r\n  };\r\n\r\n  const cancelInvite = (event) => {\r\n    const playername = event.currentTarget.getAttribute(\"playername\");\r\n    const index = pendingPlayers.findIndex(\r\n      (player) => player.username === playername\r\n    );\r\n    socket.emit(\"cancelInvite\", pendingPlayers[index].socketID, false);\r\n    setPendingPlayers((prevState) => {\r\n      prevState.splice(index, 1);\r\n      return [...prevState];\r\n    });\r\n  };\r\n\r\n  const handleCanotSendInvite = (reason) => {\r\n    setWaitForResponse(false);\r\n    setShow(reason);\r\n    setTimeout(() => {\r\n      setShow(\"\");\r\n    }, 1000);\r\n  };\r\n\r\n  const handleSendInvite = async (event) => {\r\n    try {\r\n      event.preventDefault();\r\n      if (waitForResponse) return;\r\n      const index = pendingPlayers.findIndex(\r\n        (player) => player.username === input\r\n      );\r\n      if (index === -1) {\r\n        setWaitForResponse(true);\r\n        const { players } = await callAPI(\"POST\", \"api/players\", {\r\n          playername: replaceSpecialCharacters(input),\r\n          exact: true,\r\n        });\r\n        if (players.length && players[0].username !== playerInfo.username) {\r\n          if (players[0].socketID) {\r\n            if (pendingPlayers.length + 1 > 5) {\r\n              handleCanotSendInvite(\r\n                lang === \"English\"\r\n                  ? \"You have sent too many invites\"\r\n                  : \"Bạn đã gửi quá nhiều lời mời\"\r\n              );\r\n              return;\r\n            }\r\n            setInvitedPlayer(players[0]);\r\n            socket.emit(\"setTimeAndSide\", time, side[1], () => {\r\n              socket.emit(\r\n                \"sendInvite\",\r\n                players[0].socketID,\r\n                players[0].username\r\n              );\r\n            });\r\n          } else\r\n            handleCanotSendInvite(\r\n              `${players[0].username} ${\r\n                lang === \"English\" ? \"isn't\" : \"không\"\r\n              } online`\r\n            );\r\n        } else\r\n          handleCanotSendInvite(\r\n            lang === \"English\" ? \"user not found\" : \"không tìm thấy\"\r\n          );\r\n      }\r\n    } catch (_) {\r\n      handleCanotSendInvite(\r\n        lang === \"English\"\r\n          ? \"Something went wrong there. Try again\"\r\n          : \"Đã xảy ra lỗi. Xin hãy thử lại\"\r\n      );\r\n    }\r\n  };\r\n\r\n  const clearInput = () => {\r\n    setInput(\"\");\r\n    setPlayersList([]);\r\n  };\r\n\r\n  const handleGenerateInviteLink = () => {\r\n    socket.emit(\"setTimeAndSide\", time, side[1], () => {\r\n      socket.emit(\"generateInviteLink\", (inviteLink) => {\r\n        setInviteLink(inviteLink);\r\n      });\r\n    });\r\n  };\r\n\r\n  const handleCopyLink = () => {\r\n    navigator.clipboard.writeText(inviteLink).then(() => {\r\n      setShowText(true);\r\n      setTimeout(() => {\r\n        setShowText(false);\r\n      }, 1000);\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    socket.on(\"validInvite\", () => {\r\n      setWaitForResponse(false);\r\n      setPendingPlayers((prevState) => {\r\n        prevState.push(invitedPlayer);\r\n        return [...prevState];\r\n      });\r\n    });\r\n\r\n    socket.on(\"inviteDeclined\", (receiverInfo) => {\r\n      const index = pendingPlayers.findIndex(\r\n        (player) => player.username === receiverInfo.playername\r\n      );\r\n      if (index !== -1) {\r\n        setPendingPlayers((prevState) => {\r\n          prevState[index].declineInvite = true;\r\n          return [...prevState];\r\n        });\r\n        setTimeout(() => {\r\n          setPendingPlayers((prevState) => {\r\n            prevState.splice(index, 1);\r\n            return [...prevState];\r\n          });\r\n        }, 1000);\r\n      }\r\n    });\r\n\r\n    socket.on(\"invalidInvite\", (message) => {\r\n      setWaitForResponse(false);\r\n      handleCanotSendInvite(message);\r\n    });\r\n\r\n    return () => {\r\n      socket.removeAllListeners(\"validInvite\");\r\n      socket.removeAllListeners(\"invalidInvite\");\r\n      socket.removeAllListeners(\"inviteDeclined\");\r\n      socket.removeAllListeners(\"playerInGame\");\r\n    };\r\n  }, [invitedPlayer, pendingPlayers]);\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      socket.emit(\"cancelInvite\", null, true);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"play-with-friend-container\">\r\n      <i className=\"fas fa-arrow-left fa-2x\" onClick={goBack}></i>\r\n      <ul className=\"players-pending players-list\">\r\n        {renderPendingPlayers(pendingPlayers, cancelInvite, lang)}\r\n      </ul>\r\n      <div className=\"btn-container\">\r\n        <form\r\n          className=\"username-input\"\r\n          onSubmit={handleSendInvite}\r\n          method=\"POST\"\r\n        >\r\n          <i className=\"fas fa-search\"></i>\r\n          <input\r\n            id=\"player-name-search\"\r\n            type=\"text\"\r\n            placeholder={lang === \"English\" ? \"Search...\" : \"Tìm kiếm...\"}\r\n            onInput={handleOnChange}\r\n            value={input}\r\n          />\r\n          <i\r\n            className=\"fas fa-times\"\r\n            onClick={clearInput}\r\n            style={{ display: input ? \"inline\" : \"none\" }}\r\n          ></i>\r\n          <Button className=\"invite\" type=\"submit\" ref={target}>\r\n            {waitForResponse ? (\r\n              <Spinner\r\n                animation=\"border\"\r\n                variant=\"info\"\r\n                style={{ width: \"1.5rem\", height: \"1.5rem\" }}\r\n              />\r\n            ) : lang === \"English\" ? (\r\n              \"Invite\"\r\n            ) : (\r\n              <>&nbsp;&nbsp;Mời&nbsp;&nbsp;</>\r\n            )}\r\n          </Button>\r\n          <Overlay target={target.current} show={show !== \"\"}>\r\n            {(props) => <Tooltip {...props}>{show}</Tooltip>}\r\n          </Overlay>\r\n          <ul className=\"players-list\">{playersList}</ul>\r\n        </form>\r\n        <Button className=\"invite-link\" onClick={handleGenerateInviteLink}>\r\n          {lang === \"English\" ? \"Invite Link\" : \"Link Mời\"}\r\n        </Button>\r\n        <div\r\n          className=\"link-container\"\r\n          style={{ display: inviteLink ? \"flex\" : \"none\" }}\r\n        >\r\n          <i className=\"fas fa-times\" onClick={() => setInviteLink(\"\")}></i>\r\n          <input\r\n            type=\"text\"\r\n            value={inviteLink}\r\n            className=\"link\"\r\n            readOnly={true}\r\n          />\r\n          <button\r\n            className=\"copy-link\"\r\n            onClick={handleCopyLink}\r\n            ref={copyButton}\r\n          >\r\n            {lang === \"English\" ? \"Copy\" : \"Sao Chép\"}\r\n          </button>\r\n          <Overlay placement=\"top\" show={showText} target={copyButton.current}>\r\n            {({ placement, arrowProps, show: _show, popper, ...props }) => (\r\n              <div {...props} className=\"copied\">\r\n                {lang === \"English\" ? \"Copied\" : \"Đã Sao Chép\"}\r\n              </div>\r\n            )}\r\n          </Overlay>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PlayWithFriend;\r\n"]},"metadata":{},"sourceType":"module"}